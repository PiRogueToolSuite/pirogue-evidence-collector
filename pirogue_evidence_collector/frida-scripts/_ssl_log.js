ðŸ“¦
598 /pirogue_evidence_collector/frida-scripts-src/agent.js.map
587 /pirogue_evidence_collector/frida-scripts-src/agent.js
2018 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/android_agent.js.map
1608 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/android_agent.js
696 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/android_java_tls_libs.js.map
547 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/android_java_tls_libs.js
2766 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/bouncycastle.js.map
2098 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/bouncycastle.js
2270 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/conscrypt.js.map
2243 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/conscrypt.js
1275 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/gnutls_android.js.map
767 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/gnutls_android.js
908 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/mbedTLS_android.js.map
506 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/mbedTLS_android.js
1064 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/nss_android.js.map
789 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/nss_android.js
1419 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/openssl_boringssl_android.js.map
1020 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/openssl_boringssl_android.js
2443 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/wolfssl_android.js.map
1788 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/wolfssl_android.js
1446 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/ios_agent.js.map
1052 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/ios_agent.js
1695 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/openssl_boringssl_ios.js.map
1325 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/openssl_boringssl_ios.js
1269 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/gnutls_linux.js.map
765 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/gnutls_linux.js
1769 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/linux_agent.js.map
1434 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/linux_agent.js
910 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/matrixssl_linux.js.map
510 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/matrixssl_linux.js
884 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/mbedTLS_linux.js.map
496 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/mbedTLS_linux.js
2637 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/nss_linux.js.map
2342 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/nss_linux.js
1393 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/openssl_boringssl_linux.js.map
990 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/openssl_boringssl_linux.js
2433 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/wolfssl_linux.js.map
1782 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/wolfssl_linux.js
1421 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/macos_agent.js.map
1064 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/macos_agent.js
1556 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/openssl_boringssl_macos.js.map
1042 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/openssl_boringssl_macos.js
6011 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/shared_functions.js.map
3957 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/shared_functions.js
378 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/shared_structures.js.map
130 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/shared_structures.js
4450 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/gnutls.js.map
4050 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/gnutls.js
1482 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/java_ssl_libs.js.map
1830 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/java_ssl_libs.js
3882 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/matrixssl.js.map
3412 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/matrixssl.js
4591 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/mbedTLS.js.map
3685 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/mbedTLS.js
19834 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/nss.js.map
16324 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/nss.js
5914 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/openssl_boringssl.js.map
5171 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/openssl_boringssl.js
3157 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/wolfssl.js.map
2839 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/wolfssl.js
1198 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_log.js.map
1374 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_log.js
8388 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/anti_root.js.map
7803 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/anti_root.js
410 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/log.js.map
157 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/log.js
1011 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/process_infos.js.map
770 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/process_infos.js
892 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/gnutls_windows.js.map
498 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/gnutls_windows.js
953 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/matrixssl_windows.js.map
543 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/matrixssl_windows.js
908 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/mbedTLS_windows.js.map
506 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/mbedTLS_windows.js
1025 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/nss_windows.js.map
689 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/nss_windows.js
1087 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/openssl_boringssl_windows.js.map
710 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/openssl_boringssl_windows.js
7700 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/sspi.js.map
6722 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/sspi.js
1750 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/windows_agent.js.map
1554 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/windows_agent.js
1076 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/wolfssl_windows.js.map
788 /pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/wolfssl_windows.js
1948 /pirogue_evidence_collector/frida-scripts-src/pirogue/dynamic_hook_injector.js.map
992 /pirogue_evidence_collector/frida-scripts-src/pirogue/dynamic_hook_injector.js
699 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_ad_ids.js.map
404 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_ad_ids.js
4311 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_aes_info.js.map
2558 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_aes_info.js
2150 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_socket_operations.js.map
1135 /pirogue_evidence_collector/frida-scripts-src/pirogue/log_socket_operations.js
6309 /pirogue_evidence_collector/frida-scripts-src/pirogue/no_root.js.map
6612 /pirogue_evidence_collector/frida-scripts-src/pirogue/no_root.js
âœ„
{"version":3,"file":"agent.js","names":["log_ad_ids","log_aes_info","socket_trace","no_root","inject_hooks","rpc","exports"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/","sources":["agent.ts"],"mappings":"MAAO,iDACEA,MAAkB,iDAClBC,MAAoB,mDACpBC,MAAoB,uDACnBC,MAAe,8CACfC,MAAoB,qCAsB9BC,IAAIC,QAAkB,SAAIN,EAC1BK,IAAIC,QAAoB,WAAIN,EAC5BK,IAAIC,QAAoB,WAAIL,EAC5BI,IAAIC,QAAsB,aAAIL,EAC9BI,IAAIC,QAAqB,YAAIJ,EAC7BG,IAAIC,QAAsB,aAAIJ,EAC9BG,IAAIC,QAAgB,OAAIH,EACxBE,IAAIC,QAAiB,QAAIH,EACzBE,IAAIC,QAA4B,mBAAIF,EACpCC,IAAIC,QAA8B,qBAAIF"}
âœ„
import"./friTap/agent/ssl_log.js";import{log_ad_ids as o}from"./pirogue/log_ad_ids.js";import{log_aes_info as r}from"./pirogue/log_aes_info.js";import{socket_trace as p}from"./pirogue/log_socket_operations.js";import{no_root as s}from"./pirogue/no_root.js";import{inject_hooks as e}from"./pirogue/dynamic_hook_injector.js";rpc.exports.logAdIds=o,rpc.exports.log_ad_ids=o,rpc.exports.logAesInfo=r,rpc.exports.log_aes_info=r,rpc.exports.socketTrace=p,rpc.exports.socket_trace=p,rpc.exports.noRoot=s,rpc.exports.no_root=s,rpc.exports.injectDynamicHooks=e,rpc.exports.inject_dynamic_hooks=e;
âœ„
{"version":3,"file":"android_agent.js","names":["module_library_mapping","getModuleNames","ssl_library_loader","invokeHookingFunction","log","devlog","gnutls_execute","wolfssl_execute","nss_execute","mbedTLS_execute","boring_execute","java_execute","moduleNames","global","addresses","socket_library","load_android_hooking_agent","is_base_hook","hook_native_Android_SSL_Libs","regex_libdl","libdl","find","element","match","undefined","dl_exports","Process","getModuleByName","enumerateExports","dlopen","ex","name","Interceptor","attach","Module","getExportByName","onEnter","args","this","moduleName","readCString","onLeave","retval","map","regex","func","test","console","error","hook_Android_Dynamic_Loader"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["android_agent.ts"],"mappings":"iCAASA,MAAiD,0DACjDC,wBAAgBC,2BAAoBC,MAA6B,8CACjEC,YAAKC,MAAc,0CACnBC,MAAsB,gDACtBC,MAAuB,6CACvBC,MAAmB,6CACnBC,MAAuB,gDACvBC,MAAsB,wDACtBC,MAAmB,6BAG5B,IACIC,EAA6BX,IAChCY,OAAeC,UAAY,UAErB,MAAMC,eAAiB,cA0DxB,SAAUC,6BACZhB,EAAqC,MAAI,CACrC,CAAC,iBAAkBG,EAAsBO,IACzC,CAAC,eAAgBP,EAAsBO,IACvC,CAAC,kBAAmBP,EAAsBG,IAC1C,CAAC,mBAAoBH,EAAsBI,IAC3C,CAAC,sBAAsBJ,EAAsBK,IAC7C,CAAC,mBAAoBL,EAAsBM,KA9D/CE,IAiDJ,SAAsCX,EAA4EiB,GAC9Gf,EAzDiB,QAyDkBF,EAAuBY,EAAY,UAAUK,EAEpF,CAaIC,CAA6BlB,GAAwB,GA9DzD,SAAqCA,EAA4EiB,GAC7G,IACA,MAAME,EAAc,gBACdC,EAAQR,EAAYS,MAAKC,GAAWA,EAAQC,MAAMJ,KACxD,QAAcK,IAAVJ,EACA,KAAM,oCAGV,IAAIK,EAAaC,QAAQC,gBAAgBP,GAAOQ,mBAChD,IAAIC,EAAS,SACb,IAAK,IAAIC,KAAML,EACX,GAAgB,uBAAZK,EAAGC,KAA+B,CAClCF,EAAS,qBACT,K,CAKRG,YAAYC,OAAOC,OAAOC,gBAAgBf,EAAOS,GAAS,CACtDO,QAAS,SAAUC,GACfC,KAAKC,WAAaF,EAAK,GAAGG,aAC9B,EACAC,QAAS,SAAUC,GACf,GAAuBlB,MAAnBc,KAAKC,WACL,IAAI,IAAII,KAAO3C,EAAqC,MAAE,CAClD,IAAI4C,EAAQD,EAAI,GACZE,EAAOF,EAAI,GACXC,EAAME,KAAKR,KAAKC,cAChBnC,EAAI,GAAGkC,KAAKC,sDACZM,EAAKP,KAAKC,WAAYtB,G,CAKtC,IAKJ8B,QAAQ3C,IAAI,qC,CACd,MAAO4C,GACL3C,EAAO,iBAAkB2C,GACzB5C,EAAI,oD,CAER,CAmBI6C,CAA4BjD,GAAwB,EACxD"}
âœ„
import{module_library_mapping as o}from"../shared/shared_structures.js";import{getModuleNames as r,ssl_library_loader as e,invokeHookingFunction as d}from"../shared/shared_functions.js";import{log as s,devlog as i}from"../util/log.js";import{gnutls_execute as n}from"./gnutls_android.js";import{wolfssl_execute as t}from"./wolfssl_android.js";import{nss_execute as l}from"./nss_android.js";import{mbedTLS_execute as a}from"./mbedTLS_android.js";import{boring_execute as m}from"./openssl_boringssl_android.js";import{java_execute as f}from"./android_java_tls_libs.js";var u=r();global.addresses={};export const socket_library="libc";export function load_android_hooking_agent(){o.linux=[[/.*libssl_sb.so/,d(m)],[/.*libssl\.so/,d(m)],[/.*libgnutls\.so/,d(n)],[/.*libwolfssl\.so/,d(t)],[/.*libnspr[0-9]?\.so/,d(l)],[/libmbedtls\.so.*/,d(a)]],f(),function(o,r){e("linux",o,u,"Android",r)}(o,!0),function(o,r){try{const i=/.*libdl.*\.so/,n=u.find((o=>o.match(i)));if(void 0===n)throw"Android Dynamic loader not found!";let t=Process.getModuleByName(n).enumerateExports();var e="dlopen";for(var d of t)if("android_dlopen_ext"===d.name){e="android_dlopen_ext";break}Interceptor.attach(Module.getExportByName(n,e),{onEnter:function(o){this.moduleName=o[0].readCString()},onLeave:function(e){if(null!=this.moduleName)for(let e of o.linux){let o=e[0],d=e[1];o.test(this.moduleName)&&(s(`${this.moduleName} was loaded & will be hooked on Android!`),d(this.moduleName,r))}}}),console.log("[*] Android dynamic loader hooked.")}catch(o){i("Loader error: "+o),s("No dynamic loader present for hooking on Android.")}}(o,!1)}
âœ„
{"version":3,"file":"android_java_tls_libs.js","names":["log","bouncy_execute","SSL_Java","SSL_Java_Android","install_java_android_hooks","Java","available","setTimeout","perform","use","error","execute_hooks","this","install_java_hooks","java_execute"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["android_java_tls_libs.ts"],"mappings":"cAASA,MAAW,mCACAC,MAAsB,uCACjCC,MAAgB,qCAGnB,MAAOC,yBAAyBD,EAGlCE,6BACQC,KAAKC,WACLC,YAAW,WAEPF,KAAKG,SAAQ,WAGT,IAEmBH,KAAKI,IAAI,sDACxBT,EAAI,uCACJC,G,CACF,MAAOS,G,CAGb,GACJ,GAAG,EAEX,CAGAC,gBACIC,KAAKR,6BACLQ,KAAKC,oBACT,SAKE,SAAUC,gBACG,IAAIX,kBACVQ,eACb"}
âœ„
import{log as o}from"../util/log.js";import{execute as a}from"./bouncycastle.js";import{SSL_Java as e}from"../ssl_lib/java_ssl_libs.js";export class SSL_Java_Android extends e{install_java_android_hooks(){Java.available&&setTimeout((function(){Java.perform((function(){try{Java.use("org.spongycastle.jsse.provider.ProvSSLSocketDirect");o("Bouncycastle/Spongycastle detected."),a()}catch(o){}}))}),0)}execute_hooks(){this.install_java_android_hooks(),this.install_java_hooks()}}export function java_execute(){(new SSL_Java_Android).execute_hooks()}
âœ„
{"version":3,"file":"bouncycastle.js","names":["log","byteArrayToString","byteArrayToNumber","getAttribute","reflectionByteArrayToString","execute","setTimeout","Java","perform","use","write","overload","implementation","buf","offset","len","result","i","push","message","this","this$0","value","getLocalPort","getPort","localAddress","getLocalAddress","getAddress","inetAddress","getInetAddress","length","getConnection","getSession","getId","send","read","bytesRead","notifyHandshakeComplete","x","securityParameters","protocol","clientRandom","masterSecretObj","clazz","masterSecretRawField","cast","getClass","getSuperclass","getDeclaredField","setAccessible","masterSecretReflectArray","get"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["bouncycastle.ts"],"mappings":"cAASA,MAAW,6CACXC,uBAAmBC,kBAAmBC,iCAAcC,MAAmC,uCAC1F,SAAUC,UACZC,YAAW,WACPC,KAAKC,SAAQ,WAIWD,KAAKE,IAAI,oEACfC,MAAMC,SAAS,KAAM,MAAO,OAAOC,eAAiB,SAAUC,EAAUC,EAAaC,GAE/F,IADA,IAAIC,EAAwB,GACnBC,EAAI,EAAGA,EAAIF,IAAOE,EACvBD,EAAOE,KAAc,IAATL,EAAII,IAEpB,IAAIE,EAAkC,CACtCA,YAAyB,WACzBA,EAAkB,SAAIC,KAAKC,OAAOC,MAAMC,eACxCJ,EAAkB,SAAIC,KAAKC,OAAOC,MAAME,UACxC,IAAIC,EAAeL,KAAKC,OAAOC,MAAMI,kBAAkBC,aACnDC,EAAcR,KAAKC,OAAOC,MAAMO,iBAAiBF,aAerD,OAd2B,GAAvBF,EAAaK,QACbX,EAAkB,SAAIjB,EAAkBuB,GACxCN,EAAkB,SAAIjB,EAAkB0B,GACxCT,EAAmB,UAAI,YAEvBA,EAAkB,SAAIlB,EAAkBwB,GACxCN,EAAkB,SAAIlB,EAAkB2B,GACxCT,EAAmB,UAAI,YAE3BA,EAAwB,eAAIlB,EAAkBmB,KAAKC,OAAOC,MAAMS,gBAAgBC,aAAaC,SAE7Fd,EAAkB,SAAI,uBACtBe,KAAKf,EAASH,GAEPI,KAAKV,MAAMG,EAAKC,EAAQC,EACnC,EAEmBR,KAAKE,IAAI,mEACf0B,KAAKxB,SAAS,KAAM,MAAO,OAAOC,eAAiB,SAAUC,EAAUC,EAAaC,GAG7F,IAFA,IAAIqB,EAAYhB,KAAKe,KAAKtB,EAAKC,EAAQC,GACnCC,EAAwB,GACnBC,EAAI,EAAGA,EAAImB,IAAanB,EAC7BD,EAAOE,KAAc,IAATL,EAAII,IAEpB,IAAIE,EAAkC,CACtCA,YAAyB,UACzBA,UAAuB,WACvBA,EAAkB,SAAIC,KAAKC,OAAOC,MAAME,UACxCL,EAAkB,SAAIC,KAAKC,OAAOC,MAAMC,eACxC,IAAIE,EAAeL,KAAKC,OAAOC,MAAMI,kBAAkBC,aACnDC,EAAcR,KAAKC,OAAOC,MAAMO,iBAAiBF,aAerD,OAd2B,GAAvBF,EAAaK,QACbX,EAAkB,SAAIjB,EAAkB0B,GACxCT,EAAkB,SAAIjB,EAAkBuB,GACxCN,EAAmB,UAAI,YAEvBA,EAAkB,SAAIlB,EAAkB2B,GACxCT,EAAkB,SAAIlB,EAAkBwB,GACxCN,EAAmB,UAAI,YAE3BA,EAAwB,eAAIlB,EAAkBmB,KAAKC,OAAOC,MAAMS,gBAAgBC,aAAaC,SAC7FjC,EAAImB,EAAwB,gBAC5BA,EAAkB,SAAI,sBACtBe,KAAKf,EAASH,GAEPoB,CACX,EAE0B7B,KAAKE,IAAI,sDACf4B,wBAAwBzB,eAAiB,SAAU0B,GAEnE,IACIC,EADWnB,KAAKoB,SAASlB,MACKiB,mBAAmBjB,MACjDmB,EAAeF,EAAmBE,aAAanB,MAC/CoB,EAAkBvC,EAAaoC,EAAoB,gBAGnDI,EAAQpC,KAAKE,IAAI,mBACjBmC,EAAuBrC,KAAKsC,KAAKH,EAAgBI,WAAYH,GAAOI,gBAAgBC,iBAAiB,QACzGJ,EAAqBK,eAAc,GACnC,IAAIC,EAA2BN,EAAqBO,IAAIT,GACpDvB,EAAkC,CACtCA,YAAyB,UAGzB,OAFAA,EAAgB,OAAI,iBAAmBlB,EAAkBwC,GAAgB,IAAMrC,EAA4B8C,GAC3GhB,KAAKf,GACEC,KAAKiB,wBAAwBC,EACxC,CAEJ,GACJ,GAAG,EAEP"}
âœ„
import{log as t}from"../util/log.js";import{byteArrayToString as e,byteArrayToNumber as s,getAttribute as a,reflectionByteArrayToString as r}from"../shared/shared_functions.js";export function execute(){setTimeout((function(){Java.perform((function(){Java.use("org.spongycastle.jsse.provider.ProvSSLSocketDirect$AppDataOutput").write.overload("[B","int","int").implementation=function(t,a,r){for(var i=[],o=0;o<r;++o)i.push(255&t[o]);var n={contentType:"datalog"};n.src_port=this.this$0.value.getLocalPort(),n.dst_port=this.this$0.value.getPort();var d=this.this$0.value.getLocalAddress().getAddress(),l=this.this$0.value.getInetAddress().getAddress();return 4==d.length?(n.src_addr=s(d),n.dst_addr=s(l),n.ss_family="AF_INET"):(n.src_addr=e(d),n.dst_addr=e(l),n.ss_family="AF_INET6"),n.ssl_session_id=e(this.this$0.value.getConnection().getSession().getId()),n.function="writeApplicationData",send(n,i),this.write(t,a,r)},Java.use("org.spongycastle.jsse.provider.ProvSSLSocketDirect$AppDataInput").read.overload("[B","int","int").implementation=function(a,r,i){for(var o=this.read(a,r,i),n=[],d=0;d<o;++d)n.push(255&a[d]);var l={contentType:"datalog",ss_family:"AF_INET"};l.src_port=this.this$0.value.getPort(),l.dst_port=this.this$0.value.getLocalPort();var c=this.this$0.value.getLocalAddress().getAddress(),u=this.this$0.value.getInetAddress().getAddress();return 4==c.length?(l.src_addr=s(u),l.dst_addr=s(c),l.ss_family="AF_INET"):(l.src_addr=e(u),l.dst_addr=e(c),l.ss_family="AF_INET6"),l.ssl_session_id=e(this.this$0.value.getConnection().getSession().getId()),t(l.ssl_session_id),l.function="readApplicationData",send(l,n),o},Java.use("org.spongycastle.jsse.provider.ProvSSLSocketDirect").notifyHandshakeComplete.implementation=function(t){var s=this.protocol.value.securityParameters.value,i=s.clientRandom.value,o=a(s,"masterSecret"),n=Java.use("java.lang.Class"),d=Java.cast(o.getClass(),n).getSuperclass().getDeclaredField("data");d.setAccessible(!0);var l=d.get(o),c={contentType:"keylog"};return c.keylog="CLIENT_RANDOM "+e(i)+" "+r(l),send(c),this.notifyHandshakeComplete(t)}}))}),0)}
âœ„
{"version":3,"file":"conscrypt.js","names":["devlog","log","getAndroidVersion","findProviderInstallerImplFromClassloaders","currentClassLoader","backupImplementation","providerInstallerImpl","classLoaders","Java","enumerateClassLoadersSync","cl","ClassFactory","get","use","error","loadClass","overload","implementation","execute","perform","javaClassLoader","className","retval","this","endsWith","insertProvider","providerInstaller","installIfNeeded","context","installIfNeededAsync","callback","onProviderInstalled","providerInstallerFromClassloder","findProviderInstallerFromClassloaders","undefined","console"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["conscrypt.ts"],"mappings":"iBAASA,SAAQC,MAAW,6CACnBC,MAAyB,2BAElC,SAASC,EAA0CC,EAAkCC,GAEjF,IAAIC,EAAwB,KACxBC,EAAeC,KAAKC,4BACxB,IAAK,IAAIC,KAAMH,EACX,IAEID,EADmBE,KAAKG,aAAaC,IAAIF,GACJG,IAAI,gEACzC,K,CACF,MAAOC,GACLd,EAAO,uFACPA,EAAO,sBAAsBc,GAC7BR,EAAwB,I,CAehC,OATcJ,KAIC,KAEXE,EAAmBW,UAAUC,SAAS,oBAAoBC,eAAiBZ,GAGxEC,CACX,QAgCM,SAAUY,UAGZV,KAAKW,SAAQ,WAET,IAAIC,EAAkBZ,KAAKK,IAAI,yBAC3BR,EAAuBe,EAAgBL,UAAUC,SAAS,oBAAoBC,eAElFG,EAAgBL,UAAUC,SAAS,oBAAoBC,eAAiB,SAAUI,GAC9E,IAAIC,EAASC,KAAKR,UAAUM,GAC5B,GAAIA,EAAUG,SAAS,yBAA0B,CAC7CvB,EAAI,4CACJ,IAAIK,EAAwBH,EAA0CiB,EAAiBf,GACzD,OAA1BC,EACAL,EAAI,yEAEJK,EAAsBmB,eAAeR,eAAiB,WAClDhB,EAAI,6CAER,C,CAIR,OAAOqB,CACX,EAGA,IACI,IAAII,EAAoBlB,KAAKK,IAAI,qDACjCa,EAAkBC,gBAAgBV,eAAiB,SAAUW,GACzD3B,EAAI,yCACR,EACAyB,EAAkBG,qBAAqBZ,eAAiB,SAAUW,EAAcE,GAC5E7B,EAAI,+CACJ6B,EAASC,qBACb,C,CACF,MAAOjB,GACL,IAEI,IAAIR,EAAwB,KACxB0B,EAtEpB,SAA+C5B,EAAkCC,GAE7E,IAAIqB,EAAoB,KACpBnB,EAAeC,KAAKC,4BACxB,IAAK,IAAIC,KAAMH,EACX,IAEImB,EADmBlB,KAAKG,aAAaC,IAAIF,GACRG,IAAI,qDACrC,K,CACF,MAAOC,GACLd,EAAO,mFACPA,EAAO,sBAAsBc,GAC7BY,EAAoB,I,CAe5B,OATcxB,KAIC,KAEXE,EAAmBW,UAAUC,SAAS,oBAAoBC,eAAiBZ,GAGxEqB,CACX,CA0CsDO,CAAsCb,EAAiBf,GACrD,OAApC2B,IACA1B,EAAwBH,EAA0CiB,EAAiBf,IAI/C,OAApC2B,GAAuE,OAA3B1B,QAAuE4B,IAApCF,EAC/E/B,EAAI,qEAGyB,OAA1BK,EACCA,EAAsBmB,eAAeR,eAAiB,WAClDhB,EAAI,6CAER,GAGJ+B,EAAgCL,gBAAgBV,eAAiB,SAAUW,GACvE3B,EAAI,yCACR,EACA+B,EAAgCH,qBAAqBZ,eAAiB,SAAUW,EAAcE,GAC1F7B,EAAI,+CACJ6B,EAASC,qBACb,E,CAGP,MAAOjB,GACJb,EAAI,+CACJkC,QAAQlC,IAAIa,E,EAKxB,GAIJ"}
âœ„
import{devlog as r,log as e}from"../util/log.js";import{getAndroidVersion as l}from"../util/process_infos.js";function n(e,n){var o=null,a=Java.enumerateClassLoadersSync();for(var i of a)try{o=Java.ClassFactory.get(i).use("com.google.android.gms.common.security.ProviderInstallerImpl");break}catch(e){r("Error in hooking ProviderInstallerImpl (findProviderInstallerImplFromClassloaders):"),r("[-] Error message: "+e),o=null}return l()<=12&&(e.loadClass.overload("java.lang.String").implementation=n),o}export function execute(){Java.perform((function(){var o=Java.use("java.lang.ClassLoader"),a=o.loadClass.overload("java.lang.String").implementation;o.loadClass.overload("java.lang.String").implementation=function(r){let l=this.loadClass(r);if(r.endsWith("ProviderInstallerImpl")){e("Process is loading ProviderInstallerImpl");var i=n(o,a);null===i?e("ProviderInstallerImpl could not be found, although it has been loaded"):i.insertProvider.implementation=function(){e("ProviderinstallerImpl redirection/blocking")}}return l};try{var i=Java.use("com.google.android.gms.security.ProviderInstaller");i.installIfNeeded.implementation=function(r){e("Providerinstaller redirection/blocking")},i.installIfNeededAsync.implementation=function(r,l){e("ProviderinstallerAsncy redirection/blocking"),l.onProviderInstalled()}}catch(i){try{var t=null,s=function(e,n){var o=null,a=Java.enumerateClassLoadersSync();for(var i of a)try{o=Java.ClassFactory.get(i).use("com.google.android.gms.security.ProviderInstaller");break}catch(e){r("Error in hooking ProviderInstallerImpl (findProviderInstallerFromClassloaders):"),r("[-] Error message: "+e),o=null}return l()<=12&&(e.loadClass.overload("java.lang.String").implementation=n),o}(o,a);null===s&&(t=n(o,a)),null===s&&null===t||void 0===s?e("ProviderInstaller could not be found, although it has been loaded"):null!==t?t.insertProvider.implementation=function(){e("ProviderinstallerImpl redirection/blocking")}:(s.installIfNeeded.implementation=function(r){e("Providerinstaller redirection/blocking")},s.installIfNeededAsync.implementation=function(r,l){e("ProviderinstallerAsync redirection/blocking"),l.onProviderInstalled()})}catch(r){e("Some error in hooking the Providerinstaller"),console.log(r)}}}))}
âœ„
{"version":3,"file":"gnutls_android.js","names":["GnuTLS","socket_library","GnuTLS_Linux","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","Interceptor","attach","addresses","module_name","onEnter","args","session","onLeave","retval","console","log","gnutls_session_set_keylog_function","readPointer","keylog_callback","gnutls_execute","gnutls_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["gnutls_android.ts"],"mappings":"iBACQA,MAAc,gDACbC,MAAsB,4BAEzB,MAAOC,qBAAqBF,EAE9BG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCACIC,YAAYC,OAAON,KAAKO,UAAUP,KAAKQ,aAA0B,YACrE,CACIC,QAAS,SAAUC,GACfV,KAAKW,QAAUD,EAAK,EACxB,EACAE,QAAS,SAAUC,GACfC,QAAQC,IAAIf,KAAKW,SACjBlB,EAAOuB,mCAAmChB,KAAKW,QAAQM,cAAexB,EAAOyB,gBAEjF,GAGJ,SAIE,SAAUC,eAAetB,EAAmBC,GAC9C,IAAIsB,EAAa,IAAIzB,aAAaE,EAAWH,EAAgBI,GAG7D,GAFAsB,EAAWnB,gBAEPH,EAAc,CACd,MAAMuB,EAAiBD,EAAWb,UAAUV,GAExCyB,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAexB,GAAcwB,E,CAIzD"}
âœ„
import{GnuTLS as s}from"../ssl_lib/gnutls.js";import{socket_library as t}from"./android_agent.js";export class GnuTLS_Linux extends s{constructor(s,t,e){super(s,t),this.moduleName=s,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){Interceptor.attach(this.addresses[this.module_name].gnutls_init,{onEnter:function(s){this.session=s[0]},onLeave:function(t){console.log(this.session),s.gnutls_session_set_keylog_function(this.session.readPointer(),s.keylog_callback)}})}}export function gnutls_execute(s,e){var o=new GnuTLS_Linux(s,t,e);if(o.execute_hooks(),e){const t=o.addresses[s];Object.keys(t).length>0&&(global.init_addresses[s]=t)}}
âœ„
{"version":3,"file":"mbedTLS_android.js","names":["mbed_TLS","socket_library","mbed_TLS_Android","constructor","moduleName","is_base_hook","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","mbedTLS_execute","mbedTLS_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["mbedTLS_android.ts"],"mappings":"mBACQA,MAAgB,iDACfC,MAAsB,4BAEzB,MAAOC,yBAAyBF,EAElCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CASAO,iCAEA,CAEAC,gBACIF,KAAKG,8BACLH,KAAKI,8BACT,SAKE,SAAUC,gBAAgBR,EAAmBC,GAC/C,IAAIQ,EAAc,IAAIX,iBAAiBE,EAAWH,EAAgBI,GAGlE,GAFAQ,EAAYJ,gBAERJ,EAAc,CACd,MAAMS,EAAiBD,EAAYE,UAAUX,GAEzCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAKzD"}
âœ„
import{mbed_TLS as e}from"../ssl_lib/mbedTLS.js";import{socket_library as t}from"./android_agent.js";export class mbed_TLS_Android extends e{constructor(e,t,s){super(e,t),this.moduleName=e,this.socket_library=t}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function mbedTLS_execute(e,s){var o=new mbed_TLS_Android(e,t,s);if(o.execute_hooks(),s){const t=o.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"nss_android.js","names":["NSS","socket_library","NSS_Android","constructor","moduleName","is_base_hook","library_method_mapping","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","nss_execute","nss_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["nss_android.ts"],"mappings":"cACQA,MAAW,6CACVC,MAAsB,4BAEzB,MAAOC,oBAAoBF,EAE7BG,YAAmBC,EAA0BH,EAAuBI,GAChE,IAAIC,EAA2D,GAC/DA,EAAuB,IAAIF,MAAiB,CAAC,WAAY,UAAW,2BAA4B,iBAAkB,iBAAkB,wBAAyB,kBAC7JE,EAAuB,YAAc,CAAC,uBAAwB,mBAC9DA,EAAuB,eAAiB,CAAC,eAAgB,mBAAoB,yBAC7EA,EAAuB,IAAIL,MAAqB,CAAC,cAAe,cAAe,QAAS,SAExFM,MAAMH,EAAWH,EAAeK,GAPjBE,KAAAJ,aAA0BI,KAAAP,gBAQ7C,CAGAQ,gBACID,KAAKE,8BACLF,KAAKG,8BAET,SAKE,SAAUC,YAAYR,EAAmBC,GAC3C,IAAIQ,EAAU,IAAIX,YAAYE,EAAWH,EAAgBI,GAGzD,GAFAQ,EAAQJ,gBAEJJ,EAAc,CACd,MAAMS,EAAiBD,EAAQE,UAAUX,GAErCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAIzD"}
âœ„
import{NSS as e}from"../ssl_lib/nss.js";import{socket_library as t}from"./android_agent.js";export class NSS_Android extends e{constructor(e,t,s){var o={};o[`*${e}*`]=["PR_Write","PR_Read","PR_FileDesc2NativeHandle","PR_GetPeerName","PR_GetSockName","PR_GetNameForIdentity","PR_GetDescType"],o["*libnss*"]=["PK11_ExtractKeyValue","PK11_GetKeyData"],o["*libssl*.so"]=["SSL_ImportFD","SSL_GetSessionID","SSL_HandshakeCallback"],o[`*${t}*`]=["getpeername","getsockname","ntohs","ntohl"],super(e,t,o),this.moduleName=e,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function nss_execute(e,s){var o=new NSS_Android(e,t,s);if(o.execute_hooks(),s){const t=o.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"openssl_boringssl_android.js","names":["OpenSSL_BoringSSL","socket_library","OpenSSL_BoringSSL_Android","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","SSL_CTX_set_keylog_callback","NativeFunction","addresses","module_name","instance","Interceptor","attach","onEnter","args","keylog_callback","boring_execute","boring_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["openssl_boringssl_android.ts"],"mappings":"4BACQA,MAAyB,2DACxBC,MAAsB,4BAEzB,MAAOC,kCAAkCF,EAE3CG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,EAAeI,GADjBE,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCAEIJ,KAAKK,4BAA8B,IAAIC,eAAeN,KAAKO,UAAUP,KAAKQ,aAA0C,4BAAG,OAAQ,CAAC,UAAW,YAC3I,IAAIC,EAAWT,KAGfU,YAAYC,OAAOX,KAAKO,UAAUP,KAAKQ,aAAsB,QAC7D,CACII,QAAS,SAAUC,GACfJ,EAASJ,4BAA4BQ,EAAK,GAAIpB,EAAkBqB,gBACpE,IAIJJ,YAAYC,OAAOX,KAAKO,UAAUP,KAAKQ,aAA+B,iBACtE,CACII,QAAS,SAAUC,GACfJ,EAASJ,4BAA4BQ,EAAK,GAAIpB,EAAkBqB,gBACpE,GAGR,SAKE,SAAUC,eAAelB,EAAmBC,GAC9C,IAAIkB,EAAa,IAAIrB,0BAA0BE,EAAWH,EAAeI,GAGzE,GAFAkB,EAAWf,gBAEPH,EAAc,CACd,MAAMmB,EAAiBD,EAAWT,UAAUV,GAExCqB,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAepB,GAAcoB,E,CAIzD"}
âœ„
import{OpenSSL_BoringSSL as e}from"../ssl_lib/openssl_boringssl.js";import{socket_library as t}from"./android_agent.js";export class OpenSSL_BoringSSL_Android extends e{constructor(e,t,s){super(e,t,s),this.moduleName=e,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){this.SSL_CTX_set_keylog_callback=new NativeFunction(this.addresses[this.module_name].SSL_CTX_set_keylog_callback,"void",["pointer","pointer"]);var t=this;Interceptor.attach(this.addresses[this.module_name].SSL_new,{onEnter:function(s){t.SSL_CTX_set_keylog_callback(s[0],e.keylog_callback)}}),Interceptor.attach(this.addresses[this.module_name].SSL_do_handshake,{onEnter:function(s){t.SSL_CTX_set_keylog_callback(s[0],e.keylog_callback)}})}}export function boring_execute(e,s){var o=new OpenSSL_BoringSSL_Android(e,t,s);if(o.execute_hooks(),s){const t=o.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"wolfssl_android.js","names":["WolfSSL","socket_library","toHexString","WolfSSL_Android","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","wolfSSL_get_client_random","NativeFunction","addresses","module_name","wolfSSL_get_server_random","wolfSSL_SESSION_get_master_key","Interceptor","attach","onEnter","args","ssl","onLeave","retval","session","wolfSSL_get_session","keysString","requiredClientRandomLength","NULL","clientBuffer","Memory","alloc","clientBytes","readByteArray","requiredServerRandomLength","serverBuffer","serverBytes","requiredMasterKeyLength","masterBuffer","masterBytes","message","send","wolfssl_execute","wolf_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/android/","sources":["wolfssl_android.ts"],"mappings":"kBACQA,MAAe,iDACdC,MAAsB,2CACtBC,MAAmB,uCAEtB,MAAOC,wBAAwBH,EAEjCI,YAAmBC,EAA0BJ,EAAuBK,GAChEC,MAAMF,EAAWJ,GADFO,KAAAH,aAA0BG,KAAAP,gBAE7C,CAGAQ,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCACIZ,EAAQa,0BAA4B,IAAIC,eAAeN,KAAKO,UAAUP,KAAKQ,aAAwC,0BAAE,MAAO,CAAC,UAAW,UAAW,QACnJhB,EAAQiB,0BAA4B,IAAIH,eAAeN,KAAKO,UAAUP,KAAKQ,aAAwC,0BAAE,MAAO,CAAC,UAAW,UAAW,QAEnJhB,EAAQkB,+BAAiC,IAAIJ,eAAeN,KAAKO,UAAUP,KAAKQ,aAA6C,+BAAG,MAAO,CAAC,UAAW,UAAW,QAE9JG,YAAYC,OAAOZ,KAAKO,UAAUP,KAAKQ,aAA8B,gBAAE,CACnEK,QAAS,SAASC,GACdd,KAAKe,IAAMD,EAAK,EACpB,EACAE,QAAS,SAASC,GACdjB,KAAKkB,QAAU1B,EAAQ2B,oBAAoBnB,KAAKe,KAEhD,IAAIK,EAAa,GAGbC,EAA6B7B,EAAQa,0BAA0BL,KAAKkB,QAASI,KAAM,GAEnFC,EAAeC,OAAOC,MAAMJ,GAChC7B,EAAQa,0BAA0BL,KAAKe,IAAKQ,EAAcF,GAC1D,IAAIK,EAAcH,EAAaI,cAAcN,GAC7CD,EAAa,GAAGA,mBAA4B1B,EAAYgC,OAGxD,IAAIE,EAA6BpC,EAAQiB,0BAA0BT,KAAKkB,QAASI,KAAM,GACnFO,EAAeL,OAAOC,MAAMG,GAChCpC,EAAQiB,0BAA0BT,KAAKe,IAAKc,EAAcD,GAC1D,IAAIE,EAAcD,EAAaF,cAAcC,GAC7CR,EAAa,GAAGA,mBAA4B1B,EAAYoC,OAGxD,IAAIC,EAA0BvC,EAAQkB,+BAA+BV,KAAKkB,QAASI,KAAM,GACrFU,EAAeR,OAAOC,MAAMM,GAChCvC,EAAQkB,+BAA+BV,KAAKkB,QAASc,EAAcD,GACnE,IAAIE,EAAcD,EAAaL,cAAcI,GAC7CX,EAAa,GAAGA,gBAAyB1B,EAAYuC,OAGrD,IAAIC,EAAqD,CACzDA,YAAyB,UACzBA,EAAgB,OAAId,EACpBe,KAAKD,EAET,GAER,SAME,SAAUE,gBAAgBvC,EAAmBC,GAC/C,IAAIuC,EAAW,IAAI1C,gBAAgBE,EAAWJ,EAAgBK,GAG9D,GAFAuC,EAASpC,gBAELH,EAAc,CACd,MAAMwC,EAAiBD,EAAS9B,UAAUV,GAEtC0C,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAezC,GAAcyC,E,CAIzD"}
âœ„
import{WolfSSL as e}from"../ssl_lib/wolfssl.js";import{socket_library as s}from"./android_agent.js";import{toHexString as t}from"../shared/shared_functions.js";export class WolfSSL_Android extends e{constructor(e,s,t){super(e,s),this.moduleName=e,this.socket_library=s}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){e.wolfSSL_get_client_random=new NativeFunction(this.addresses[this.module_name].wolfSSL_get_client_random,"int",["pointer","pointer","int"]),e.wolfSSL_get_server_random=new NativeFunction(this.addresses[this.module_name].wolfSSL_get_server_random,"int",["pointer","pointer","int"]),e.wolfSSL_SESSION_get_master_key=new NativeFunction(this.addresses[this.module_name].wolfSSL_SESSION_get_master_key,"int",["pointer","pointer","int"]),Interceptor.attach(this.addresses[this.module_name].wolfSSL_connect,{onEnter:function(e){this.ssl=e[0]},onLeave:function(s){this.session=e.wolfSSL_get_session(this.ssl);var o="",n=e.wolfSSL_get_client_random(this.session,NULL,0),r=Memory.alloc(n);e.wolfSSL_get_client_random(this.ssl,r,n);var _=r.readByteArray(n);o=`${o}CLIENT_RANDOM: ${t(_)}\n`;var i=e.wolfSSL_get_server_random(this.session,NULL,0),a=Memory.alloc(i);e.wolfSSL_get_server_random(this.ssl,a,i);var l=a.readByteArray(i);o=`${o}SERVER_RANDOM: ${t(l)}\n`;var S=e.wolfSSL_SESSION_get_master_key(this.session,NULL,0),d=Memory.alloc(S);e.wolfSSL_SESSION_get_master_key(this.session,d,S);var c=d.readByteArray(S);o=`${o}MASTER_KEY: ${t(c)}\n`;var h={contentType:"keylog"};h.keylog=o,send(h)}})}}export function wolfssl_execute(e,t){var o=new WolfSSL_Android(e,s,t);if(o.execute_hooks(),t){const s=o.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"ios_agent.js","names":["module_library_mapping","log","devlog","getModuleNames","ssl_library_loader","invokeHookingFunction","boring_execute","moduleNames","socket_library","load_ios_hooking_agent","is_base_hook","hook_iOS_SSL_Libs","regex_libdl","libdl","find","element","match","undefined","Interceptor","attach","Module","getExportByName","onEnter","args","this","moduleName","readCString","onLeave","retval","map","regex","func","test","console","error","hook_iOS_Dynamic_Loader"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/","sources":["ios_agent.ts"],"mappings":"iCAASA,MAAiD,+CACjDC,YAAKC,MAAc,0CACnBC,wBAAgBC,2BAAoBC,MAA6B,yDACjEC,MAAsB,6BAG/B,IACIC,EAA6BJ,WAE1B,MAAMK,eAAiB,2BAgDxB,SAAUC,yBACZT,EAAqC,OAAI,CACrC,CAAC,wBAAyBK,EAAsBC,KARxD,SAA2BN,EAA4EU,GACnGN,EA9CiB,SA8CkBJ,EAAuBO,EAAY,MAAMG,EAChF,CAQIC,CAAkBX,GAAwB,GAjD9C,SAAiCA,EAA4EU,GACzG,IACI,MAAME,EAAc,oBACdC,EAAQN,EAAYO,MAAKC,GAAWA,EAAQC,MAAMJ,KACxD,QAAcK,IAAVJ,EACA,KAAM,mCAKVK,YAAYC,OAAOC,OAAOC,gBAAgBR,EAF7B,UAE6C,CACtDS,QAAS,SAAUC,GACfC,KAAKC,WAAaF,EAAK,GAAGG,aAC9B,EACAC,QAAS,SAAUC,GACf,GAAuBX,MAAnBO,KAAKC,WACL,IAAK,IAAII,KAAO7B,EAAqC,OAAG,CACpD,IAAI8B,EAAQD,EAAI,GACZE,EAAOF,EAAI,GACXC,EAAME,KAAKR,KAAKC,cAChBxB,EAAI,GAAGuB,KAAKC,kDACZM,EAAKP,KAAKC,WAAYf,G,CAKtC,IAKJuB,QAAQhC,IAAI,iC,CACd,MAAOiC,GACLhC,EAAO,iBAAmBgC,GAC1BjC,EAAI,gD,CAEZ,CAcIkC,CAAwBnC,GAAwB,EACpD"}
âœ„
import{module_library_mapping as o}from"../shared/shared_structures.js";import{log as e,devlog as i}from"../util/log.js";import{getModuleNames as t,ssl_library_loader as r,invokeHookingFunction as n}from"../shared/shared_functions.js";import{boring_execute as a}from"./openssl_boringssl_ios.js";var s=t();export const socket_library="libSystem.B.dylib";export function load_ios_hooking_agent(){o.darwin=[[/.*libboringssl\.dylib/,n(a)]],function(o,e){r("darwin",o,s,"iOS",e)}(o,!0),function(o,t){try{const i=/libSystem.B.dylib/,r=s.find((o=>o.match(i)));if(void 0===r)throw"Darwin Dynamic loader not found!";Interceptor.attach(Module.getExportByName(r,"dlopen"),{onEnter:function(o){this.moduleName=o[0].readCString()},onLeave:function(i){if(null!=this.moduleName)for(let i of o.darwin){let o=i[0],r=i[1];o.test(this.moduleName)&&(e(`${this.moduleName} was loaded & will be hooked on iOS!`),r(this.moduleName,t))}}}),console.log("[*] iOS dynamic loader hooked.")}catch(o){i("Loader error: "+o),e("No dynamic loader present for hooking on iOS.")}}(o,!1)}
âœ„
{"version":3,"file":"openssl_boringssl_ios.js","names":["OpenSSL_BoringSSL","socket_library","devlog","OpenSSL_BoringSSL_iOS","install_tls_keys_callback_hook","ObjC","available","CALLBACK_OFFSET","foundationNumber","Module","findExportByName","readDouble","undefined","Interceptor","attach","this","addresses","module_name","onEnter","args","ptr","add","writePointer","keylog_callback","constructor","moduleName","is_base_hook","library_method_mapping","super","execute_hooks","boring_execute","boring_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ios/","sources":["openssl_boringssl_ios.ts"],"mappings":"4BACQA,MAAyB,2DACxBC,MAAsB,kCACjBC,MAAc,wBAEtB,MAAOC,8BAA8BH,EAEvCI,iCAEI,GAAIC,KAAKC,UAAW,CAChB,IAAIC,EAAkB,IAElBC,EAAmBC,OAAOC,iBAAiB,iBAAkB,mCAAmCC,aAC7EC,MAApBJ,GACCN,EAAO,oCACPK,EAAkB,KACXC,GAAoB,UAAYA,EAAmB,MAC1DN,EAAO,qCACPK,EAAkB,KACXC,GAAoB,MAAQA,EAAmB,UACtDN,EAAO,qCACPK,EAAkB,KACXC,GAAoB,UAAYA,GAAoB,QAC3DN,EAAO,qCACPK,EAAkB,KACXC,EAAmB,SAC1BN,EAAO,qCACPK,EAAkB,KAEtBM,YAAYC,OAAOC,KAAKC,UAAUD,KAAKE,aAAwC,0BAAG,CAChFC,QAAS,SAAUC,GACjBC,IAAID,EAAK,IAAIE,IAAId,GAAiBe,aAAatB,EAAkBuB,gBACnE,G,CAKV,CAGAC,YAAmBC,EAA0BxB,EAAuByB,GAEhE,IAAIC,EAA2D,GAG/DA,EAAuB,IAAIF,MAAiB,CAAC,WAAY,YAAa,aAAc,kBAAmB,qBAAsB,UAAW,6BACxIE,EAAuB,IAAI1B,MAAqB,CAAC,eAAgB,eAAgB,SAAU,UAE3F2B,MAAMH,EAAWxB,EAAeyB,EAAaC,GAR9BZ,KAAAU,aAA0BV,KAAAd,gBAS7C,CAEA4B,gBAQId,KAAKX,gCACT,SAOE,SAAU0B,eAAeL,EAAmBC,GAC9C,IAAIK,EAAa,IAAI5B,sBAAsBsB,EAAWxB,EAAgByB,GAGtE,GAFAK,EAAWF,gBAEPH,EAAc,CACd,MAAMM,EAAiBD,EAAWf,UAAUS,GAExCQ,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAeP,GAAcO,E,CAGzD"}
âœ„
import{OpenSSL_BoringSSL as e}from"../ssl_lib/openssl_boringssl.js";import{socket_library as l}from"./ios_agent.js";import{devlog as o}from"../util/log.js";export class OpenSSL_BoringSSL_iOS extends e{install_tls_keys_callback_hook(){if(ObjC.available){var l=680,t=Module.findExportByName("CoreFoundation","kCFCoreFoundationVersionNumber")?.readDouble();null==t?(o("Installing callback for iOS < 14"),l=680):t>=1751.108&&t<1854?(o("Installing callback for iOS >= 14"),l=696):t>=1854&&t<1946.102?(o("Installing callback for iOS >= 15"),l=760):t>=1946.102&&t<=1979.1?(o("Installing callback for iOS >= 16"),l=768):t>1979.1&&(o("Installing callback for iOS >= 17"),l=776),Interceptor.attach(this.addresses[this.module_name].SSL_CTX_set_info_callback,{onEnter:function(o){ptr(o[0]).add(l).writePointer(e.keylog_callback)}})}}constructor(e,l,o){var t={};t[`*${e}*`]=["SSL_read","SSL_write","BIO_get_fd","SSL_get_session","SSL_SESSION_get_id","SSL_new","SSL_CTX_set_info_callback"],t[`*${l}*`]=["getpeername*","getsockname*","ntohs*","ntohl*"],super(e,l,o,t),this.moduleName=e,this.socket_library=l}execute_hooks(){this.install_tls_keys_callback_hook()}}export function boring_execute(e,o){var t=new OpenSSL_BoringSSL_iOS(e,l,o);if(t.execute_hooks(),o){const l=t.addresses[e];Object.keys(l).length>0&&(global.init_addresses[e]=l)}}
âœ„
{"version":3,"file":"gnutls_linux.js","names":["GnuTLS","socket_library","GnuTLS_Linux","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","Interceptor","attach","addresses","module_name","onEnter","args","session","onLeave","retval","console","log","gnutls_session_set_keylog_function","readPointer","keylog_callback","gnutls_execute","gnutls_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["gnutls_linux.ts"],"mappings":"iBACQA,MAAc,gDACbC,MAAsB,0BAEzB,MAAOC,qBAAqBF,EAE9BG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCACIC,YAAYC,OAAON,KAAKO,UAAUP,KAAKQ,aAA0B,YACrE,CACIC,QAAS,SAAUC,GACfV,KAAKW,QAAUD,EAAK,EACxB,EACAE,QAAS,SAAUC,GACfC,QAAQC,IAAIf,KAAKW,SACjBlB,EAAOuB,mCAAmChB,KAAKW,QAAQM,cAAexB,EAAOyB,gBAEjF,GAGJ,SAOE,SAAUC,eAAetB,EAAmBC,GAC9C,IAAIsB,EAAa,IAAIzB,aAAaE,EAAWH,EAAgBI,GAG7D,GAFAsB,EAAWnB,gBAEPH,EAAc,CACd,MAAMuB,EAAiBD,EAAWb,UAAUV,GAExCyB,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAexB,GAAcwB,E,CAIzD"}
âœ„
import{GnuTLS as s}from"../ssl_lib/gnutls.js";import{socket_library as t}from"./linux_agent.js";export class GnuTLS_Linux extends s{constructor(s,t,e){super(s,t),this.moduleName=s,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){Interceptor.attach(this.addresses[this.module_name].gnutls_init,{onEnter:function(s){this.session=s[0]},onLeave:function(t){console.log(this.session),s.gnutls_session_set_keylog_function(this.session.readPointer(),s.keylog_callback)}})}}export function gnutls_execute(s,e){var n=new GnuTLS_Linux(s,t,e);if(n.execute_hooks(),e){const t=n.addresses[s];Object.keys(t).length>0&&(global.init_addresses[s]=t)}}
âœ„
{"version":3,"file":"linux_agent.js","names":["module_library_mapping","log","devlog","getModuleNames","ssl_library_loader","invokeHookingFunction","gnutls_execute","wolfssl_execute","nss_execute","mbedTLS_execute","boring_execute","matrixSSL_execute","moduleNames","socket_library","load_linux_hooking_agent","is_base_hook","hook_Linux_SSL_Libs","regex_libdl","libdl","find","element","match","undefined","Interceptor","attach","Module","getExportByName","onEnter","args","this","moduleName","readCString","onLeave","retval","map","regex","func","test","console","error","hook_Linux_Dynamic_Loader"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["linux_agent.ts"],"mappings":"iCAASA,MAAiD,+CACjDC,YAAKC,MAAc,0CACnBC,wBAAgBC,2BAAoBC,MAA6B,yDACjEC,MAAsB,8CACtBC,MAAuB,2CACvBC,MAAmB,2CACnBC,MAAuB,8CACvBC,MAAsB,2DACtBC,MAAyB,uBAElC,IACIC,EAA6BT,WAE1B,MAAMU,eAAiB,cA6CxB,SAAUC,2BACZd,EAAqC,MAAI,CACrC,CAAC,iBAAkBK,EAAsBK,IACzC,CAAC,eAAgBL,EAAsBK,IACvC,CAAC,kBAAmBL,EAAsBC,IAC1C,CAAC,mBAAoBD,EAAsBE,IAC3C,CAAC,sBAAuBF,EAAsBG,IAC9C,CAAC,mBAAoBH,EAAsBI,IAC3C,CAAC,aAAcJ,EAAsBM,KAb7C,SAA6BX,EAA4Ee,GACrGX,EA5CiB,QA4CkBJ,EAAuBY,EAAY,QAASG,EACnF,CAaIC,CAAoBhB,GAAwB,GArDhD,SAAmCA,EAA4Ee,GAC3G,IACI,MAAME,EAAc,gBACdC,EAAQN,EAAYO,MAAKC,GAAWA,EAAQC,MAAMJ,KACxD,QAAcK,IAAVJ,EACA,KAAM,kCAKVK,YAAYC,OAAOC,OAAOC,gBAAgBR,EAF7B,UAE6C,CACtDS,QAAS,SAAUC,GACfC,KAAKC,WAAaF,EAAK,GAAGG,aAC9B,EACAC,QAAS,SAAUC,GACf,GAAuBX,MAAnBO,KAAKC,WACL,IAAK,IAAII,KAAOlC,EAAqC,MAAG,CACpD,IAAImC,EAAQD,EAAI,GACZE,EAAOF,EAAI,GACXC,EAAME,KAAKR,KAAKC,cAChB7B,EAAI,GAAG4B,KAAKC,oDACZM,EAAKP,KAAKC,WAAYf,G,CAKtC,IAKJuB,QAAQrC,IAAI,mC,CACd,MAAOsC,GACLrC,EAAO,iBAAmBqC,GAC1BtC,EAAI,yC,CAEZ,CAkBIuC,CAA0BxC,GAAwB,EACtD"}
âœ„
import{module_library_mapping as o}from"../shared/shared_structures.js";import{log as s,devlog as i}from"../util/log.js";import{getModuleNames as l,ssl_library_loader as n,invokeHookingFunction as t}from"../shared/shared_functions.js";import{gnutls_execute as r}from"./gnutls_linux.js";import{wolfssl_execute as e}from"./wolfssl_linux.js";import{nss_execute as m}from"./nss_linux.js";import{mbedTLS_execute as u}from"./mbedTLS_linux.js";import{boring_execute as a}from"./openssl_boringssl_linux.js";import{matrixSSL_execute as d}from"./matrixssl_linux.js";var f=l();export const socket_library="libc";export function load_linux_hooking_agent(){o.linux=[[/.*libssl_sb.so/,t(a)],[/.*libssl\.so/,t(a)],[/.*libgnutls\.so/,t(r)],[/.*libwolfssl\.so/,t(e)],[/.*libnspr[0-9]?\.so/,t(m)],[/libmbedtls\.so.*/,t(u)],[/libssl_s.a/,t(d)]],function(o,s){n("linux",o,f,"Linux",s)}(o,!0),function(o,l){try{const i=/.*libdl.*\.so/,n=f.find((o=>o.match(i)));if(void 0===n)throw"Linux Dynamic loader not found!";Interceptor.attach(Module.getExportByName(n,"dlopen"),{onEnter:function(o){this.moduleName=o[0].readCString()},onLeave:function(i){if(null!=this.moduleName)for(let i of o.linux){let o=i[0],n=i[1];o.test(this.moduleName)&&(s(`${this.moduleName} was loaded & will be hooked on Linux!`),n(this.moduleName,l))}}}),console.log("[*] Linux dynamic loader hooked.")}catch(o){i("Loader error: "+o),s("No dynamic loader present for hooking.")}}(o,!1)}
âœ„
{"version":3,"file":"matrixssl_linux.js","names":["matrix_SSL","socket_library","matrix_SSL_Linux","constructor","moduleName","is_base_hook","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","matrixSSL_execute","matrix_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["matrixssl_linux.ts"],"mappings":"qBACQA,MAAkB,mDACjBC,MAAsB,0BAEzB,MAAOC,yBAAyBF,EAElCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CASAO,iCAEA,CAEAC,gBACIF,KAAKG,8BACLH,KAAKI,8BACT,SAKE,SAAUC,kBAAkBR,EAAmBC,GACjD,IAAIQ,EAAa,IAAIX,iBAAiBE,EAAWH,EAAgBI,GAGjE,GAFAQ,EAAWJ,gBAEPJ,EAAc,CACd,MAAMS,EAAiBD,EAAWE,UAAUX,GAExCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAGzD"}
âœ„
import{matrix_SSL as t}from"../ssl_lib/matrixssl.js";import{socket_library as e}from"./linux_agent.js";export class matrix_SSL_Linux extends t{constructor(t,e,s){super(t,e),this.moduleName=t,this.socket_library=e}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function matrixSSL_execute(t,s){var i=new matrix_SSL_Linux(t,e,s);if(i.execute_hooks(),s){const e=i.addresses[t];Object.keys(e).length>0&&(global.init_addresses[t]=e)}}
âœ„
{"version":3,"file":"mbedTLS_linux.js","names":["mbed_TLS","socket_library","mbed_TLS_Linux","constructor","moduleName","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","mbedTLS_execute","is_base_hook","mbedTLS_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["mbedTLS_linux.ts"],"mappings":"mBACQA,MAAgB,iDACfC,MAAsB,0BAEzB,MAAOC,uBAAuBF,EAEhCG,YAAmBC,EAA0BH,GACzCI,MAAMD,EAAWH,GADFK,KAAAF,aAA0BE,KAAAL,gBAE7C,CASAM,iCAEA,CAEAC,gBACIF,KAAKG,8BACLH,KAAKI,8BACT,SAKE,SAAUC,gBAAgBP,EAAmBQ,GAC/C,IAAIC,EAAc,IAAIX,eAAeE,EAAWH,GAGhD,GAFAY,EAAYL,gBAERI,EAAc,CACd,MAAME,EAAiBD,EAAYE,UAAUX,GAEzCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAGzD"}
âœ„
import{mbed_TLS as e}from"../ssl_lib/mbedTLS.js";import{socket_library as t}from"./linux_agent.js";export class mbed_TLS_Linux extends e{constructor(e,t){super(e,t),this.moduleName=e,this.socket_library=t}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function mbedTLS_execute(e,s){var o=new mbed_TLS_Linux(e,t);if(o.execute_hooks(),s){const t=o.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"nss_linux.js","names":["NSS","socket_library","devlog","NSS_Linux","constructor","moduleName","library_method_mapping","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","getDescType","NativeFunction","addresses","module_name","PR_GetNameForIdentity","get_SSL_Callback","PK11_ExtractKeyValue","PK11_GetKeyData","Interceptor","attach","onEnter","args","fd","onLeave","retval","isNull","retValue","keylog_callback","NULL","register_secret_callback","getErrorText","Module","getExportByName","outbuffer","Memory","alloc","console","log","readPointer","originalCallback","ptr","sslSocketFD","ssl_RecordKeyLog","nss_execute","is_base_hook","nss_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["nss_linux.ts"],"mappings":"cACQA,MAAW,6CACVC,MAAsB,oCACjBC,MAAc,wBAEtB,MAAOC,kBAAkBH,EAE3BI,YAAmBC,EAA0BJ,GACzC,IAAIK,EAA2D,GAC/DA,EAAuB,IAAID,MAAiB,CAAC,WAAY,UAAW,2BAA4B,iBAAkB,iBAAkB,wBAAyB,kBAC7JC,EAAuB,YAAc,CAAC,uBAAwB,mBAC9DA,EAAuB,eAAiB,CAAC,eAAgB,mBAAoB,yBAC7EA,EAAuB,IAAIL,MAAqB,CAAC,cAAe,cAAe,QAAS,SAExFM,MAAMF,EAAWJ,EAAeK,GAPjBE,KAAAH,aAA0BG,KAAAP,gBAQ7C,CAGAQ,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCAEIZ,EAAIa,YAAc,IAAIC,eAAeN,KAAKO,UAAUP,KAAKQ,aAA6B,eAAG,MAAO,CAAC,YAGjGhB,EAAIiB,sBAAwB,IAAIH,eAAeN,KAAKO,UAAUP,KAAKQ,aAAoC,sBAAG,UAAW,CAAC,YAKtHhB,EAAIkB,iBAAmB,IAAIJ,eAAeN,KAAKO,UAAUP,KAAKQ,aAAoC,sBAAG,MAAO,CAAC,UAAW,UAAW,YAInIhB,EAAImB,qBAAuB,IAAIL,eAAeN,KAAKO,UAAUP,KAAKQ,aAAmC,qBAAG,MAAO,CAAC,YAChHhB,EAAIoB,gBAAkB,IAAIN,eAAeN,KAAKO,UAAUP,KAAKQ,aAA8B,gBAAG,UAAW,CAAC,YAE1GK,YAAYC,OAAOd,KAAKO,UAAUP,KAAKQ,aAA2B,aAC9D,CACIO,QAAQC,GACJhB,KAAKiB,GAAKD,EAAK,EACnB,EACAE,QAAQC,GAEJ,GAAIA,EAAOC,SACP1B,EAAO,2CADX,CAMA,IAAI2B,EAAW7B,EAAIkB,iBAAiBS,EAAQ3B,EAAI8B,gBAAiBC,MAOjE,GANA/B,EAAIgC,yBAAyBL,GAMzBE,EAAW,EAAG,CACd3B,EAAO,kBACP,IAAI+B,EAAe,IAAInB,eAAeoB,OAAOC,gBAAgB,cAAe,mBAAoB,MAAO,CAAC,YACpGC,EAAYC,OAAOC,MAAM,KAC7BC,QAAQC,IAAI,4BAA8BJ,GAC1CG,QAAQC,IAAI,cAAgBJ,GAC5BH,EAAaG,EAAUK,eACvBvC,EAAO,cAAgBkC,E,MAEvBlC,EAAO,4C,CAGf,IAeRmB,YAAYC,OAAOd,KAAKO,UAAUP,KAAKQ,aAAoC,sBACvE,CACIO,QAAQC,GAEJhB,KAAKkC,iBAAmBlB,EAAK,GAE7BH,YAAYC,OAAOqB,IAAInC,KAAKkC,kBACxB,CACInB,QAAQC,GACJ,IAAIoB,EAAcpB,EAAK,GACvBtB,EAAO,gFACPF,EAAI6C,iBAAiBD,EACzB,EACAlB,QAAQC,GACR,GAGZ,EACAD,QAAQC,GACR,GAKZ,SAKE,SAAUmB,YAAYzC,EAAmB0C,GAC3C,IAAIC,EAAU,IAAI7C,UAAUE,EAAWJ,GAGvC,GAFA+C,EAAQvC,gBAEJsC,EAAc,CACd,MAAME,EAAiBD,EAAQjC,UAAUV,GAErC6C,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAe5C,GAAc4C,E,CAGzD"}
âœ„
import{NSS as e}from"../ssl_lib/nss.js";import{socket_library as t}from"./linux_agent.js";import{devlog as a}from"../util/log.js";export class NSS_Linux extends e{constructor(e,t){var a={};a[`*${e}*`]=["PR_Write","PR_Read","PR_FileDesc2NativeHandle","PR_GetPeerName","PR_GetSockName","PR_GetNameForIdentity","PR_GetDescType"],a["*libnss*"]=["PK11_ExtractKeyValue","PK11_GetKeyData"],a["*libssl*.so"]=["SSL_ImportFD","SSL_GetSessionID","SSL_HandshakeCallback"],a[`*${t}*`]=["getpeername","getsockname","ntohs","ntohl"],super(e,t,a),this.moduleName=e,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){e.getDescType=new NativeFunction(this.addresses[this.module_name].PR_GetDescType,"int",["pointer"]),e.PR_GetNameForIdentity=new NativeFunction(this.addresses[this.module_name].PR_GetNameForIdentity,"pointer",["pointer"]),e.get_SSL_Callback=new NativeFunction(this.addresses[this.module_name].SSL_HandshakeCallback,"int",["pointer","pointer","pointer"]),e.PK11_ExtractKeyValue=new NativeFunction(this.addresses[this.module_name].PK11_ExtractKeyValue,"int",["pointer"]),e.PK11_GetKeyData=new NativeFunction(this.addresses[this.module_name].PK11_GetKeyData,"pointer",["pointer"]),Interceptor.attach(this.addresses[this.module_name].SSL_ImportFD,{onEnter(e){this.fd=e[1]},onLeave(t){if(t.isNull())a("[-] SSL_ImportFD error: unknow null");else{var s=e.get_SSL_Callback(t,e.keylog_callback,NULL);if(e.register_secret_callback(t),s<0){a("Callback Error");var o=new NativeFunction(Module.getExportByName("libnspr4.so","PR_GetErrorText"),"int",["pointer"]),l=Memory.alloc(200);console.log("typeof outbuffer: "+typeof l),console.log("outbuffer: "+l),o(l.readPointer()),a("Error msg: "+l)}else a("[*] keylog callback successfull installed")}}}),Interceptor.attach(this.addresses[this.module_name].SSL_HandshakeCallback,{onEnter(t){this.originalCallback=t[1],Interceptor.attach(ptr(this.originalCallback),{onEnter(t){var s=t[0];a("[*] keylog callback successfull installed via applications callback function"),e.ssl_RecordKeyLog(s)},onLeave(e){}})},onLeave(e){}})}}export function nss_execute(e,a){var s=new NSS_Linux(e,t);if(s.execute_hooks(),a){const t=s.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"openssl_boringssl_linux.js","names":["OpenSSL_BoringSSL","socket_library","OpenSSL_BoringSSL_Linux","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","SSL_CTX_set_keylog_callback","ObjC","available","NativeFunction","addresses","module_name","instance","Interceptor","attach","onEnter","args","keylog_callback","boring_execute","boring_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["openssl_boringssl_linux.ts"],"mappings":"4BACQA,MAAyB,2DACxBC,MAAsB,0BAEzB,MAAOC,gCAAgCF,EAEzCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,EAAeI,GADjBE,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCAEIJ,KAAKK,4BAA8BC,KAAKC,UAAY,IAAIC,eAAeR,KAAKS,UAAUT,KAAKU,aAAwC,0BAAG,OAAQ,CAAC,UAAW,YAAc,IAAIF,eAAeR,KAAKS,UAAUT,KAAKU,aAA0C,4BAAG,OAAQ,CAAC,UAAW,YAChR,IAAIC,EAAWX,KAEfY,YAAYC,OAAOb,KAAKS,UAAUT,KAAKU,aAAsB,QAC7D,CACII,QAAS,SAAUC,GACfJ,EAASN,4BAA4BU,EAAK,GAAItB,EAAkBuB,gBACpE,GAGR,SASE,SAAUC,eAAepB,EAAmBC,GAC9C,IAAIoB,EAAa,IAAIvB,wBAAwBE,EAAWH,EAAgBI,GAGxE,GAFAoB,EAAWjB,gBAEPH,EAAc,CACd,MAAMqB,EAAiBD,EAAWT,UAAUZ,GAExCuB,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAetB,GAAcsB,E,CAIzD"}
âœ„
import{OpenSSL_BoringSSL as e}from"../ssl_lib/openssl_boringssl.js";import{socket_library as t}from"./linux_agent.js";export class OpenSSL_BoringSSL_Linux extends e{constructor(e,t,s){super(e,t,s),this.moduleName=e,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){this.SSL_CTX_set_keylog_callback=ObjC.available?new NativeFunction(this.addresses[this.module_name].SSL_CTX_set_info_callback,"void",["pointer","pointer"]):new NativeFunction(this.addresses[this.module_name].SSL_CTX_set_keylog_callback,"void",["pointer","pointer"]);var t=this;Interceptor.attach(this.addresses[this.module_name].SSL_new,{onEnter:function(s){t.SSL_CTX_set_keylog_callback(s[0],e.keylog_callback)}})}}export function boring_execute(e,s){var o=new OpenSSL_BoringSSL_Linux(e,t,s);if(o.execute_hooks(),s){const t=o.addresses[e];Object.keys(t).length>0&&(global.init_addresses[e]=t)}}
âœ„
{"version":3,"file":"wolfssl_linux.js","names":["WolfSSL","socket_library","toHexString","WolfSSL_Linux","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","wolfSSL_get_client_random","NativeFunction","addresses","module_name","wolfSSL_get_server_random","wolfSSL_SESSION_get_master_key","Interceptor","attach","onEnter","args","ssl","onLeave","retval","session","wolfSSL_get_session","keysString","requiredClientRandomLength","NULL","clientBuffer","Memory","alloc","clientBytes","readByteArray","requiredServerRandomLength","serverBuffer","serverBytes","requiredMasterKeyLength","masterBuffer","masterBytes","message","send","wolfssl_execute","wolf_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/linux/","sources":["wolfssl_linux.ts"],"mappings":"kBACQA,MAAe,iDACdC,MAAsB,yCACtBC,MAAmB,uCAEtB,MAAOC,sBAAsBH,EAE/BI,YAAmBC,EAA0BJ,EAAuBK,GAChEC,MAAMF,EAAWJ,GADFO,KAAAH,aAA0BG,KAAAP,gBAE7C,CAGAQ,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,gCACT,CAEAA,iCACIZ,EAAQa,0BAA4B,IAAIC,eAAeN,KAAKO,UAAUP,KAAKQ,aAAwC,0BAAE,MAAO,CAAC,UAAW,UAAW,QACnJhB,EAAQiB,0BAA4B,IAAIH,eAAeN,KAAKO,UAAUP,KAAKQ,aAAwC,0BAAE,MAAO,CAAC,UAAW,UAAW,QAEnJhB,EAAQkB,+BAAiC,IAAIJ,eAAeN,KAAKO,UAAUP,KAAKQ,aAA6C,+BAAG,MAAO,CAAC,UAAW,UAAW,QAE9JG,YAAYC,OAAOZ,KAAKO,UAAUP,KAAKQ,aAA8B,gBAAE,CACnEK,QAAS,SAASC,GACdd,KAAKe,IAAMD,EAAK,EACpB,EACAE,QAAS,SAASC,GACdjB,KAAKkB,QAAU1B,EAAQ2B,oBAAoBnB,KAAKe,KAEhD,IAAIK,EAAa,GAGbC,EAA6B7B,EAAQa,0BAA0BL,KAAKkB,QAASI,KAAM,GAEnFC,EAAeC,OAAOC,MAAMJ,GAChC7B,EAAQa,0BAA0BL,KAAKe,IAAKQ,EAAcF,GAC1D,IAAIK,EAAcH,EAAaI,cAAcN,GAC7CD,EAAa,GAAGA,mBAA4B1B,EAAYgC,OAGxD,IAAIE,EAA6BpC,EAAQiB,0BAA0BT,KAAKkB,QAASI,KAAM,GACnFO,EAAeL,OAAOC,MAAMG,GAChCpC,EAAQiB,0BAA0BT,KAAKe,IAAKc,EAAcD,GAC1D,IAAIE,EAAcD,EAAaF,cAAcC,GAC7CR,EAAa,GAAGA,mBAA4B1B,EAAYoC,OAGxD,IAAIC,EAA0BvC,EAAQkB,+BAA+BV,KAAKkB,QAASI,KAAM,GACrFU,EAAeR,OAAOC,MAAMM,GAChCvC,EAAQkB,+BAA+BV,KAAKkB,QAASc,EAAcD,GACnE,IAAIE,EAAcD,EAAaL,cAAcI,GAC7CX,EAAa,GAAGA,gBAAyB1B,EAAYuC,OAGrD,IAAIC,EAAqD,CACzDA,YAAyB,UACzBA,EAAgB,OAAId,EACpBe,KAAKD,EAET,GAER,SAKE,SAAUE,gBAAgBvC,EAAmBC,GAC/C,IAAIuC,EAAW,IAAI1C,cAAcE,EAAWJ,EAAgBK,GAG5D,GAFAuC,EAASpC,gBAELH,EAAc,CACd,MAAMwC,EAAiBD,EAAS9B,UAAUV,GAEtC0C,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAezC,GAAcyC,E,CAGzD"}
âœ„
import{WolfSSL as e}from"../ssl_lib/wolfssl.js";import{socket_library as s}from"./linux_agent.js";import{toHexString as t}from"../shared/shared_functions.js";export class WolfSSL_Linux extends e{constructor(e,s,t){super(e,s),this.moduleName=e,this.socket_library=s}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_tls_keys_callback_hook()}install_tls_keys_callback_hook(){e.wolfSSL_get_client_random=new NativeFunction(this.addresses[this.module_name].wolfSSL_get_client_random,"int",["pointer","pointer","int"]),e.wolfSSL_get_server_random=new NativeFunction(this.addresses[this.module_name].wolfSSL_get_server_random,"int",["pointer","pointer","int"]),e.wolfSSL_SESSION_get_master_key=new NativeFunction(this.addresses[this.module_name].wolfSSL_SESSION_get_master_key,"int",["pointer","pointer","int"]),Interceptor.attach(this.addresses[this.module_name].wolfSSL_connect,{onEnter:function(e){this.ssl=e[0]},onLeave:function(s){this.session=e.wolfSSL_get_session(this.ssl);var o="",n=e.wolfSSL_get_client_random(this.session,NULL,0),_=Memory.alloc(n);e.wolfSSL_get_client_random(this.ssl,_,n);var i=_.readByteArray(n);o=`${o}CLIENT_RANDOM: ${t(i)}\n`;var r=e.wolfSSL_get_server_random(this.session,NULL,0),l=Memory.alloc(r);e.wolfSSL_get_server_random(this.ssl,l,r);var a=l.readByteArray(r);o=`${o}SERVER_RANDOM: ${t(a)}\n`;var S=e.wolfSSL_SESSION_get_master_key(this.session,NULL,0),d=Memory.alloc(S);e.wolfSSL_SESSION_get_master_key(this.session,d,S);var c=d.readByteArray(S);o=`${o}MASTER_KEY: ${t(c)}\n`;var h={contentType:"keylog"};h.keylog=o,send(h)}})}}export function wolfssl_execute(e,t){var o=new WolfSSL_Linux(e,s,t);if(o.execute_hooks(),t){const s=o.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"macos_agent.js","names":["module_library_mapping","log","devlog","getModuleNames","ssl_library_loader","invokeHookingFunction","boring_execute","moduleNames","socket_library","load_macos_hooking_agent","is_base_hook","hook_macOS_SSL_Libs","regex_libdl","undefined","find","element","match","Interceptor","attach","Module","getExportByName","onEnter","args","this","moduleName","readCString","onLeave","retval","map","regex","func","test","error","hook_macOS_Dynamic_Loader"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/","sources":["macos_agent.ts"],"mappings":"iCACSA,MAAiD,+CACjDC,YAAKC,MAAc,0CACnBC,wBAAgBC,2BAAoBC,MAA6B,yDACjEC,MAAsB,+BAG/B,IACIC,EAA6BJ,WAE1B,MAAMK,eAAiB,2BAgDxB,SAAUC,2BACZT,EAAqC,OAAI,CACrC,CAAC,wBAAyBK,EAAsBC,KARxD,SAA6BN,EAA4EU,GACrGN,EA9CiB,SA8CkBJ,EAAuBO,EAAY,QAASG,EACnF,CAQIC,CAAoBX,GAAwB,GAjDhD,SAAmCA,EAA4EU,GAC3G,IACI,MAAME,EAAc,oBAEpB,QAAcC,IADAN,EAAYO,MAAKC,GAAWA,EAAQC,MAAMJ,KAEpD,KAAM,mCAKVK,YAAYC,OAAOC,OAAOC,gBAAgB,oBAF7B,UAE2D,CACpEC,QAAS,SAAUC,GACfC,KAAKC,WAAaF,EAAK,GAAGG,aAC9B,EACAC,QAAS,SAAUC,GACf,GAAuBd,MAAnBU,KAAKC,WACL,IAAK,IAAII,KAAO5B,EAAqC,OAAG,CACpD,IAAI6B,EAAQD,EAAI,GACZE,EAAOF,EAAI,GACXC,EAAME,KAAKR,KAAKC,cAChBvB,EAAI,GAAGsB,KAAKC,oDACZM,EAAKP,KAAKC,WAAYd,G,CAKtC,IAKJT,EAAI,+B,CACN,MAAO+B,GACL9B,EAAO,iBAAmB8B,GAC1B/B,EAAI,kD,CAEZ,CAcIgC,CAA0BjC,GAAwB,EACtD"}
âœ„
import{module_library_mapping as o}from"../shared/shared_structures.js";import{log as e,devlog as t}from"../util/log.js";import{getModuleNames as r,ssl_library_loader as i,invokeHookingFunction as n}from"../shared/shared_functions.js";import{boring_execute as a}from"./openssl_boringssl_macos.js";var d=r();export const socket_library="libSystem.B.dylib";export function load_macos_hooking_agent(){o.darwin=[[/.*libboringssl\.dylib/,n(a)]],function(o,e){i("darwin",o,d,"MacOS",e)}(o,!0),function(o,r){try{const t=/libSystem.B.dylib/;if(void 0===d.find((o=>o.match(t))))throw"Darwin Dynamic loader not found!";Interceptor.attach(Module.getExportByName("libSystem.B.dylib","dlopen"),{onEnter:function(o){this.moduleName=o[0].readCString()},onLeave:function(t){if(null!=this.moduleName)for(let t of o.darwin){let o=t[0],i=t[1];o.test(this.moduleName)&&(e(`${this.moduleName} was loaded & will be hooked on MacOS!`),i(this.moduleName,r))}}}),e("MacOS dynamic loader hooked.")}catch(o){t("Loader error: "+o),e("No dynamic loader present for hooking on MacOS.")}}(o,!1)}
âœ„
{"version":3,"file":"openssl_boringssl_macos.js","names":["OpenSSL_BoringSSL","socket_library","OpenSSL_BoringSSL_MacOS","install_tls_keys_callback_hook","console","log","this","addresses","ObjC","available","CALLBACK_OFFSET","foundationNumber","Module","findExportByName","readDouble","undefined","Interceptor","attach","module_name","onEnter","args","ptr","add","writePointer","keylog_callback","constructor","moduleName","is_base_hook","library_method_mapping","super","execute_hooks","boring_execute","boring_ssl","init_addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/macos/","sources":["openssl_boringssl_macos.ts"],"mappings":"4BACQA,MAAyB,2DACxBC,MAAsB,0BAGzB,MAAOC,gCAAgCF,EAEzCG,iCAEI,GADAC,QAAQC,IAAIC,KAAKC,WACbC,KAAKC,UAAW,CAChB,IAAIC,EAAkB,IAElBC,EAAmBC,OAAOC,iBAAiB,iBAAkB,mCAAmCC,aAC7EC,MAApBJ,EACCD,EAAkB,IACZC,GAAoB,WAC1BD,EAAkB,KAEtBM,YAAYC,OAAOX,KAAKC,UAAUD,KAAKY,aAAwC,0BAAG,CAChFC,QAAS,SAAUC,GACjBC,IAAID,EAAK,IAAIE,IAAIZ,GAAiBa,aAAajB,KAAKkB,gBACtD,G,CAKV,CAEAC,YAAmBC,EAA0BzB,EAAuB0B,GAEhE,IAAIC,EAA2D,GAG/DA,EAAuB,IAAIF,MAAiB,CAAC,WAAY,YAAa,aAAc,kBAAmB,qBAAsB,UAAW,6BACxIE,EAAuB,IAAI3B,MAAqB,CAAC,eAAgB,eAAgB,SAAU,UAE3F4B,MAAMH,EAAYzB,EAAgB0B,EAAcC,GARjCtB,KAAAoB,aAA0BpB,KAAAL,gBAS7C,CAEA6B,gBAQIxB,KAAKH,gCACT,SAOE,SAAU4B,eAAeL,EAAmBC,GAC9C,IAAIK,EAAa,IAAI9B,wBAAwBwB,EAAWzB,EAAgB0B,GAGxE,GAFAK,EAAWF,gBAEPH,EAAc,CACd,MAAMM,EAAiBD,EAAWzB,UAAUmB,GAExCQ,OAAOC,KAAKF,GAAgBG,OAAS,IACpCC,OAAeJ,eAAeP,GAAcO,E,CAGzD"}
âœ„
import{OpenSSL_BoringSSL as e}from"../ssl_lib/openssl_boringssl.js";import{socket_library as s}from"./macos_agent.js";export class OpenSSL_BoringSSL_MacOS extends e{install_tls_keys_callback_hook(){if(console.log(this.addresses),ObjC.available){var e=680,s=Module.findExportByName("CoreFoundation","kCFCoreFoundationVersionNumber")?.readDouble();null==s?e=680:s>=1751.108&&(e=696),Interceptor.attach(this.addresses[this.module_name].SSL_CTX_set_info_callback,{onEnter:function(s){ptr(s[0]).add(e).writePointer(this.keylog_callback)}})}}constructor(e,s,o){var t={};t[`*${e}*`]=["SSL_read","SSL_write","BIO_get_fd","SSL_get_session","SSL_SESSION_get_id","SSL_new","SSL_CTX_set_info_callback"],t[`*${s}*`]=["getpeername*","getsockname*","ntohs*","ntohl*"],super(e,s,o,t),this.moduleName=e,this.socket_library=s}execute_hooks(){this.install_tls_keys_callback_hook()}}export function boring_execute(e,o){var t=new OpenSSL_BoringSSL_MacOS(e,s,o);if(t.execute_hooks(),o){const s=t.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"shared_functions.js","names":["log","devlog","AF_INET","AF_INET6","wait_for_library_loaded","module_name","module_adress","Module","findBaseAddress","NULL","setTimeout","ssl_library_loader","plattform_name","module_library_mapping","moduleNames","plattform_os","is_base_hook","map","regex","RegExp","func","module","test","ensureInitialized","error","getSocketLibrary","getModuleNames","Process","platform","find","element","match","enumerateModules","forEach","item","push","name","readAddresses","moduleName","library_method_mapping","resolver","ApiResolver","addresses","library_name","method","matches","enumerateMatches","match_number","method_name","toString","endsWith","substring","length","address","k","readAddresses2","getBaseAddress","console","modules","base","getPortsAndAddresses","sockfd","isRead","methodAddresses","enable_default_fd","message","getpeername","NativeFunction","getsockname","ntohs","ntohl","addrlen","Memory","alloc","addr","src_dst","i","writeU32","readU16","add","readU32","ipv6_addr","offset","readU8","toUpperCase","substr","indexOf","byteArrayToString","byteArray","Array","from","byte","slice","join","toHexString","byteToHex","n","hexOctet","padStart","prototype","call","Uint8Array","reflectionByteArrayToString","result","arrayReflect","Java","use","getLength","get","byteArrayToNumber","value","getAttribute","Instance","fieldName","clazz","field","cast","getClass","getDeclaredField","setAccessible","invokeHookingFunction"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/","sources":["shared_functions.ts"],"mappings":"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"}
âœ„
import{log as e,devlog as r}from"../util/log.js";import{AF_INET as t,AF_INET6 as n}from"./shared_structures.js";function o(r){let t=Module.findBaseAddress(r);t!==NULL&&null!==t||(e("[*] Waiting 5 milliseconds for the loading of "+r),setTimeout(o,5))}export function ssl_library_loader(t,n,s,a,i){for(let d of n[t]){let t=new RegExp(d[0]),n=d[1];for(let d of s)if(t.test(d))try{e(`${d} found & will be hooked on ${a}!`);try{Module.ensureInitialized(d)}catch(e){o(d)}n(d,i)}catch(t){e(`error: skipping module ${d}`),r("Loader error: "+t)}}}export function getSocketLibrary(){var r=getModuleNames();switch(Process.platform){case"linux":return r.find((e=>e.match(/libc.*\.so/)));case"windows":return"WS2_32.dll";case"darwin":return"libSystem.B.dylib";default:return e(`Platform "${Process.platform} currently not supported!`),""}}export function getModuleNames(){var e=[];return Process.enumerateModules().forEach((r=>e.push(r.name))),e}export function readAddresses(e,t){const n=new ApiResolver("module"),o={};o[e]||(o[e]={});for(const s in t)t[s].forEach((function(t){const a=n.enumerateMatches("exports:"+s+"!"+t);let i=0,d=t.toString();if(d.endsWith("*")&&(d=d.substring(0,d.length-1)),0==a.length)throw"Could not find "+s+"!"+t;if(1==a.length)r("Found "+t+" "+a[0].address);else for(let e=0;e<a.length;e++)if(a[e].name.endsWith(d)){i=e,r("Found "+t+" "+a[i].address);break}o[e][d]=a[i].address}));return o}export function readAddresses2(e,t){var n=new ApiResolver("module"),o={};o[e]||(o[e]={});for(let s in t)t[s].forEach((function(t){var a=n.enumerateMatches("exports:"+s+"!"+t),i=0,d=t.toString();if(d.endsWith("*")&&(d=d.substring(0,d.length-1)),0==a.length)throw"Could not find "+s+"!"+t;if(1==a.length)r("Found "+t+" "+a[0].address);else for(var l=0;l<a.length;l++)if(a[l].name.endsWith(d)){r("Found "+t+" "+a[i=l].address);break}o[e][d]=a[i].address}));return o}export function getBaseAddress(e){console.log("Module to find:",e);const r=Process.enumerateModules();for(const t of r)if(t.name==e)return t.base;return null}export function getPortsAndAddresses(e,o,s,a){var i={};if(a&&e<0)return i.src_port=1234,i.src_addr="127.0.0.1",i.dst_port=2345,i.dst_addr="127.0.0.1",i.ss_family="AF_INET",i;for(var d=new NativeFunction(s.getpeername,"int",["int","pointer","pointer"]),l=new NativeFunction(s.getsockname,"int",["int","pointer","pointer"]),u=new NativeFunction(s.ntohs,"uint16",["uint16"]),c=new NativeFunction(s.ntohl,"uint32",["uint32"]),f=Memory.alloc(4),g=Memory.alloc(128),p=["src","dst"],m=0;m<p.length;m++)if(f.writeU32(128),"src"==p[m]!==o?(r("src"),l(e,g,f)):(r("dst"),d(e,g,f)),g.readU16()==t)i[p[m]+"_port"]=u(g.add(2).readU16()),i[p[m]+"_addr"]=c(g.add(4).readU32()),i.ss_family="AF_INET";else{if(g.readU16()!=n)throw r("[-] getPortsAndAddresses resolving error:"+g.readU16()),"Only supporting IPv4/6";i[p[m]+"_port"]=u(g.add(2).readU16()),i[p[m]+"_addr"]="";for(var h=g.add(8),v=0;v<16;v+=1)i[p[m]+"_addr"]+=("0"+h.add(v).readU8().toString(16).toUpperCase()).substr(-2);0===i[p[m]+"_addr"].toString().indexOf("00000000000000000000FFFF")?(i[p[m]+"_addr"]=c(h.add(12).readU32()),i.ss_family="AF_INET"):i.ss_family="AF_INET6"}return i}export function byteArrayToString(e){return Array.from(e,(function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}export function toHexString(e){const r=[];for(let e=0;e<=255;++e){const t=e.toString(16).padStart(2,"0");r.push(t)}return Array.prototype.map.call(new Uint8Array(e),(e=>r[e])).join("")}export function reflectionByteArrayToString(e){for(var r="",t=Java.use("java.lang.reflect.Array"),n=0;n<t.getLength(e);n++)r+=("0"+(255&t.get(e,n)).toString(16)).slice(-2);return r}export function byteArrayToNumber(e){for(var r=0,t=0;t<e.length;t++)r=256*r+(255&e[t]);return r}export function getAttribute(e,r){var t=Java.use("java.lang.Class"),n=Java.cast(e.getClass(),t).getDeclaredField(r);return n.setAccessible(!0),n.get(e)}export function invokeHookingFunction(e){return(r,t)=>{e(r,t)}}
âœ„
{"version":3,"file":"shared_structures.js","names":["module_library_mapping","AF_INET","AF_INET6","pointerSize","Process"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/shared/","sources":["shared_structures.ts"],"mappings":"OAGO,IAAIA,uBAA6E,UAGjF,MAAMC,QAAU,SAChB,MAAMC,SAAW,UACjB,MAAMC,YAAcC,QAAQD"}
âœ„
export var module_library_mapping={};export const AF_INET=2;export const AF_INET6=10;export const pointerSize=Process.pointerSize;
âœ„
{"version":3,"file":"gnutls.js","names":["readAddresses","getPortsAndAddresses","getBaseAddress","log","offsets","enable_default_fd","GnuTLS","constructor","moduleName","socket_library","passed_library_method_mapping","this","library_method_mapping","addresses","module_name","gnutls","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","gnutls_transport_get_int","NativeFunction","gnutls_session_get_id","gnutls_session_set_keylog_function","gnutls_session_get_random","static","session","len_pointer","Memory","alloc","err","NULL","len","readU32","p","session_id","i","readU8","toString","toUpperCase","substr","install_plaintext_read_hook","current_module_name","lib_addesses","Interceptor","attach","onEnter","args","message","getSslSessionId","buf","onLeave","retval","send","readByteArray","install_plaintext_write_hook","parseInt","install_tls_keys_callback_hook","keylog_callback","NativeCallback","label","secret","secret_len","Process","pointerSize","readUInt","secret_str","readPointer","server_random_ptr","client_random_ptr","console","client_random_str","readCString"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["gnutls.ts"],"mappings":"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"}
âœ„
import{readAddresses as s,getPortsAndAddresses as e,getBaseAddress as t}from"../shared/shared_functions.js";import{log as n}from"../util/log.js";import{offsets as o,enable_default_fd as i}from"../ssl_log.js";export class GnuTLS{constructor(e,i,r){if(this.moduleName=e,this.socket_library=i,this.passed_library_method_mapping=r,this.library_method_mapping={},void 0!==r?this.library_method_mapping=r:(this.library_method_mapping[`*${e}*`]=["gnutls_record_recv","gnutls_record_send","gnutls_session_set_keylog_function","gnutls_transport_get_int","gnutls_session_get_id","gnutls_init","gnutls_handshake","gnutls_session_get_keylog_function","gnutls_session_get_random"],this.library_method_mapping[`*${i}*`]=["getpeername","getsockname","ntohs","ntohl"]),this.addresses=s(e,this.library_method_mapping),this.module_name=e,"{OFFSETS}"!=o&&null!=o.gnutls){if(null!=o.sockets){const s=t(i);for(const e of Object.keys(o.sockets))this.addresses[this.moduleName][`${e}`]=o.sockets[`${e}`].absolute||null==s?ptr(o.sockets[`${e}`].address):s.add(ptr(o.sockets[`${e}`].address))}const s=t(e);null==s&&n("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const e of Object.keys(o.gnutls))this.addresses[this.moduleName][`${e}`]=o.gnutls[`${e}`].absolute||null==s?ptr(o.gnutls[`${e}`].address):s.add(ptr(o.gnutls[`${e}`].address))}GnuTLS.gnutls_transport_get_int=new NativeFunction(this.addresses[this.moduleName].gnutls_transport_get_int,"int",["pointer"]),GnuTLS.gnutls_session_get_id=new NativeFunction(this.addresses[this.moduleName].gnutls_session_get_id,"int",["pointer","pointer","pointer"]),GnuTLS.gnutls_session_set_keylog_function=new NativeFunction(this.addresses[this.moduleName].gnutls_session_set_keylog_function,"void",["pointer","pointer"]),GnuTLS.gnutls_session_get_random=new NativeFunction(this.addresses[this.moduleName].gnutls_session_get_random,"pointer",["pointer","pointer","pointer"])}static getSslSessionId(s){var e=Memory.alloc(4),t=GnuTLS.gnutls_session_get_id(s,NULL,e);if(0!=t)return i?(n("using dummy SessionID: 59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76337"),"59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76337"):"";var o=e.readU32(),r=Memory.alloc(o);if(0!=(t=GnuTLS.gnutls_session_get_id(s,r,e)))return i?(n("using dummy SessionID: 59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76337"),"59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76337"):"";for(var a="",l=0;l<o;l++)a+=("0"+r.add(l).readU8().toString(16).toUpperCase()).substr(-2);return a}install_plaintext_read_hook(){var s=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].gnutls_record_recv,{onEnter:function(n){var o=e(GnuTLS.gnutls_transport_get_int(n[0]),!0,t[s],i);o.ssl_session_id=GnuTLS.getSslSessionId(n[0]),o.function="SSL_read",this.message=o,this.buf=n[1]},onLeave:function(s){(s|=0)<=0||(this.message.contentType="datalog",send(this.message,this.buf.readByteArray(s)))}})}install_plaintext_write_hook(){var s=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].gnutls_record_send,{onEnter:function(n){var o=e(GnuTLS.gnutls_transport_get_int(n[0]),!1,t[s],i);o.ssl_session_id=GnuTLS.getSslSessionId(n[0]),o.function="SSL_write",o.contentType="datalog",send(o,n[1].readByteArray(parseInt(n[2])))},onLeave:function(s){}})}install_tls_keys_callback_hook(){}}GnuTLS.keylog_callback=new NativeCallback((function(s,e,t){for(var n={contentType:"keylog"},o=t.add(Process.pointerSize).readUInt(),i="",r=t.readPointer(),a=0;a<o;a++)i+=("0"+r.add(a).readU8().toString(16).toUpperCase()).substr(-2);var l=Memory.alloc(Process.pointerSize+4),d=Memory.alloc(Process.pointerSize+4);void 0!==this?GnuTLS.gnutls_session_get_random(s,d,l):console.log("[-] Error while installing keylog callback");var _="";for(r=d.readPointer(),a=0;a<32;a++)_+=("0"+r.add(a).readU8().toString(16).toUpperCase()).substr(-2);return n.keylog=e.readCString()+" "+_+" "+i,send(n),0}),"int",["pointer","pointer","pointer"]);
âœ„
{"version":3,"file":"java_ssl_libs.js","names":["log","devlog","conscrypt_execute","isAndroid","SSL_Java","install_java_hooks","Java","available","setTimeout","perform","Security","use","getProviders","toString","includes","Process","id","removeProvider","insertProviderAt","implementation","provider","position","getName","this","addProvider"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["java_ssl_libs.ts"],"mappings":"cAASA,YAAKC,MAAc,mCACRC,MAAyB,8CACpCC,MAAiB,kCAGpB,MAAOC,SAETC,qBACQC,KAAKC,WACLC,YAAW,WACPF,KAAKG,SAAQ,WAGT,IAAIC,EAAWJ,KAAKK,IAAI,0BACpBD,EAASE,eAAeC,WAAWC,SAAS,qBAC5Cd,EAAI,gBAAkBe,QAAQC,GAAK,2LACnCN,EAASO,eAAe,mBACxBjB,EAAI,4BAKRE,IAGIQ,EAASE,eAAeC,WAAWC,SAAS,eAC5Cd,EAAI,mEACJU,EAASO,eAAe,aACxBjB,EAAI,sBAIJU,EAASE,eAAeC,WAAWC,SAAS,uBAC5Cd,EAAI,sBACJU,EAASO,eAAe,aACxBjB,EAAI,sBAIHU,EAASE,eAAeC,WAAWC,SAAS,qBAC7Cd,EAAI,4BACJU,EAASO,eAAe,mBACxBjB,EAAI,4BAMRC,EAAO,cAAgBS,EAASE,eAAeC,YAK/CH,EAASQ,iBAAiBC,eAAiB,SAAUC,EAAeC,GAChE,OAAID,EAASE,UAAUR,SAAS,cAAgBM,EAASE,UAAUR,SAAS,cAAgBM,EAASE,UAAUR,SAAS,oBAAqBM,EAASE,UAAUR,SAAS,oBACrKd,EAAI,yDAA2DoB,EAASE,WACjED,GAEAE,KAAKL,iBAAiBE,EAAUC,EAE/C,EAEAX,EAASQ,iBAAiBC,eAAiB,SAAUC,GACjD,OAAIA,EAASE,UAAUR,SAAS,cAAgBM,EAASE,UAAUR,SAAS,cAAgBM,EAASE,UAAUR,SAAS,oBAAsBM,EAASE,UAAUR,SAAS,oBACtKd,EAAI,mDAAqDoB,EAASE,WAC3D,GAGHnB,KAK2B,gBAAvBiB,EAASE,UACFC,KAAKL,iBAAiBE,EAAU,GASxCG,KAAKC,YAAYJ,EAEhC,CACJ,GACJ,GAAG,EAEX"}
âœ„
import{log as e,devlog as r}from"../util/log.js";import{execute as o}from"../android/conscrypt.js";import{isAndroid as i}from"../util/process_infos.js";export class SSL_Java{install_java_hooks(){Java.available&&setTimeout((function(){Java.perform((function(){var t=Java.use("java.security.Security");t.getProviders().toString().includes("GmsCore_OpenSSL")&&(e("WARNING: PID "+Process.id+" Detected GmsCore_OpenSSL Provider. This can be a bit unstable. If you having issues, rerun with -spawn for early instrumentation. Trying to remove it to fall back on default Provider"),t.removeProvider("GmsCore_OpenSSL"),e("Removed GmsCore_OpenSSL")),o(),t.getProviders().toString().includes("Ssl_Guard")&&(e("Ssl_Guard deteced, removing it to fall back on default Provider"),t.removeProvider("Ssl_Guard"),e("Removed Ssl_Guard")),t.getProviders().toString().includes("Conscrypt version")&&(e("Conscrypt detected"),t.removeProvider("Conscrypt"),e("Removed Conscrypt")),t.getProviders().toString().includes("WolfSSLProvider")&&(e("WolfSSLProvider detected"),t.removeProvider("WolfSSLProvider"),e("Removed WolfSSLProvider")),r("Remaining: "+t.getProviders().toString()),t.insertProviderAt.implementation=function(r,o){return r.getName().includes("Conscrypt")||r.getName().includes("Ssl_Guard")||r.getName().includes("GmsCore_OpenSSL")||r.getName().includes("WolfSSLProvider")?(e("Blocking provider registration (insertProviderAt) of  "+r.getName()),o):this.insertProviderAt(r,o)},t.insertProviderAt.implementation=function(r){return r.getName().includes("Conscrypt")||r.getName().includes("Ssl_Guard")||r.getName().includes("GmsCore_OpenSSL")||r.getName().includes("WolfSSLProvider")?(e("Blocking provider registration (addProvider) of "+r.getName()),1):i()&&"AndroidNSSP"===r.getName()?this.insertProviderAt(r,1):this.addProvider(r)}}))}),0)}}
âœ„
{"version":3,"file":"matrixssl.js","names":["readAddresses","getPortsAndAddresses","getBaseAddress","enable_default_fd","offsets","log","matrix_SSL","constructor","moduleName","socket_library","passed_library_method_mapping","this","library_method_mapping","addresses","module_name","matrixssl","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","matrixSslNewCLientSession","NativeFunction","matrixSslGetSid","install_plaintext_read_hook","current_module_name","lib_addesses","Interceptor","attach","onEnter","args","buffer","len","message","fd","undefined","sessionId","getSessionId","onLeave","retval","data","readByteArray","send","install_plaintext_write_hook","outBuffer","outBufferLength","install_tls_keys_callback_hook","install_helper_hook","sslSessionPointer","sessionIdLength","Process","pointerSize","readU32","readPointer","readCString","ssl","sid"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["matrixssl.ts"],"mappings":"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"}
âœ„
import{readAddresses as e,getPortsAndAddresses as s,getBaseAddress as t}from"../shared/shared_functions.js";import{enable_default_fd as i,offsets as r}from"../ssl_log.js";import{log as a}from"../util/log.js";export class matrix_SSL{constructor(s,i,o){if(this.moduleName=s,this.socket_library=i,this.passed_library_method_mapping=o,this.library_method_mapping={},void 0!==o?this.library_method_mapping=o:(this.library_method_mapping[`*${s}*`]=["matrixSslReceivedData","matrixSslGetWritebuf","matrixSslGetSid","matrixSslEncodeWritebuf"],this.library_method_mapping[`*${i}*`]=["getpeername","getsockname","ntohs","ntohl","socket"]),this.addresses=e(s,this.library_method_mapping),this.module_name=s,"{OFFSETS}"!=r&&null!=r.matrixssl){if(null!=r.sockets){const e=t(i);for(const s of Object.keys(r.sockets))this.addresses[this.moduleName][`${s}`]=r.sockets[`${s}`].absolute||null==e?ptr(r.sockets[`${s}`].address):e.add(ptr(r.sockets[`${s}`].address))}const e=t(s);null==e&&a("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const s of Object.keys(r.matrixssl))this.addresses[this.moduleName][`${s}`]=r.matrixssl[`${s}`].absolute||null==e?ptr(r.matrixssl[`${s}`].address):e.add(ptr(r.matrixssl[`${s}`].address))}matrix_SSL.matrixSslNewCLientSession=new NativeFunction(this.addresses[this.moduleName].matrixSslNewClientSession,"int",["pointer","pointer","pointer","pointer","int","pointer","pointer","pointer","pointer","pointer"]),matrix_SSL.matrixSslGetSid=new NativeFunction(this.addresses[this.moduleName].matrixSslGetSid,"pointer",["pointer"])}install_plaintext_read_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].matrixSslReceivedData,{onEnter:function(r){this.buffer=r[2],this.len=r[3];var a=s(this.fd,!0,t[e],i);a.ssl_session_id=void 0===this.addresses[this.moduleName].matrixSslGetSid?matrix_SSL.sessionId:this.getSessionId(r[0]),a.function="matrixSslReceivedData",this.message=a},onLeave:function(e){if(!((e|=0)<=0)){var s=this.buffer.readByteArray(this.len);this.message.contentType="datalog",send(this.message,s)}}})}install_plaintext_write_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].matrixSslGetWritebuf,{onEnter:function(e){this.outBuffer=e[1]},onLeave:function(e){(e|=0)<=0||(this.outBufferLength=e)}}),Interceptor.attach(this.addresses[this.moduleName].matrixSslEncodeWritebuf,{onEnter:function(r){var a=this.outBuffer.readByteArray(this.outBufferLength),o=s(this.fd,!1,t[e],i);o.ssl_session_id=void 0===this.addresses[this.moduleName].matrixSslGetSid?matrix_SSL.sessionId:this.getSessionId(r[0]),o.function="matrixSslEncodeWritebuf",o.contentType="datalog",send(o,a)}})}install_tls_keys_callback_hook(){}install_helper_hook(){Interceptor.attach(this.addresses[this.moduleName].matrixSslNewSessionId,{onEnter:function(e){this.sslSessionPointer=e[0]},onLeave:function(e){if(!((e|=0)<=0)){var s=this.sslSessionPointer.add(2*Process.pointerSize).readU32();matrix_SSL.sessionId=this.sslSessionPointer.add(Process.pointerSize).readPointer().readCString(s)}}}),Interceptor.attach(this.addresses[this.moduleName].connect,{onEnter:function(e){},onLeave:function(e){(e|=0)<=0||(this.fd=e)}})}getSessionId(e){const s=matrix_SSL.matrixSslGetSid(e),t=s.add(2*Process.pointerSize).readU32();return s.add(Process.pointerSize).readPointer().readCString(t)}}
âœ„
{"version":3,"file":"mbedTLS.js","names":["readAddresses","getPortsAndAddresses","getBaseAddress","offsets","enable_default_fd","log","mbed_TLS","constructor","moduleName","socket_library","passed_library_method_mapping","this","library_method_mapping","addresses","module_name","mbedtls","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","static","sslcontext","conf","readPointer","state","Process","pointerSize","readS32","renego_status","renego_records_seen","major_ver","minor_ver","badmac_seen","readU32","f_send","f_recv","f_recv_timeout","p_bio","platform","session_in","session_out","session","start","ciphersuite","compression","id_len","id","readByteArray","parse_mbedtls_ssl_context_struct","ssl_context","session_id","byteCounter","unwrap","readU8","toString","toUpperCase","install_plaintext_read_hook","current_module_name","lib_addesses","Interceptor","attach","onEnter","args","buffer","len","sslContext","message","getSocketDescriptor","getSessionId","onLeave","retval","data","send","install_plaintext_write_hook","install_tls_keys_callback_hook"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["mbedTLS.ts"],"mappings":"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"}
âœ„
import{readAddresses as e,getPortsAndAddresses as s,getBaseAddress as t}from"../shared/shared_functions.js";import{offsets as r,enable_default_fd as d}from"../ssl_log.js";import{log as o}from"../util/log.js";export class mbed_TLS{constructor(s,d,i){if(this.moduleName=s,this.socket_library=d,this.passed_library_method_mapping=i,this.library_method_mapping={},void 0!==i?this.library_method_mapping=i:(this.library_method_mapping[`*${s}*`]=["mbedtls_ssl_read","mbedtls_ssl_write"],this.library_method_mapping[`*${d}*`]=["getpeername","getsockname","ntohs","ntohl"]),this.addresses=e(s,this.library_method_mapping),this.module_name=s,"{OFFSETS}"!=r&&null!=r.mbedtls){if(null!=r.sockets){const e=t(d);for(const s of Object.keys(r.sockets))this.addresses[this.moduleName][`${s}`]=r.sockets[`${s}`].absolute||null==e?ptr(r.sockets[`${s}`].address):e.add(ptr(r.sockets[`${s}`].address))}const e=t(s);null==e&&o("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const s of Object.keys(r.mbedtls))this.addresses[this.moduleName][`${s}`]=r.mbedtls[`${s}`].absolute||null==e?ptr(r.mbedtls[`${s}`].address):e.add(ptr(r.mbedtls[`${s}`].address))}}static parse_mbedtls_ssl_context_struct(e){return{conf:e.readPointer(),state:e.add(Process.pointerSize).readS32(),renego_status:e.add(Process.pointerSize+4).readS32(),renego_records_seen:e.add(Process.pointerSize+4+4).readS32(),major_ver:e.add(Process.pointerSize+4+4+4).readS32(),minor_ver:e.add(Process.pointerSize+4+4+4+4).readS32(),badmac_seen:e.add(Process.pointerSize+4+4+4+4+4).readU32(),f_send:e.add(Process.pointerSize+4+4+4+4+4+4).readPointer(),f_recv:e.add(Process.pointerSize+4+4+4+4+4+4+Process.pointerSize).readPointer(),f_recv_timeout:e.add(Process.pointerSize+4+4+4+4+4+4+2*Process.pointerSize).readPointer(),p_bio:e.add("windows"==Process.platform?48:56).readPointer(),session_in:e.add(Process.pointerSize+4+4+4+4+4+4+4*Process.pointerSize).readPointer(),session_out:e.add(Process.pointerSize+4+4+4+4+4+4+5*Process.pointerSize).readPointer(),session:{start:e.add(24+7*Process.pointerSize).readPointer().readPointer(),ciphersuite:e.add(24+7*Process.pointerSize).readPointer().add(8).readS32(),compression:e.add(24+7*Process.pointerSize).readPointer().add(12).readS32(),id_len:e.add(24+7*Process.pointerSize).readPointer().add(16).readU32(),id:e.add(24+7*Process.pointerSize).readPointer().add(20).readByteArray(e.add(24+7*Process.pointerSize).readPointer().add(16).readU32())}}}static getSocketDescriptor(e){return mbed_TLS.parse_mbedtls_ssl_context_struct(e).p_bio.readS32()}static getSessionId(e){for(var s=mbed_TLS.parse_mbedtls_ssl_context_struct(e),t="",r=0;r<s.session.id_len;r++)t=`${t}${s.session.id?.unwrap().add(r).readU8().toString(16).toUpperCase()}`;return t}install_plaintext_read_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].mbedtls_ssl_read,{onEnter:function(r){this.buffer=r[1],this.len=r[2],this.sslContext=r[0];var o=s(mbed_TLS.getSocketDescriptor(r[0]),!0,t[e],d);o.ssl_session_id=mbed_TLS.getSessionId(r[0]),o.function="mbedtls_ssl_read",this.message=o},onLeave:function(e){if(!((e|=0)<=0)){var s=this.buffer.readByteArray(e);this.message.contentType="datalog",send(this.message,s)}}})}install_plaintext_write_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].mbedtls_ssl_write,{onEnter:function(r){var o=r[1],i=r[2];if(!((i|=0)<=0)){var a=o.readByteArray(i),n=s(mbed_TLS.getSocketDescriptor(r[0]),!1,t[e],d);n.ssl_session_id=mbed_TLS.getSessionId(r[0]),n.function="mbedtls_ssl_write",n.contentType="datalog",send(n,a)}}})}install_tls_keys_callback_hook(){}}
âœ„
{"version":3,"file":"nss.js","names":["readAddresses","getBaseAddress","pointerSize","AF_INET","AF_INET6","log","devlog","offsets","enable_default_fd","readU32","readU64","readPointer","writeU32","writeU64","writePointer","NativePointer","prototype","SECStatus","PRDescType","NSS","constructor","moduleName","socket_library","passed_library_method_mapping","this","library_method_mapping","addresses","module_name","nss","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","SSL_SESSION_get_id","NativeFunction","getsockname","getpeername","static","secitem","type","data","len","sslSocketFD","fd","version","handshakeCallback","secretCallback","ssl3","ssl3_struct","crSpec","prSpec","cwSpec","pwSpec","peerRequestedKeyUpdate","keyUpdateDeferred","deferredKeyUpdateRequest","clientCertRequested","clientCertificate","clientPrivateKey","clientCertChain","sendEmptyCert","policy","peerCertArena","peerCertChain","ca_list","hs","server_random","client_random","client_inner_random","ws","hashType","messages","space","fixed","echInnerMessages","md5","sha","shaEchInner","shaPostHandshake","signatureScheme","kea_def","cipher_suite","suite_def","msg_body","header_bytes","msg_type","msg_len","isResuming","sendingSCSV","receivedNewSessionTicket","newSessionTicket","finishedBytes","finishedMsgs","authCertificatePending","restartTarget","canFalseStart","preliminaryInfo","remoteExtensions","next","prev","echOuterExtensions","sendMessageSeq","lastMessageFlight","maxMessageSent","readU16","recvMessageSeq","recvdFragments","recvdHighWater","cookie","times_array","rtTimer","ackTimer","hdTimer","rtRetries","srvVirtName","currentSecret","resumptionMasterSecret","dheSecret","clientEarlyTrafficSecret","clientHsTrafficSecret","serverHsTrafficSecret","clientTrafficSecret","serverTrafficSecret","earlyExporterSecret","exporterSecret","link","refCt","direction","recordVersion","cipherDef","macDef","cipher","cipherContext","master_secret","sockfd","isRead","methodAddresses","message","ntohs","ntohl","addrlen","Memory","alloc","addr","src_dst","i","length","ipv6_addr","offset","readU8","toString","toUpperCase","substr","indexOf","ptr_addr","error","pRFileDesc","layer_name","lower_ptr","higher_ptr","identity","isNull","PR_GetNameForIdentity","readCString","NULL","NSS_FindIdentityForName","session_id_ptr","session_id","ssl_layer","Module","getExportByName","getIdentitiesLayer","readAddr","secret_str","toLowerCase","dummySSL_SessionID","fdType","getDescType","layer","sslSessionIdSECItem","c","dup","getLayersIdentity","getNameOfIdentityLayer","layerID","nameIDentity","sslSessionIdSECItem2","getSSL_Layer","startsWith","sslSessionIdSECItem3","sslSessionIdSECItem4","hexdump","getSessionIdString","get_SSL_Socket","masterSecret_Ptr","parse_struct_sl3CipherSpecStr","get_Secret_As_HexString","getHexString","SSL3_RANDOM_LENGTH","sslSocket","get_SSL_FD","secret_key_Ptr","PK11_ExtractKeyValue","SECSuccess","keyData","PK11_GetKeyData","keyData_SECITem","parse_struct_SECItem","ssl_version_internal_Code","key","dumping_handshake_secrets","parse_struct_sslSocketStr","parse_struct_ssl3Str","getClientRandom","doTLS13_RTT0","early_exporter_secret","get_Keylog_Dump","send","client_handshake_traffic_secret","server_handshake_traffic_secret","client_early_traffic_secret","get_SSL_Version","is_TLS_1_3","client_traffic_secret","server_traffic_secret","exporter_secret","getMasterSecret","getTLS_Keys","install_plaintext_read_hook","current_module_name","lib_addesses","Interceptor","attach","onEnter","args","buf","onLeave","retval","toInt32","PR_DESC_FILE","getPortsAndAddressesFromNSS","getSslSessionIdFromFD","readByteArray","Uint32Array","temp","JSON","stringify","install_plaintext_write_hook","parseInt","epoch","addr_of_installed_secretCallback","parse_epoch_value_from_SSL_SetSecretCallback","sslSocketStr","is_ptr_at_mem_location","insert_hook_into_secretCallback","secret_callback","install_tls_keys_callback_hook","keylog_callback","NativeCallback","client_data","ssl_RecordKeyLog","console","dir","secret","arg_ptr"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["nss.ts"],"mappings":"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"}
âœ„
import{readAddresses as e,getBaseAddress as t}from"../shared/shared_functions.js";import{pointerSize as r,AF_INET as a,AF_INET6 as d}from"../shared/shared_structures.js";import{log as s,devlog as i}from"../util/log.js";import{offsets as S,enable_default_fd as n}from"../ssl_log.js";const{readU32:o,readU64:_,readPointer:l,writeU32:c,writeU64:g,writePointer:p}=NativePointer.prototype;export var SECStatus;!function(e){e[e.SECWouldBlock=-2]="SECWouldBlock",e[e.SECFailure=-1]="SECFailure",e[e.SECSuccess=0]="SECSuccess"}(SECStatus||(SECStatus={}));export var PRDescType;!function(e){e[e.PR_DESC_FILE=1]="PR_DESC_FILE",e[e.PR_DESC_SOCKET_TCP=2]="PR_DESC_SOCKET_TCP",e[e.PR_DESC_SOCKET_UDP=3]="PR_DESC_SOCKET_UDP",e[e.PR_DESC_LAYERED=4]="PR_DESC_LAYERED",e[e.PR_DESC_PIPE=5]="PR_DESC_PIPE"}(PRDescType||(PRDescType={}));export class NSS{constructor(r,a,d){if(this.moduleName=r,this.socket_library=a,this.passed_library_method_mapping=d,this.library_method_mapping={},void 0!==d?this.library_method_mapping=d:(this.library_method_mapping[`*${r}*`]=["PR_Write","PR_Read","PR_FileDesc2NativeHandle","PR_GetPeerName","PR_GetSockName","PR_GetNameForIdentity","PR_GetDescType"],this.library_method_mapping["*libnss*"]=["PK11_ExtractKeyValue","PK11_GetKeyData"],this.library_method_mapping["*libssl*.so"]=["SSL_ImportFD","SSL_GetSessionID","SSL_HandshakeCallback"],this.library_method_mapping[`*${a}*`]=["getpeername","getsockname","ntohs","ntohl"]),this.addresses=e(r,this.library_method_mapping),this.module_name=r,"{OFFSETS}"!=S&&null!=S.nss){if(null!=S.sockets){const e=t(a);for(const t of Object.keys(S.sockets))this.addresses[this.moduleName][`${t}`]=S.sockets[`${t}`].absolute||null==e?ptr(S.sockets[`${t}`].address):e.add(ptr(S.sockets[`${t}`].address))}const e=t(r);null==e&&s("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const t of Object.keys(S.nss))this.addresses[this.moduleName][`${t}`]=S.nss[`${t}`].absolute||null==e?ptr(S.nss[`${t}`].address):e.add(ptr(S.nss[`${t}`].address))}NSS.SSL_SESSION_get_id=new NativeFunction(this.addresses[this.moduleName].SSL_GetSessionID,"pointer",["pointer"]),NSS.getsockname=new NativeFunction(this.addresses[this.moduleName].PR_GetSockName,"int",["pointer","pointer"]),NSS.getpeername=new NativeFunction(this.addresses[this.moduleName].PR_GetPeerName,"int",["pointer","pointer"])}static parse_struct_SECItem(e){return{type:e.readU64(),data:e.add(r).readPointer(),len:e.add(2*r).readU32()}}static parse_struct_sslSocketStr(e){return{fd:e.readPointer(),version:e.add(160),handshakeCallback:e.add(464),secretCallback:e.add(568),ssl3:e.add(1432)}}static parse_struct_ssl3Str(e){return{crSpec:e.readPointer(),prSpec:e.add(r).readPointer(),cwSpec:e.add(2*r).readPointer(),pwSpec:e.add(3*r).readPointer(),peerRequestedKeyUpdate:e.add(4*r).readU32(),keyUpdateDeferred:e.add(4*r+4).readU32(),deferredKeyUpdateRequest:e.add(4*r+8).readU32(),clientCertRequested:e.add(4*r+12).readU32(),clientCertificate:e.add(4*r+16).readPointer(),clientPrivateKey:e.add(5*r+16).readPointer(),clientCertChain:e.add(6*r+16).readPointer(),sendEmptyCert:e.add(7*r+16).readU32(),policy:e.add(7*r+20).readU32(),peerCertArena:e.add(7*r+24).readPointer(),peerCertChain:e.add(8*r+24).readPointer(),ca_list:e.add(9*r+24).readPointer(),hs:{server_random:e.add(10*r+24),client_random:e.add(10*r+56),client_inner_random:e.add(10*r+88),ws:e.add(10*r+120).readU32(),hashType:e.add(10*r+124).readU32(),messages:{data:e.add(10*r+128).readPointer(),len:e.add(11*r+128).readU32(),space:e.add(11*r+132).readU32(),fixed:e.add(11*r+136).readU32()},echInnerMessages:{data:e.add(11*r+140).readPointer(),len:e.add(12*r+140).readU32(),space:e.add(12*r+144).readU32(),fixed:e.add(12*r+148).readU32()},md5:e.add(12*r+152).readPointer(),sha:e.add(13*r+152).readPointer(),shaEchInner:e.add(14*r+152).readPointer(),shaPostHandshake:e.add(15*r+152).readPointer(),signatureScheme:e.add(16*r+152).readU32(),kea_def:e.add(16*r+156).readPointer(),cipher_suite:e.add(17*r+156).readU32(),suite_def:e.add(17*r+160).readPointer(),msg_body:{data:e.add(18*r+160).readPointer(),len:e.add(19*r+160).readU32(),space:e.add(19*r+164).readU32(),fixed:e.add(19*r+168).readU32()},header_bytes:e.add(19*r+172).readU32(),msg_type:e.add(19*r+176).readU32(),msg_len:e.add(19*r+180).readU32(),isResuming:e.add(19*r+184).readU32(),sendingSCSV:e.add(19*r+188).readU32(),receivedNewSessionTicket:e.add(19*r+192).readU32(),newSessionTicket:e.add(19*r+196),finishedBytes:e.add(19*r+240).readU32(),finishedMsgs:e.add(19*r+244),authCertificatePending:e.add(18*r+316).readU32(),restartTarget:e.add(19*r+320).readU32(),canFalseStart:e.add(19*r+324).readU32(),preliminaryInfo:e.add(19*r+328).readU32(),remoteExtensions:{next:e.add(19*r+332).readPointer(),prev:e.add(20*r+332).readPointer()},echOuterExtensions:{next:e.add(21*r+332).readPointer(),prev:e.add(22*r+332).readPointer()},sendMessageSeq:e.add(23*r+332).readU32(),lastMessageFlight:{next:e.add(23*r+336).readPointer(),prev:e.add(24*r+336).readPointer()},maxMessageSent:e.add(25*r+336).readU16(),recvMessageSeq:e.add(25*r+338).readU16(),recvdFragments:{data:e.add(25*r+340).readPointer(),len:e.add(26*r+340).readU32(),space:e.add(26*r+344).readU32(),fixed:e.add(26*r+348).readU32()},recvdHighWater:e.add(26*r+352).readU32(),cookie:{type:e.add(26*r+356).readU64(),data:e.add(27*r+356).readPointer(),len:e.add(28*r+356).readU32()},times_array:e.add(28*r+360).readU32(),rtTimer:e.add(28*r+432).readPointer(),ackTimer:e.add(29*r+432).readPointer(),hdTimer:e.add(30*r+432).readPointer(),rtRetries:e.add(31*r+432).readU32(),srvVirtName:{type:e.add(31*r+436).readU64(),data:e.add(32*r+436).readPointer(),len:e.add(33*r+436).readU32()},currentSecret:e.add(33*r+440).readPointer(),resumptionMasterSecret:e.add(34*r+440).readPointer(),dheSecret:e.add(35*r+440).readPointer(),clientEarlyTrafficSecret:e.add(36*r+440).readPointer(),clientHsTrafficSecret:e.add(37*r+440).readPointer(),serverHsTrafficSecret:e.add(38*r+440).readPointer(),clientTrafficSecret:e.add(39*r+440).readPointer(),serverTrafficSecret:e.add(40*r+440).readPointer(),earlyExporterSecret:e.add(41*r+440).readPointer(),exporterSecret:e.add(42*r+440).readPointer()}}}static parse_struct_sl3CipherSpecStr(e){return{link:e.add,refCt:e.add(2*r),direction:e.add(2*r+4),version:e.add(2*r+8),recordVersion:e.add(2*r+12),cipherDef:e.add(2*r+16).readPointer(),macDef:e.add(3*r+16).readPointer(),cipher:e.add(4*r+16),cipherContext:e.add(4*r+24).readPointer(),master_secret:e.add(5*r+24).readPointer()}}static getPortsAndAddressesFromNSS(e,t,r,s){var S={};if(s&&null===e)return S.src_port=1234,S.src_addr="127.0.0.1",S.dst_port=2345,S.dst_addr="127.0.0.1",S.ss_family="AF_INET",S;for(var n=new NativeFunction(r.PR_GetPeerName,"int",["pointer","pointer"]),o=new NativeFunction(r.PR_GetSockName,"int",["pointer","pointer"]),_=new NativeFunction(r.ntohs,"uint16",["uint16"]),l=new NativeFunction(r.ntohl,"uint32",["uint32"]),c=(Memory.alloc(2),Memory.alloc(4)),g=Memory.alloc(128),p=["src","dst"],N=0;N<p.length;N++)if(c.writeU32(128),"src"==p[N]!==t?o(e,g):n(e,g),g.readU16()==a)S[p[N]+"_port"]=_(g.add(2).readU16()),S[p[N]+"_addr"]=l(g.add(4).readU32()),S.ss_family="AF_INET";else{if(g.readU16()!=d)throw i("[-] PIPE descriptor error"),"Only supporting IPv4/6";S[p[N]+"_port"]=_(g.add(2).readU16()),S[p[N]+"_addr"]="";for(var u=g.add(8),m=0;m<16;m+=1)S[p[N]+"_addr"]+=("0"+u.add(m).readU8().toString(16).toUpperCase()).substr(-2);0===S[p[N]+"_addr"].toString().indexOf("00000000000000000000FFFF")?(S[p[N]+"_addr"]=l(u.add(12).readU32()),S.ss_family="AF_INET"):S.ss_family="AF_INET6"}return S}static is_ptr_at_mem_location(e){try{return e.readPointer(),1}catch(e){return-1}}static NSS_FindIdentityForName(e,t){var a=e.add(2*r).readPointer(),d=e.add(3*r).readPointer(),s=e.add(5*r).readPointer();if(!s.isNull()&&NSS.PR_GetNameForIdentity(s).readCString()==t)return e;return a.isNull()?(d.isNull()||i("Have upper"),i("[-] error while getting SSL layer"),NULL):this.NSS_FindIdentityForName(a,t)}static getSessionIdString(e,t){for(var r="",a=0;a<t;a++)r+=("0"+e.add(a).readU8().toString(16).toUpperCase()).substr(-2);return r}static getSSL_Layer(e){var t=new NativeFunction(Module.getExportByName("libnspr4.so","PR_GetIdentitiesLayer"),"pointer",["pointer","int"])(e,3);return ptr(t.toString()).isNull()?(i("PR_BAD_DESCRIPTOR_ERROR: "+t),-1):t}static getHexString(e,t){for(var r="",a=0;a<t;a++)r+=("0"+e.add(a).readU8().toString(16).toLowerCase()).substr(-2);return r}static getSslSessionIdFromFD(e){var t="3E8ABF58649A1A1C58824D704173BA9AAFA2DA33B45FFEA341D218B29BBACF8F",a=NSS.getDescType(e),d=NSS.NSS_FindIdentityForName(e,"SSL");if(!d)return t;if(null==(p=ptr(NSS.SSL_SESSION_get_id(d).toString()))||p.isNull()){try{if(i("---- getSslSessionIdFromFD -----"),i("ERROR"),i("pRFileDescType: "+NSS.getDescType(e)),2==a){var s=Memory.dup(e,32),S=new NativeFunction(Module.getExportByName("libnspr4.so","PR_GetLayersIdentity"),"uint32",["pointer"]),n=new NativeFunction(Module.getExportByName("libnspr4.so","PR_GetNameForIdentity"),"pointer",["uint32"]),o=S(e);i("LayerID: "+o);var _=n(o);i("name address: "+_),i("name: "+ptr(_.toString()).readCString());var l=ptr(NSS.getSSL_Layer(e).toString());if(i("sslSessionIdSECItem2 ="+l),l.toString().startsWith("0x7f")){Memory.dup(l,32);var c=ptr(NSS.SSL_SESSION_get_id(l).toString());i("sslSessionIdSECItem3 ="+c)}var g=ptr(NSS.SSL_SESSION_get_id(e).toString());i("sslSessionIdSECItem4 ="+g),i("Using Dummy Session ID"),i("")}else if(4==a){e=ptr(NSS.getSSL_Layer(e).toString());var p=ptr(NSS.SSL_SESSION_get_id(e).toString());i("new sessionid_ITEM: "+p)}else{i("---- SSL Session Analysis ------------");s=Memory.dup(p,32);i(hexdump(s))}i("---- getSslSessionIdFromFD finished -----"),i("")}catch(e){i("Error:"+e)}return t}var N=p.add(2*r).readU32(),u=p.add(r).readPointer();return NSS.getSessionIdString(u,N)}static get_SSL_FD(e){var t=NSS.NSS_FindIdentityForName(e,"SSL");if(!t)return i("error: couldn't get SSL Layer from pRFileDesc"),NULL;var r=NSS.get_SSL_Socket(t);return r||(i("error: couldn't get sslSocketFD"),NULL)}static get_SSL_Socket(e){return e.add(1*r).readPointer()}static getMasterSecret(e){var t=e.cwSpec,r=NSS.parse_struct_sl3CipherSpecStr(t).master_secret;return NSS.get_Secret_As_HexString(r)}static getClientRandom(e){return NSS.getHexString(e.hs.client_random,NSS.SSL3_RANDOM_LENGTH)}static get_SSL_Version(e){var t=NSS.get_SSL_FD(e);if(t.isNull())return-1;return t.add(160).readU16()}static get_Secret_As_HexString(e){if(NSS.PK11_ExtractKeyValue(e)!=SECStatus.SECSuccess)return"";var t=NSS.PK11_GetKeyData(e),r=NSS.parse_struct_SECItem(t);return NSS.getHexString(r.data,r.len)}static is_TLS_1_3(e){return e>771}static get_Keylog_Dump(e,t,r){return e+" "+t+" "+r}static getTLS_Keys(e,t){var r={contentType:"keylog"};i("[*] trying to log some keying materials ...");var a=NSS.get_SSL_FD(e);if(!a.isNull()){var d=NSS.parse_struct_sslSocketStr(a).ssl3,s=NSS.parse_struct_ssl3Str(d),S=NSS.getClientRandom(s);if(1==NSS.doTLS13_RTT0){var n=NSS.get_Secret_As_HexString(s.hs.earlyExporterSecret);i(NSS.get_Keylog_Dump("EARLY_EXPORTER_SECRET",S,n)),r.keylog=NSS.get_Keylog_Dump("EARLY_EXPORTER_SECRET",S,n),send(r),NSS.doTLS13_RTT0=-1}if(1==t){i("[*] exporting TLS 1.3 handshake keying material");var o=NSS.get_Secret_As_HexString(s.hs.clientHsTrafficSecret);i(NSS.get_Keylog_Dump("CLIENT_HANDSHAKE_TRAFFIC_SECRET",S,o)),r.keylog=NSS.get_Keylog_Dump("CLIENT_HANDSHAKE_TRAFFIC_SECRET",S,o),send(r);var _=NSS.get_Secret_As_HexString(s.hs.serverHsTrafficSecret);return i(NSS.get_Keylog_Dump("SERVER_HANDSHAKE_TRAFFIC_SECRET",S,_)),r.keylog=NSS.get_Keylog_Dump("SERVER_HANDSHAKE_TRAFFIC_SECRET",S,_),void send(r)}if(2==t){i("[*] exporting TLS 1.3 RTT0 handshake keying material");var l=NSS.get_Secret_As_HexString(s.hs.clientEarlyTrafficSecret);return i(NSS.get_Keylog_Dump("CLIENT_EARLY_TRAFFIC_SECRET",S,l)),r.keylog=NSS.get_Keylog_Dump("CLIENT_EARLY_TRAFFIC_SECRET",S,l),send(r),void(NSS.doTLS13_RTT0=1)}var c=NSS.get_SSL_Version(e);if(NSS.is_TLS_1_3(c)){i("[*] exporting TLS 1.3 keying material");var g=NSS.get_Secret_As_HexString(s.hs.clientTrafficSecret);i(NSS.get_Keylog_Dump("CLIENT_TRAFFIC_SECRET_0",S,g)),r.keylog=NSS.get_Keylog_Dump("CLIENT_TRAFFIC_SECRET_0",S,g),send(r);var p=NSS.get_Secret_As_HexString(s.hs.serverTrafficSecret);i(NSS.get_Keylog_Dump("SERVER_TRAFFIC_SECRET_0",S,p)),r.keylog=NSS.get_Keylog_Dump("SERVER_TRAFFIC_SECRET_0",S,p),send(r);var N=NSS.get_Secret_As_HexString(s.hs.exporterSecret);i(NSS.get_Keylog_Dump("EXPORTER_SECRET",S,N)),r.keylog=NSS.get_Keylog_Dump("EXPORTER_SECRET",S,N),send(r)}else{i("[*] exporting TLS 1.2 keying material");var u=NSS.getMasterSecret(s);i(NSS.get_Keylog_Dump("CLIENT_RANDOM",S,u)),r.keylog=NSS.get_Keylog_Dump("CLIENT_RANDOM",S,u),send(r)}NSS.doTLS13_RTT0=-1}}static ssl_RecordKeyLog(e){NSS.getTLS_Keys(e,0)}install_plaintext_read_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].PR_Read,{onEnter:function(e){this.fd=ptr(e[0]),this.buf=ptr(e[1])},onLeave:function(r){if(!(r.toInt32()<=0||NSS.getDescType(this.fd)==PRDescType.PR_DESC_FILE)){s("The results of NSS and its PR_Read is likely not the information transmitted over the wire. Better do a full capture and just log the TLS keys");var a=Memory.alloc(8);NSS.getpeername(this.fd,a);if(2==a.readU16()||10==a.readU16()||100==a.readU16()){var d=NSS.getPortsAndAddressesFromNSS(this.fd,!0,t[e],n);i("Session ID: "+NSS.getSslSessionIdFromFD(this.fd)),d.ssl_session_id=NSS.getSslSessionIdFromFD(this.fd),d.function="NSS_read",this.message=d,this.message.contentType="datalog";var S=this.buf.readByteArray(new Uint32Array([r])[0]);send(d,S)}else{(d=NSS.getPortsAndAddressesFromNSS(null,!0,t[e],n)).ssl_session_id=NSS.getSslSessionIdFromFD(this.fd),d.function="NSS_read",this.message=d,this.message.contentType="datalog";var o=this.buf.readByteArray(new Uint32Array([r])[0]);i(JSON.stringify(o)),send(d,o)}}}})}install_plaintext_write_hook(){var e=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].PR_Write,{onEnter:function(e){this.fd=ptr(e[0]),this.buf=e[1],this.len=e[2]},onLeave:function(r){if(!(r.toInt32()<=0)){var a=Memory.alloc(8);if(NSS.getsockname(this.fd,a),2==a.readU16()||10==a.readU16()||100==a.readU16()){(d=NSS.getPortsAndAddressesFromNSS(this.fd,!1,t[e],n)).ssl_session_id=NSS.getSslSessionIdFromFD(this.fd),d.function="NSS_write",d.contentType="datalog",send(d,this.buf.readByteArray(parseInt(this.len)))}else{var d;s("The results of NSS and its PR_Write is likely not the information transmitted over the wire. Better do a full capture and just log the TLS keys"),(d=NSS.getPortsAndAddressesFromNSS(null,!0,t[e],n)).ssl_session_id=NSS.getSslSessionIdFromFD(this.fd),d.function="NSS_write",this.message=d,this.message.contentType="datalog";var S=this.buf.readByteArray(new Uint32Array([r])[0]);i(JSON.stringify(S)),send(d,S)}}}})}static parse_epoch_value_from_SSL_SetSecretCallback(e,t){if(1==t)NSS.getTLS_Keys(e,2);else if(2==t)NSS.getTLS_Keys(e,1);else{if(t>=3)return;i("[-] secret_callback invocation: UNKNOWN")}}static insert_hook_into_secretCallback(e){Interceptor.attach(e,{onEnter(e){this.sslSocketFD=e[0],this.epoch=e[1],NSS.parse_epoch_value_from_SSL_SetSecretCallback(this.sslSocketFD,this.epoch)},onLeave(e){}})}static register_secret_callback(e){var t=NSS.get_SSL_FD(e);if(t.isNull())i("[-] error while installing secret callback: unable get SSL socket descriptor");else{var r=NSS.parse_struct_sslSocketStr(t);1==NSS.is_ptr_at_mem_location(r.secretCallback.readPointer())?NSS.insert_hook_into_secretCallback(r.secretCallback.readPointer()):r.secretCallback.writePointer(NSS.secret_callback),i("[**] secret callback ("+NSS.secret_callback+") installed to address: "+r.secretCallback)}}install_tls_keys_callback_hook(){}}NSS.doTLS13_RTT0=-1,NSS.SSL3_RANDOM_LENGTH=32,NSS.keylog_callback=new NativeCallback((function(e,t){return void 0!==this?NSS.ssl_RecordKeyLog(e):console.log("[-] Error while installing ssl_RecordKeyLog() callback"),0}),"void",["pointer","pointer"]),NSS.secret_callback=new NativeCallback((function(e,t,r,a,d){void 0!==this?NSS.parse_epoch_value_from_SSL_SetSecretCallback(e,t):console.log("[-] Error while installing parse_epoch_value_from_SSL_SetSecretCallback()")}),"void",["pointer","uint16","uint16","pointer","pointer"]);
âœ„
{"version":3,"file":"openssl_boringssl.js","names":["readAddresses","getPortsAndAddresses","getBaseAddress","offsets","enable_default_fd","devlog","log","ModifyReceiver","constructor","this","readModification","writeModification","listenForReadMod","listenForWriteMod","recv","newBuf","payload","Uint8Array","match","map","h","parseInt","buffer","readmod","writemod","val","OpenSSL_BoringSSL","moduleName","socket_library","is_base_hook","passed_library_method_mapping","library_method_mapping","modReceiver","global","global_counter","addresses","module_name","openssl","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","SSL_SESSION_get_id","NativeFunction","SSL_get_fd","ObjC","available","SSL_get_session","install_plaintext_read_hook","lib_addesses","instance","current_module_name","Interceptor","attach","onEnter","args","bufLen","toInt32","fd","message","getSslSessionId","buf","onLeave","retval","Memory","writeByteArray","byteLength","send","readByteArray","install_plaintext_write_hook","error","Error","console","stack","fallback_addresses","init_addresses","firstKey","newPointer","alloc","NativePointer","install_tls_keys_callback_hook","ssl","session","isNull","len_pointer","p","len","readU32","session_id","i","readU8","toString","toUpperCase","substr","keylog_callback","NativeCallback","ctxPtr","linePtr","readCString"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["openssl_boringssl.ts"],"mappings":"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"}
âœ„
import{readAddresses as e,getPortsAndAddresses as t,getBaseAddress as i}from"../shared/shared_functions.js";import{offsets as s,enable_default_fd as o}from"../ssl_log.js";import{devlog as n,log as r}from"../util/log.js";class a{constructor(){this.readModification=null,this.writeModification=null,this.listenForReadMod(),this.listenForWriteMod()}listenForReadMod(){recv("readmod",(e=>{this.readModification=null!=e.payload?new Uint8Array(e.payload.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer:null,this.listenForReadMod()}))}listenForWriteMod(){recv("writemod",(e=>{this.writeModification=null!=e.payload?new Uint8Array(e.payload.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer:null,this.listenForWriteMod()}))}get readmod(){return this.readModification}get writemod(){return this.writeModification}set readmod(e){this.readModification=e}set writemod(e){this.writeModification=e}}export class OpenSSL_BoringSSL{constructor(t,o,n,d){if(this.moduleName=t,this.socket_library=o,this.passed_library_method_mapping=d,this.library_method_mapping={},OpenSSL_BoringSSL.modReceiver=new a,global.global_counter++,void 0!==d?this.library_method_mapping=d:(this.library_method_mapping[`*${t}*`]=["SSL_read","SSL_write","SSL_get_fd","SSL_get_session","SSL_SESSION_get_id","SSL_new","SSL_do_handshake","SSL_CTX_set_keylog_callback"],this.library_method_mapping[`*${o}*`]=["getpeername","getsockname","ntohs","ntohl"]),this.is_base_hook=n,this.addresses=e(t,this.library_method_mapping),this.module_name=t,"{OFFSETS}"!=s&&null!=s.openssl){if(null!=s.sockets){const e=i(o);for(const t of Object.keys(s.sockets))this.addresses[this.moduleName][`${t}`]=s.sockets[`${t}`].absolute||null==e?ptr(s.sockets[`${t}`].address):e.add(ptr(s.sockets[`${t}`].address))}const e=i(t);null==e&&r("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const t of Object.keys(s.openssl))this.addresses[this.moduleName][`${t}`]=s.openssl[`${t}`].absolute||null==e?ptr(s.openssl[`${t}`].address):e.add(ptr(s.openssl[`${t}`].address))}this.SSL_SESSION_get_id=new NativeFunction(this.addresses[this.moduleName].SSL_SESSION_get_id,"pointer",["pointer","pointer"]),this.SSL_get_fd=ObjC.available?new NativeFunction(this.addresses[this.moduleName].BIO_get_fd,"int",["pointer"]):new NativeFunction(this.addresses[this.moduleName].SSL_get_fd,"int",["pointer"]),this.SSL_get_session=new NativeFunction(this.addresses[this.moduleName].SSL_get_session,"pointer",["pointer"])}install_plaintext_read_hook(){var e=this.addresses,i=this,s=this.module_name;Interceptor.attach(this.addresses[this.moduleName].SSL_read,{onEnter:function(n){if(this.bufLen=n[2].toInt32(),this.fd=i.SSL_get_fd(n[0]),!(this.fd<0&&0==o)){var r=t(this.fd,!0,e[s],o);r.ssl_session_id=i.getSslSessionId(n[0]),r.function="SSL_read",this.message=r,this.buf=n[1]}},onLeave:function(e){(e|=0)<=0||this.fd<0||(null!==OpenSSL_BoringSSL.modReceiver.readmod&&(Memory.writeByteArray(this.buf,new Uint8Array(this.bufLen)),Memory.writeByteArray(this.buf,OpenSSL_BoringSSL.modReceiver.readmod),e=OpenSSL_BoringSSL.modReceiver.readmod.byteLength),this.message.contentType="datalog",send(this.message,this.buf.readByteArray(e)))}})}install_plaintext_write_hook(){var e=this.module_name,i=this.addresses,s=this;Interceptor.attach(this.addresses[this.moduleName].SSL_write,{onEnter:function(n){if(!ObjC.available){try{this.fd=s.SSL_get_fd(n[0])}catch(e){if(this.is_base_hook)e instanceof Error?(console.log("Error: "+e.message),console.log("Stack: "+e.stack)):console.log("Unexpected error:",e);else{const e=global.init_addresses;let t=Object.keys(e)[0];s.SSL_SESSION_get_id=new NativeFunction(e[t].SSL_SESSION_get_id,"pointer",["pointer","pointer"]),s.SSL_get_fd=ObjC.available?new NativeFunction(e[t].BIO_get_fd,"int",["pointer"]):new NativeFunction(e.SSL_get_fd,"int",["pointer"]),s.SSL_get_session=new NativeFunction(e[t].SSL_get_session,"pointer",["pointer"])}}if(this.fd<0&&0==o)return;var r=t(this.fd,!1,i[e],o);if(r.ssl_session_id=s.getSslSessionId(n[0]),r.function="SSL_write",r.contentType="datalog",null!==OpenSSL_BoringSSL.modReceiver.writemod){const e=Memory.alloc(OpenSSL_BoringSSL.modReceiver.writemod.byteLength);Memory.writeByteArray(e,OpenSSL_BoringSSL.modReceiver.writemod),n[1]=e,n[2]=new NativePointer(OpenSSL_BoringSSL.modReceiver.writemod.byteLength)}send(r,n[1].readByteArray(n[2].toInt32()))}},onLeave:function(e){}})}install_tls_keys_callback_hook(){r("Error: TLS key extraction not implemented yet.")}getSslSessionId(e){var t=this.SSL_get_session(e);if(t.isNull())return o?(r("using dummy SessionID: 59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76336"),"59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76336"):(r("Session is null"),0);for(var i=Memory.alloc(4),s=this.SSL_SESSION_get_id(t,i),n=i.readU32(),a="",d=0;d<n;d++)a+=("0"+s.add(d).readU8().toString(16).toUpperCase()).substr(-2);return a}}OpenSSL_BoringSSL.keylog_callback=new NativeCallback((function(e,t){n("invoking keylog_callback from OpenSSL_BoringSSL");var i={contentType:"keylog"};i.keylog=t.readCString(),send(i)}),"void",["pointer","pointer"]);
âœ„
{"version":3,"file":"wolfssl.js","names":["readAddresses","getPortsAndAddresses","getBaseAddress","log","offsets","enable_default_fd","WolfSSL","constructor","moduleName","socket_library","passed_library_method_mapping","this","library_method_mapping","addresses","module_name","wolfssl","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","wolfSSL_get_fd","NativeFunction","wolfSSL_get_session","install_tls_keys_callback_hook","static","ssl","session","isNull","p","session_id","i","readU8","toString","toUpperCase","substr","install_plaintext_read_hook","current_module_name","lib_addesses","Interceptor","attach","onEnter","args","message","getSslSessionId","buf","onLeave","retval","send","readByteArray","install_plaintext_write_hook","parseInt"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/ssl_lib/","sources":["wolfssl.ts"],"mappings":"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"}
âœ„
import{readAddresses as s,getPortsAndAddresses as e,getBaseAddress as t}from"../shared/shared_functions.js";import{log as o}from"../util/log.js";import{offsets as l,enable_default_fd as i}from"../ssl_log.js";export class WolfSSL{constructor(e,i,a){if(this.moduleName=e,this.socket_library=i,this.passed_library_method_mapping=a,this.library_method_mapping={},void 0!==a?this.library_method_mapping=a:(this.library_method_mapping[`*${e}*`]=["wolfSSL_read","wolfSSL_write","wolfSSL_get_fd","wolfSSL_get_session","wolfSSL_connect","wolfSSL_KeepArrays","wolfSSL_SESSION_get_master_key","wolfSSL_get_client_random","wolfSSL_get_server_random"],this.library_method_mapping[`*${i}*`]=["getpeername","getsockname","ntohs","ntohl"]),this.addresses=s(e,this.library_method_mapping),this.module_name=e,"{OFFSETS}"!=l&&null!=l.wolfssl){if(null!=l.sockets){const s=t(i);for(const e of Object.keys(l.sockets))this.addresses[this.moduleName][`${e}`]=l.sockets[`${e}`].absolute||null==s?ptr(l.sockets[`${e}`].address):s.add(ptr(l.sockets[`${e}`].address))}const s=t(e);null==s&&o("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const e of Object.keys(l.wolfssl))this.addresses[this.moduleName][`${e}`]=l.wolfssl[`${e}`].absolute||null==s?ptr(l.wolfssl[`${e}`].address):s.add(ptr(l.wolfssl[`${e}`].address))}WolfSSL.wolfSSL_get_fd=new NativeFunction(this.addresses[this.moduleName].wolfSSL_get_fd,"int",["pointer"]),WolfSSL.wolfSSL_get_session=new NativeFunction(this.addresses[this.moduleName].wolfSSL_get_session,"pointer",["pointer"])}install_tls_keys_callback_hook(){o("Error: TLS key extraction not implemented yet.")}static getSslSessionId(s){var e=WolfSSL.wolfSSL_get_session(s);if(e.isNull())return i?(o("using dummy SessionID: 59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76338"),"59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76338"):(o("Session is null"),0);for(var t=e.add(8),l="",a=0;a<32;a++)l+=("0"+t.add(a).readU8().toString(16).toUpperCase()).substr(-2);return l}install_plaintext_read_hook(){var s=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].wolfSSL_read,{onEnter:function(o){var l=e(WolfSSL.wolfSSL_get_fd(o[0]),!0,t[s],i);l.function="wolfSSL_read",l.ssl_session_id=WolfSSL.getSslSessionId(o[0]),this.message=l,this.buf=o[1]},onLeave:function(s){(s|=0)<=0||(this.message.contentType="datalog",send(this.message,this.buf.readByteArray(s)))}})}install_plaintext_write_hook(){var s=this.module_name,t=this.addresses;Interceptor.attach(this.addresses[this.moduleName].wolfSSL_write,{onEnter:function(o){var l=e(WolfSSL.wolfSSL_get_fd(o[0]),!1,t[s],i);l.ssl_session_id=WolfSSL.getSslSessionId(o[0]),l.function="wolfSSL_write",l.contentType="datalog",send(l,o[1].readByteArray(parseInt(o[2])))},onLeave:function(s){}})}}
âœ„
{"version":3,"file":"ssl_log.js","names":["load_android_hooking_agent","load_ios_hooking_agent","load_macos_hooking_agent","load_linux_hooking_agent","load_windows_hooking_agent","isWindows","isLinux","isAndroid","isiOS","isMacOS","anti_root_execute","log","global","init_addresses","global_counter","offsets","experimental","anti_root","enable_default_fd","send","recv","value","payload","wait","getOffsets"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/","sources":["ssl_log.ts"],"mappings":"qCAASA,MAAkC,8DAClCC,MAA8B,wDAC9BC,MAAgC,4DAChCC,MAAgC,8DAChCC,MAAkC,iDAClCC,aAAWC,eAASC,WAAWC,aAAOC,MAAe,sDACrDC,MAAyB,oCACzBC,MAAW,gBAGnBC,OAAeC,eAAiB,GAChCD,OAAeE,eAAiB,SA4E1B,IAAIC,QAAoB,mBAExB,IAAIC,cAAwB,SAE5B,IAAIC,WAAqB,SAEzB,IAAIC,mBAA6B,EAOxCC,KAAK,aAC2BC,KAAK,aAAaC,IAE9CH,kBAAoBG,EAAMC,OAAO,IAEbC,OAExBJ,KAAK,gBACkBC,KAAK,gBAAgBC,IACxCL,aAAeK,EAAMC,OAAO,IAEjBC,OAEfJ,KAAK,QACuBC,KAAK,YAAYC,IACzCJ,UAAYI,EAAMC,OAAO,IAETC,cAad,SAAUC,aACZ,OAAOT,OACX,CAKOV,KACCM,EAAI,6BACJP,KACKG,KACLI,EAAI,6BACDM,YACCN,EAAI,6BACJD,KAEJV,KACKM,KACLK,EAAI,2BACJR,KACKK,KACLG,EAAI,yBACJV,KACKQ,KACLE,EAAI,2BACJT,MAEAS,EAAI,uCACJA,EAAI"}
âœ„
import{load_android_hooking_agent as t}from"./android/android_agent.js";import{load_ios_hooking_agent as o}from"./ios/ios_agent.js";import{load_macos_hooking_agent as n}from"./macos/macos_agent.js";import{load_linux_hooking_agent as r}from"./linux/linux_agent.js";import{load_windows_hooking_agent as e}from"./windows/windows_agent.js";import{isWindows as i,isLinux as a,isAndroid as p,isiOS as s,isMacOS as l}from"./util/process_infos.js";import{anti_root_execute as f}from"./util/anti_root.js";import{log as m}from"./util/log.js";global.init_addresses={},global.global_counter=0;export let offsets="{OFFSETS}";export let experimental=!1;export let anti_root=!1;export let enable_default_fd=!1;send("defaultFD");recv("defaultFD",(t=>{enable_default_fd=t.payload})).wait(),send("experimental");recv("experimental",(t=>{experimental=t.payload})).wait(),send("anti");recv("antiroot",(t=>{anti_root=t.payload})).wait();export function getOffsets(){return offsets}i()?(m("Running Script on Windows"),e()):p()?(m("Running Script on Android"),anti_root&&(m("Applying anti root checks"),f()),t()):a()?(m("Running Script on Linux"),r()):s()?(m("Running Script on iOS"),o()):l()?(m("Running Script on MacOS"),n()):(m("Running Script on unknown plattform"),m("Error: not supported plattform!\nIf you want to have support for this plattform please make an issue at our github page."));
âœ„
{"version":3,"file":"anti_root.js","names":["log","devlog","readAddresses","AntiRoot","constructor","k","this","RootPackages","RootBinaries","RootProperties","RootPropertiesKeys","library_method_mapping","module_name","addresses","push","java_based_bypasses","Java","perform","PackageManager","use","Runtime","String","SystemProperties","BufferedReader","ProcessBuilder","useKeyInfo","useProcessManager","ProcessManager","NULL","loaded_classes","enumerateLoadedClassesSync","length","indexOf","err","KeyInfo","getPackageInfo","overload","implementation","pname","flags","call","exec","exec1","exec2","exec3","exec4","exec5","cmd","env","dir","fakeCmd","cmdarr","file","i","tmp_cmd","envp","contains","name","get","readLine","text","replace","command","start","shouldModifyCommand","size","toString","ProcManExec","ProcManExecVariant","workdir","redirectstderr","fake_cmd","directory","stdin","stdout","stderr","redirect","isInsideSecureHardware","native_based_bypasses","Interceptor","attach","onEnter","args","str_source","str_to_look_for","frida","Boolean","haystack","readUtf8String","onLeave","retval","ptr","path_array","readCString","split","executable","writeUtf8String","execute_hooks","anti_root_execute"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/","sources":["anti_root.ts"],"mappings":"cAASA,YAAKC,MAAc,mCACnBC,MAAqC,uCAOxC,MAAOC,SA2BTC,cAMI,IAAK,IAAIC,KA/BbC,KAAAC,aAAe,CAAC,0BAA2B,gCAAiC,uBACxE,6BAA8B,2BAA4B,kBAAmB,8BAC7E,sCAAuC,8BAA+B,yBACtE,6BAA8B,gCAAiC,2BAA4B,+BAC3F,mCAAoC,uBAAwB,iCAAkC,0BAC9F,gCAAiC,8BAA+B,uBAAwB,mBACxF,2BAA4B,oBAAqB,wBAGrDD,KAAAE,aAAe,CAAC,KAAM,UAAW,UAAW,gBAAiB,gBAAiB,cAAe,UAE7FF,KAAAG,eAAiB,CACb,mBAAoB,IACpB,gBAAiB,IACjB,mBAAoB,IACpB,YAAa,KAGjBH,KAAAI,mBAA+B,GAK/BJ,KAAAK,uBAA2D,GAGvDL,KAAKK,uBAAuB,WAAa,CAAC,SAAU,QAAS,UAC7DL,KAAKM,YAAc,UACnBN,KAAKO,UAAYX,EAAcI,KAAKM,YAAYN,KAAKK,wBAGvCL,KAAKG,eAAgBH,KAAKI,mBAAmBI,KAAKT,EAEpE,CAEAU,sBAEIC,KAAKC,SAAQ,WAKT,IAAIC,EAAiBF,KAAKG,IAAI,yCAE1BC,EAAUJ,KAAKG,IAAI,qBAInBE,GAFaL,KAAKG,IAAI,gBAEbH,KAAKG,IAAI,qBAElBG,EAAmBN,KAAKG,IAAI,+BAE5BI,EAAiBP,KAAKG,IAAI,0BAE1BK,EAAiBR,KAAKG,IAAI,4BAI1BM,GAFeT,KAAKG,IAAI,2BAEX,GAEbO,GAAoB,EAGpBC,EAAiBC,KAEjBC,EAAiBb,KAAKc,6BAU1B,GANA7B,EAAO,UAAY4B,EAAeE,OAAS,aAI3C9B,EAAO,WAAa4B,EAAeG,QAAQ,8BAEgB,GAAvDH,EAAeG,QAAQ,4BACvB,IACIN,GAAoB,EACpBC,EAAiBX,KAAKG,IAAI,2B,CAC5B,MAAOc,GACLhC,EAAO,+BAAiCgC,E,MAI7ChC,EAAO,kCAGV,IAAIiC,EAAUN,KAGd,IAAoE,GAAhEC,EAAeG,QAAQ,qCACvB,IACIP,GAAa,EACbS,EAAUlB,KAAKG,IAAI,oC,CACrB,MAAOc,GACNjC,EAAI,wBAA0BiC,E,MAGlCjC,EAAI,2BAMPkB,EAAeiB,eAAeC,SAAS,mBAAoB,OAAOC,eAAiB,SAASC,EAAYC,GAMpG,OALyBjC,KAAKC,aAAayB,QAAQM,IAAU,IAE1DtC,EAAI,kCAAoCsC,GACvCA,EAAQ,sDAELhC,KAAK6B,eAAeC,SAAS,mBAAoB,OAAOI,KAAKlC,KAAMgC,EAAOC,EACrF,EAqBA,IAAIE,EAAOrB,EAAQqB,KAAKL,SAAS,uBAC7BM,EAAQtB,EAAQqB,KAAKL,SAAS,oBAC9BO,EAAQvB,EAAQqB,KAAKL,SAAS,mBAAoB,uBAClDQ,EAAQxB,EAAQqB,KAAKL,SAAS,sBAAuB,uBACrDS,EAAQzB,EAAQqB,KAAKL,SAAS,sBAAuB,sBAAuB,gBAC5EU,EAAQ1B,EAAQqB,KAAKL,SAAS,mBAAoB,sBAAuB,gBAE7EU,EAAMT,eAAiB,SAASU,EAAaC,EAAUC,GACnD,IAA+B,GAA3BF,EAAIf,QAAQ,YAA2B,SAAPe,IAAgD,GAA9BA,EAAIf,QAAQ,eAA8B,MAAPe,GAAsB,MAAPA,EAAa,CACjH,IAAIG,EAAU,OAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,GAAW,MAAPH,EAAa,CACTG,EAAU,eAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,OAAOJ,EAAMN,KAAKlC,KAAMyC,EAAKC,EAAKC,EACtC,EAIAJ,EAAMR,eAAiB,SAASc,EAAgBH,EAAUI,GACtD,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAOpB,OAAQsB,GAAQ,EAAG,CAC1C,IAAIC,EAAUH,EAAOE,GACrB,IAAmC,GAA/BC,EAAQtB,QAAQ,YAA+B,SAAXsB,IAAwD,GAAlCA,EAAQtB,QAAQ,eAAkC,MAAXsB,GAA8B,MAAXA,EAAiB,CACrI,IAAIJ,EAAU,OAEd,OADDlD,EAAI,UAAYmD,EAAS,YACjBT,EAAMF,KAAKlC,KAAM4C,E,CAG5B,GAAe,MAAXI,EAAiB,CACbJ,EAAU,eAEd,OADDlD,EAAI,UAAYmD,EAAS,YACjBT,EAAMF,KAAKlC,KAAM4C,E,EAGhC,OAAOL,EAAML,KAAKlC,KAAM6C,EAAQH,EAAKI,EACzC,EAIAR,EAAMP,eAAiB,SAASc,EAAgBI,GAC5C,IAAK,IAAIF,EAAI,EAAGA,EAAIF,EAAOpB,OAAQsB,GAAQ,EAAG,CAC1C,IAAIC,EAAUH,EAAOE,GACrB,IAAmC,GAA/BC,EAAQtB,QAAQ,YAA+B,SAAXsB,IAAwD,GAAlCA,EAAQtB,QAAQ,eAAkC,MAAXsB,GAA8B,MAAXA,EAAiB,CACrI,IAAIJ,EAAU,OAEd,OADDlD,EAAI,UAAYmD,EAAS,YACjBT,EAAMF,KAAKlC,KAAM4C,E,CAG5B,GAAe,MAAXI,EAAiB,CACbJ,EAAU,eAEd,OADDlD,EAAI,UAAYmD,EAAS,YACjBT,EAAMF,KAAKlC,KAAM4C,E,EAGhC,OAAON,EAAMJ,KAAKlC,KAAM6C,EAAQI,EACpC,EAGAZ,EAAMN,eAAiB,SAASU,EAAaC,GACzC,IAA+B,GAA3BD,EAAIf,QAAQ,YAA2B,SAAPe,IAAgD,GAA9BA,EAAIf,QAAQ,eAA8B,MAAPe,GAAsB,MAAPA,EAAa,CACjH,IAAIG,EAAU,OAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,GAAW,MAAPH,EAAa,CACTG,EAAU,eAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,OAAOP,EAAMH,KAAKlC,KAAMyC,EAAKC,EACjC,EAGAP,EAAKJ,eAAiB,SAASU,GAC3B,IAAK,IAAIM,EAAI,EAAGA,EAAIN,EAAIhB,OAAQsB,GAAQ,EAAG,CACvC,IAAIC,EAAUP,EAAIM,GAClB,IAAmC,GAA/BC,EAAQtB,QAAQ,YAA+B,SAAXsB,IAAwD,GAAlCA,EAAQtB,QAAQ,eAAkC,MAAXsB,GAA8B,MAAXA,EAAiB,CACrI,IAAIJ,EAAU,OAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAG5B,GAAe,MAAXI,EAAiB,CACbJ,EAAU,eAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,EAIhC,OAAOT,EAAKD,KAAKlC,KAAMyC,EAC3B,EAIAL,EAAML,eAAiB,SAASU,GAC5B,IAA+B,GAA3BA,EAAIf,QAAQ,YAA2B,SAAPe,IAAgD,GAA9BA,EAAIf,QAAQ,eAA8B,MAAPe,GAAsB,MAAPA,EAAa,CACjH,IAAIG,EAAU,OAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,GAAW,MAAPH,EAAa,CACTG,EAAU,eAEd,OADDlD,EAAI,UAAY+C,EAAM,YACdL,EAAMF,KAAKlC,KAAM4C,E,CAE5B,OAAOR,EAAMF,KAAKlC,KAAMyC,EAC5B,EAIA1B,EAAOmC,SAASnB,eAAiB,SAASoB,GACtC,MAAY,aAARA,GACDzD,EAAI,2BACI,GAEJM,KAAKkD,SAAShB,KAAKlC,KAAMmD,EACpC,EAEUnC,EAAiBoC,IAAItB,SAAS,oBAIpCC,eAAiB,SAASoB,GAC1B,OAA8C,GAA1CnD,KAAKI,mBAAmBsB,QAAQyB,IACjCzD,EAAI,UAAYyD,GACRnD,KAAKG,eAAegD,IAExBnD,KAAKoD,IAAIlB,KAAKlC,KAAMmD,EAC/B,EAMAlC,EAAeoC,SAASvB,SAAS,WAAWC,eAAiB,WACzD,IAAIuB,EAAOtD,KAAKqD,SAASvB,SAAS,WAAWI,KAAKlC,MACrC,OAATsD,GAGsBA,EAAK5B,QAAQ,4BAA8B,IAE9DhC,EAAI,+BACH4D,EAAOA,EAAKC,QAAQ,0BAA2B,+BAGvD,OAAOD,CACX,EAIqBpC,EAAesC,QAAQ1B,SAAS,kBA0BrD,GAxBAZ,EAAeuC,MAAM1B,eAAiB,WAGlC,IAFA,IAAIU,EAAMzC,KAAKwD,QAAQtB,KAAKlC,MACxB0D,GAAsB,EACjBX,EAAI,EAAGA,EAAIN,EAAIkB,OAAQZ,GAAQ,EAAG,CACvC,IAAIC,EAAUP,EAAIW,IAAIL,GAAGa,YACU,GAA/BZ,EAAQtB,QAAQ,aAAiD,GAA7BsB,EAAQtB,QAAQ,WAAoD,GAAlCsB,EAAQtB,QAAQ,gBAAiD,GAA1BsB,EAAQtB,QAAQ,QAC7HgC,GAAsB,E,CAG9B,OAAIA,GACDhE,EAAI,yBAA2B+C,GAC9BzC,KAAKwD,QAAQtB,KAAKlC,KAAM,CAAC,SAClBA,KAAKyD,MAAMvB,KAAKlC,QAED,GAAtByC,EAAIf,QAAQ,OACbhC,EAAI,yBAA2B+C,GAC9BzC,KAAKwD,QAAQtB,KAAKlC,KAAM,CAAC,iBAClBA,KAAKyD,MAAMvB,KAAKlC,OAGpBA,KAAKyD,MAAMvB,KAAKlC,KAC3B,EAGIoB,EAAmB,CAEnB,IAAIyC,EAAcxC,EAAec,KAAKL,SAAS,sBAAuB,sBAAuB,eAAgB,WAEzGgC,EAAqBzC,EAAec,KAAKL,SAAS,sBAAuB,sBAAuB,mBAAoB,yBAA0B,yBAA0B,yBAA0B,WAEtM+B,EAAY9B,eAAiB,SAASU,EAAeC,EAAeqB,EAAcC,GAE9E,IADA,IAAIC,EAAWxB,EACNM,EAAI,EAAGA,EAAIN,EAAIhB,OAAQsB,GAAQ,EAAG,CACvC,IAAIC,EAAUP,EAAIM,GAClB,IAAmC,GAA/BC,EAAQtB,QAAQ,YAA+B,SAAXsB,IAAwD,GAAlCA,EAAQtB,QAAQ,eAAkC,MAAXsB,EAAiB,CAC9GiB,EAAW,CAAC,QACjBvE,EAAI,UAAY+C,EAAM,W,CAGzB,GAAe,MAAXO,EAAiB,CACbiB,EAAW,CAAC,gBACjBvE,EAAI,UAAY+C,EAAM,W,EAG7B,OAAOoB,EAAY3B,KAAKlC,KAAMiE,EAAUvB,EAAKqB,EAASC,EAC1D,EAGAF,EAAmB/B,eAAiB,SAASU,EAAeC,EAAewB,EAAgBC,EAAYC,EAAaC,EAAaC,GAE7H,IADA,IAAIL,EAAWxB,EACNM,EAAI,EAAGA,EAAIN,EAAIhB,OAAQsB,GAAQ,EAAG,CACvC,IAAIC,EAAUP,EAAIM,GAClB,IAAmC,GAA/BC,EAAQtB,QAAQ,YAA+B,SAAXsB,IAAwD,GAAlCA,EAAQtB,QAAQ,eAAkC,MAAXsB,EAAiB,CAC9GiB,EAAW,CAAC,QACjBvE,EAAI,UAAY+C,EAAM,W,CAGzB,GAAe,MAAXO,EAAiB,CACbiB,EAAW,CAAC,gBACjBvE,EAAI,UAAY+C,EAAM,W,EAG7B,OAAOqB,EAAmB5B,KAAKlC,KAAMiE,EAAUvB,EAAKwB,EAAWC,EAAOC,EAAQC,EAAQC,EAC1F,C,CAKAnD,IAEAS,EAAQ2C,uBAAuBxC,eAAiB,WAE5C,OADDrC,EAAI,kCACI,CACX,EAKR,GAEJ,CAEA8E,wBAIJC,YAAYC,OAAO1E,KAAKO,UAAUP,KAAKM,aAAqB,OAAG,CAE3DqE,QAAS,SAAUC,GAEf5E,KAAK6E,WAAaD,EAAK,GACvB5E,KAAK8E,gBAAoBF,EAAK,GAC9B5E,KAAK+E,MAAWC,QAAQ,GAGxB,IAAIC,EAAWjF,KAAK6E,WAAWK,iBAChBlF,KAAK8E,gBAAgBI,kBAED,GAA9BD,EAASvD,QAAQ,WAAiD,GAA/BuD,EAASvD,QAAQ,YACrD1B,KAAK+E,MAAQC,QAAQ,GAE7B,EAEAG,QAAS,SAAUC,GAOf,OALIpF,KAAK+E,OAELK,EAAO7B,QAAQ8B,IAAI,IAGhBD,CACX,IAKJX,YAAYC,OAAO1E,KAAKO,UAAUP,KAAKM,aAAoB,MAAG,CAC1DqE,QAAS,SAASC,GACd,IAEIU,EAFOV,EAAK,GAAGW,cAEGC,MAAM,KACxBC,EAAaH,EAAWA,EAAW7D,OAAS,GACxBzB,KAAKE,aAAawB,QAAQ+D,IAAe,IAE7Db,EAAK,GAAGc,gBAAgB,cACzBhG,EAAI,uBAEX,EACAyF,QAAS,SAASC,GAElB,IAGJX,YAAYC,OAAO1E,KAAKO,UAAUP,KAAKM,aAAqB,OAAG,CAC3DqE,QAAS,SAASC,GACd,IAAInC,EAAMmC,EAAK,GAAGW,cACnB7F,EAAI,eAAiB+C,IAEW,GAA3BA,EAAIf,QAAQ,YAA2B,SAAPe,IAAgD,GAA9BA,EAAIf,QAAQ,eAA8B,MAAPe,IACtF/C,EAAI,yBAA2B+C,GAC9BmC,EAAK,GAAGc,gBAAgB,SAEjB,MAAPjD,IACD/C,EAAI,yBAA2B+C,GAC9BmC,EAAK,GAAGc,gBAAgB,gBAEhC,EACAP,QAAS,SAASC,GAElB,GAqBA,CAEAO,gBACI3F,KAAKS,sBACLT,KAAKwE,uBACT,SAIE,SAAUoB,qBACI,IAAI/F,UACV8F,eAGd"}
âœ„
import{log as e,devlog as a}from"./log.js";import{readAddresses as o}from"../shared/shared_functions.js";export class AntiRoot{constructor(){for(var e in this.RootPackages=["com.noshufou.android.su","com.noshufou.android.su.elite","eu.chainfire.supersu","com.koushikdutta.superuser","com.thirdparty.superuser","com.yellowes.su","com.koushikdutta.rommanager","com.koushikdutta.rommanager.license","com.dimonvideo.luckypatcher","com.chelpus.lackypatch","com.ramdroid.appquarantine","com.ramdroid.appquarantinepro","com.devadvance.rootcloak","com.devadvance.rootcloakplus","de.robv.android.xposed.installer","com.saurik.substrate","com.zachspong.temprootremovejb","com.amphoras.hidemyroot","com.amphoras.hidemyrootadfree","com.formyhm.hiderootPremium","com.formyhm.hideroot","me.phh.superuser","eu.chainfire.supersu.pro","com.kingouser.com","com.topjohnwu.magisk"],this.RootBinaries=["su","busybox","supersu","Superuser.apk","KingoUser.apk","SuperSu.apk","magisk"],this.RootProperties={"ro.build.selinux":"1","ro.debuggable":"0","service.adb.root":"0","ro.secure":"1"},this.RootPropertiesKeys=[],this.library_method_mapping={},this.library_method_mapping["libc.so"]=["strstr","fopen","system"],this.module_name="libc.so",this.addresses=o(this.module_name,this.library_method_mapping),this.RootProperties)this.RootPropertiesKeys.push(e)}java_based_bypasses(){Java.perform((function(){var o=Java.use("android.app.ApplicationPackageManager"),t=Java.use("java.lang.Runtime"),r=(Java.use("java.io.File"),Java.use("java.lang.String")),i=Java.use("android.os.SystemProperties"),s=Java.use("java.io.BufferedReader"),n=Java.use("java.lang.ProcessBuilder"),l=(Java.use("java.lang.StringBuffer"),!1),d=!1,c=NULL,u=Java.enumerateLoadedClassesSync();if(a("Loaded "+u.length+" classes!"),a("loaded: "+u.indexOf("java.lang.ProcessManager")),-1!=u.indexOf("java.lang.ProcessManager"))try{d=!0,c=Java.use("java.lang.ProcessManager")}catch(e){a("ProcessManager Hook failed: "+e)}else a("ProcessManager hook not loaded");var p=NULL;if(-1!=u.indexOf("android.security.keystore.KeyInfo"))try{l=!0,p=Java.use("android.security.keystore.KeyInfo")}catch(a){e("KeyInfo Hook failed: "+a)}else e("KeyInfo hook not loaded");o.getPackageInfo.overload("java.lang.String","int").implementation=function(a,o){return this.RootPackages.indexOf(a)>-1&&(e("Bypass root check for package: "+a),a="set.package.name.to.a.fake.one.so.we.can.bypass.it"),this.getPackageInfo.overload("java.lang.String","int").call(this,a,o)};var m=t.exec.overload("[Ljava.lang.String;"),h=t.exec.overload("java.lang.String"),f=t.exec.overload("java.lang.String","[Ljava.lang.String;"),g=t.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;"),v=t.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;","java.io.File"),y=t.exec.overload("java.lang.String","[Ljava.lang.String;","java.io.File");y.implementation=function(a,o,t){if(-1!=a.indexOf("getprop")||"mount"==a||-1!=a.indexOf("build.prop")||"id"==a||"sh"==a){var r="grep";return e("Bypass "+a+" command"),h.call(this,r)}if("su"==a){r="awesome_tool";return e("Bypass "+a+" command"),h.call(this,r)}return y.call(this,a,o,t)},v.implementation=function(a,o,t){for(var r=0;r<a.length;r+=1){var i=a[r];if(-1!=i.indexOf("getprop")||"mount"==i||-1!=i.indexOf("build.prop")||"id"==i||"sh"==i){var s="grep";return e("Bypass "+a+" command"),h.call(this,s)}if("su"==i){s="awesome_tool";return e("Bypass "+a+" command"),h.call(this,s)}}return v.call(this,a,o,t)},g.implementation=function(a,o){for(var t=0;t<a.length;t+=1){var r=a[t];if(-1!=r.indexOf("getprop")||"mount"==r||-1!=r.indexOf("build.prop")||"id"==r||"sh"==r){var i="grep";return e("Bypass "+a+" command"),h.call(this,i)}if("su"==r){i="awesome_tool";return e("Bypass "+a+" command"),h.call(this,i)}}return g.call(this,a,o)},f.implementation=function(a,o){if(-1!=a.indexOf("getprop")||"mount"==a||-1!=a.indexOf("build.prop")||"id"==a||"sh"==a){var t="grep";return e("Bypass "+a+" command"),h.call(this,t)}if("su"==a){t="awesome_tool";return e("Bypass "+a+" command"),h.call(this,t)}return f.call(this,a,o)},m.implementation=function(a){for(var o=0;o<a.length;o+=1){var t=a[o];if(-1!=t.indexOf("getprop")||"mount"==t||-1!=t.indexOf("build.prop")||"id"==t||"sh"==t){var r="grep";return e("Bypass "+a+" command"),h.call(this,r)}if("su"==t){r="awesome_tool";return e("Bypass "+a+" command"),h.call(this,r)}}return m.call(this,a)},h.implementation=function(a){if(-1!=a.indexOf("getprop")||"mount"==a||-1!=a.indexOf("build.prop")||"id"==a||"sh"==a){var o="grep";return e("Bypass "+a+" command"),h.call(this,o)}if("su"==a){o="awesome_tool";return e("Bypass "+a+" command"),h.call(this,o)}return h.call(this,a)},r.contains.implementation=function(a){return"test-keys"==a?(e("Bypass test-keys check"),!1):this.contains.call(this,a)},i.get.overload("java.lang.String").implementation=function(a){return-1!=this.RootPropertiesKeys.indexOf(a)?(e("Bypass "+a),this.RootProperties[a]):this.get.call(this,a)},s.readLine.overload("boolean").implementation=function(){var a=this.readLine.overload("boolean").call(this);null===a||a.indexOf("ro.build.tags=test-keys")>-1&&(e("Bypass build.prop file read"),a=a.replace("ro.build.tags=test-keys","ro.build.tags=release-keys"));return a};n.command.overload("java.util.List");if(n.start.implementation=function(){for(var a=this.command.call(this),o=!1,t=0;t<a.size();t+=1){var r=a.get(t).toString();-1==r.indexOf("getprop")&&-1==r.indexOf("mount")&&-1==r.indexOf("build.prop")&&-1==r.indexOf("id")||(o=!0)}return o?(e("Bypass ProcessBuilder "+a),this.command.call(this,["grep"]),this.start.call(this)):-1!=a.indexOf("su")?(e("Bypass ProcessBuilder "+a),this.command.call(this,["awesome_tool"]),this.start.call(this)):this.start.call(this)},d){var x=c.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;","java.io.File","boolean"),k=c.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;","java.lang.String","java.io.FileDescriptor","java.io.FileDescriptor","java.io.FileDescriptor","boolean");x.implementation=function(a,o,t,r){for(var i=a,s=0;s<a.length;s+=1){var n=a[s];if(-1!=n.indexOf("getprop")||"mount"==n||-1!=n.indexOf("build.prop")||"id"==n){i=["grep"];e("Bypass "+a+" command")}if("su"==n){i=["awesome_tool"];e("Bypass "+a+" command")}}return x.call(this,i,o,t,r)},k.implementation=function(a,o,t,r,i,s,n){for(var l=a,d=0;d<a.length;d+=1){var c=a[d];if(-1!=c.indexOf("getprop")||"mount"==c||-1!=c.indexOf("build.prop")||"id"==c){l=["grep"];e("Bypass "+a+" command")}if("su"==c){l=["awesome_tool"];e("Bypass "+a+" command")}}return k.call(this,l,o,t,r,i,s,n)}}l&&(p.isInsideSecureHardware.implementation=function(){return e("Bypass isInsideSecureHardware"),!0})}))}native_based_bypasses(){Interceptor.attach(this.addresses[this.module_name].strstr,{onEnter:function(e){this.str_source=e[0],this.str_to_look_for=e[1],this.frida=Boolean(0);var a=this.str_source.readUtf8String();this.str_to_look_for.readUtf8String();-1==a.indexOf("frida")&&-1==a.indexOf("xposed")||(this.frida=Boolean(1))},onLeave:function(e){return this.frida&&e.replace(ptr(0)),e}}),Interceptor.attach(this.addresses[this.module_name].fopen,{onEnter:function(a){var o=a[0].readCString().split("/"),t=o[o.length-1];this.RootBinaries.indexOf(t)>-1&&(a[0].writeUtf8String("/notexists"),e("Bypass native fopen"))},onLeave:function(e){}}),Interceptor.attach(this.addresses[this.module_name].system,{onEnter:function(a){var o=a[0].readCString();e("SYSTEM CMD: "+o),-1==o.indexOf("getprop")&&"mount"!=o&&-1==o.indexOf("build.prop")&&"id"!=o||(e("Bypass native system: "+o),a[0].writeUtf8String("grep")),"su"==o&&(e("Bypass native system: "+o),a[0].writeUtf8String("awesome_tool"))},onLeave:function(e){}})}execute_hooks(){this.java_based_bypasses(),this.native_based_bypasses()}}export function anti_root_execute(){(new AntiRoot).execute_hooks()}
âœ„
{"version":3,"file":"log.js","names":["log","str","message","send","devlog"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/","sources":["log.ts"],"mappings":"OAAM,SAAUA,IAAIC,GAChB,IAAIC,EAAqC,CACzCA,YAAyB,WACzBA,EAAiB,QAAID,EACrBE,KAAKD,EACT,QAGM,SAAUE,OAAOH,GACnB,IAAIC,EAAqC,CACzCA,YAAyB,eACzBA,EAAqB,YAAID,EACzBE,KAAKD,EACT"}
âœ„
export function log(o){var e={contentType:"console"};e.console=o,send(e)}export function devlog(o){var e={contentType:"console_dev"};e.console_dev=o,send(e)}
âœ„
{"version":3,"file":"process_infos.js","names":["get_process_architecture","Process","arch","isAndroid","Java","available","platform","androidVersion","error","isiOS","isMacOS","isLinux","isWindows","getAndroidVersion","version","perform"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/util/","sources":["process_infos.ts"],"mappings":"OACM,SAAUA,2BACR,OAAOC,QAAQC,IACvB,QAGM,SAAUC,YACZ,IAAGC,KAAKC,WAAiC,SAApBJ,QAAQK,SAQzB,OAAO,EAPP,IAEI,OADAF,KAAKG,gBACE,C,CACV,MAAMC,GACH,OAAO,C,CAKnB,QAGM,SAAUC,QACZ,GAAkC,UAA/BT,4BAA8D,UAApBC,QAAQK,SAQjD,OAAO,EAPP,IAEI,OAAO,C,CACV,MAAME,GACH,OAAO,C,CAKnB,QAGM,SAAUE,UACZ,MAAkC,QAA/BV,4BAA4D,UAApBC,QAAQK,QAKvD,QAGM,SAAUK,UACZ,GAAwB,SAApBV,QAAQK,SAcR,OAAO,EAZP,GAAsB,GAAlBF,KAAKC,WAA0C,SAApBJ,QAAQK,SACnC,OAAO,EAEP,IAEI,OADAF,KAAKG,gBACE,C,CACT,MAAOC,GACL,OAAO,C,CAOvB,QAEM,SAAUI,YACZ,MAAwB,WAApBX,QAAQK,QAKhB,QAGM,SAAUO,oBACZ,IAAIC,EAAU,KAMV,OALJV,KAAKW,SAAQ,WACTD,EAAUV,KAAKG,cACf,KAE+BO,CAIvC"}
âœ„
export function get_process_architecture(){return Process.arch}export function isAndroid(){if(!Java.available||"linux"!=Process.platform)return!1;try{return Java.androidVersion,!0}catch(r){return!1}}export function isiOS(){if("arm64"!==get_process_architecture()||"darwin"!=Process.platform)return!1;try{return!0}catch(r){return!1}}export function isMacOS(){return"x64"===get_process_architecture()&&"darwin"==Process.platform}export function isLinux(){if("linux"!=Process.platform)return!1;if(0==Java.available&&"linux"==Process.platform)return!0;try{return Java.androidVersion,!1}catch(r){return!0}}export function isWindows(){return"windows"==Process.platform}export function getAndroidVersion(){var r="-1";return Java.perform((function(){r=Java.androidVersion})),+r}
âœ„
{"version":3,"file":"gnutls_windows.js","names":["GnuTLS","socket_library","GnuTLS_Windows","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_tls_keys_callback_hook","gnutls_execute","gnu_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["gnutls_windows.ts"],"mappings":"iBACQA,MAAc,gDACbC,MAAsB,4BAEzB,MAAOC,uBAAuBF,EAEhCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,8BAGT,CAEAC,iCAEA,SAKE,SAAUC,eAAeR,EAAmBC,GAC9C,IAAIQ,EAAU,IAAIX,eAAeE,EAAWH,EAAgBI,GAG5D,GAFAQ,EAAQL,gBAEJH,EAAc,CACd,MAAMS,EAAiBD,EAAQE,UAAUX,GAErCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAGzD"}
âœ„
import{GnuTLS as s}from"../ssl_lib/gnutls.js";import{socket_library as t}from"./windows_agent.js";export class GnuTLS_Windows extends s{constructor(s,t,e){super(s,t),this.moduleName=s,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}install_tls_keys_callback_hook(){}}export function gnutls_execute(s,e){var o=new GnuTLS_Windows(s,t,e);if(o.execute_hooks(),e){const t=o.addresses[s];Object.keys(t).length>0&&(global.init_addresses[s]=t)}}
âœ„
{"version":3,"file":"matrixssl_windows.js","names":["matrix_SSL","socket_library","matrix_SSL_Windows","constructor","moduleName","is_base_hook","super","this","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","install_helper_hook","install_tls_keys_callback_hook","matrixSSL_execute","matrix_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["matrixssl_windows.ts"],"mappings":"qBACQA,MAAkB,mDACjBC,MAAsB,4BAEzB,MAAOC,2BAA2BF,EAEpCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CAGAO,gBACID,KAAKE,8BACLF,KAAKG,+BACLH,KAAKI,qBAGT,CAEAC,iCAEA,SAKE,SAAUC,kBAAkBT,EAAmBC,GACjD,IAAIS,EAAa,IAAIZ,mBAAmBE,EAAWH,EAAgBI,GAGnE,GAFAS,EAAWN,gBAEPH,EAAc,CACd,MAAMU,EAAiBD,EAAWE,UAAUZ,GAExCa,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeX,GAAcW,E,CAGzD"}
âœ„
import{matrix_SSL as s}from"../ssl_lib/matrixssl.js";import{socket_library as t}from"./windows_agent.js";export class matrix_SSL_Windows extends s{constructor(s,t,e){super(s,t),this.moduleName=s,this.socket_library=t}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),this.install_helper_hook()}install_tls_keys_callback_hook(){}}export function matrixSSL_execute(s,e){var o=new matrix_SSL_Windows(s,t,e);if(o.execute_hooks(),e){const t=o.addresses[s];Object.keys(t).length>0&&(global.init_addresses[s]=t)}}
âœ„
{"version":3,"file":"mbedTLS_windows.js","names":["mbed_TLS","socket_library","mbed_TLS_Windows","constructor","moduleName","is_base_hook","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","mbedTLS_execute","mbedTLS_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["mbedTLS_windows.ts"],"mappings":"mBACQA,MAAgB,iDACfC,MAAsB,4BAEzB,MAAOC,yBAAyBF,EAElCG,YAAmBC,EAA0BH,EAAuBI,GAChEC,MAAMF,EAAWH,GADFM,KAAAH,aAA0BG,KAAAN,gBAE7C,CASAO,iCAEA,CAEAC,gBACIF,KAAKG,8BACLH,KAAKI,8BACT,SAKE,SAAUC,gBAAgBR,EAAmBC,GAC/C,IAAIQ,EAAc,IAAIX,iBAAiBE,EAAWH,EAAgBI,GAGlE,GAFAQ,EAAYJ,gBAERJ,EAAc,CACd,MAAMS,EAAiBD,EAAYE,UAAUX,GAEzCY,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeV,GAAcU,E,CAGzD"}
âœ„
import{mbed_TLS as e}from"../ssl_lib/mbedTLS.js";import{socket_library as s}from"./windows_agent.js";export class mbed_TLS_Windows extends e{constructor(e,s,t){super(e,s),this.moduleName=e,this.socket_library=s}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function mbedTLS_execute(e,t){var o=new mbed_TLS_Windows(e,s,t);if(o.execute_hooks(),t){const s=o.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"nss_windows.js","names":["NSS","socket_library","NSS_Windows","constructor","moduleName","is_base_hook","library_method_mapping","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","nss_execute","nss_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["nss_windows.ts"],"mappings":"cACQA,MAAW,6CACVC,MAAsB,4BAEzB,MAAOC,oBAAoBF,EAE7BG,YAAmBC,EAA0BH,EAAuBI,GAChE,IAAIC,EAA2D,GAC/DA,EAAuB,IAAIF,MAAiB,CAAC,WAAY,UAAW,2BAA4B,iBAAkB,iBAAkB,yBAEpIE,EAAuB,aAAe,CAAC,eAAgB,mBAAoB,yBAE3EC,MAAMH,EAAWH,EAAeK,GANjBE,KAAAJ,aAA0BI,KAAAP,gBAO7C,CAEAQ,iCAEA,CAGAC,gBACIF,KAAKG,8BACLH,KAAKI,8BAET,SAKE,SAAUC,YAAYT,EAAmBC,GAC3C,IAAIS,EAAU,IAAIZ,YAAYE,EAAWH,EAAgBI,GAGzD,GAFAS,EAAQJ,gBAEJL,EAAc,CACd,MAAMU,EAAiBD,EAAQE,UAAUZ,GAErCa,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeX,GAAcW,E,CAIzD"}
âœ„
import{NSS as e}from"../ssl_lib/nss.js";import{socket_library as s}from"./windows_agent.js";export class NSS_Windows extends e{constructor(e,s,t){var o={};o[`*${e}*`]=["PR_Write","PR_Read","PR_FileDesc2NativeHandle","PR_GetPeerName","PR_GetSockName","PR_GetNameForIdentity"],o["*ssl*.dll"]=["SSL_ImportFD","SSL_GetSessionID","SSL_HandshakeCallback"],super(e,s,o),this.moduleName=e,this.socket_library=s}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function nss_execute(e,t){var o=new NSS_Windows(e,s,t);if(o.execute_hooks(),t){const s=o.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"openssl_boringssl_windows.js","names":["OpenSSL_BoringSSL","socket_library","OpenSSL_BoringSSL_Windows","constructor","moduleName","is_base_hook","mapping","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","boring_execute","boring_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["openssl_boringssl_windows.ts"],"mappings":"4BACQA,MAAyB,2DACxBC,MAAsB,4BAEzB,MAAOC,kCAAkCF,EAE3CG,YAAmBC,EAA0BH,EAAuBI,GAChE,IAAIC,EAA2C,GAC/CA,EAAQ,GAAGF,KAAgB,CAAC,WAAY,YAAa,aAAc,kBAAmB,qBAAsB,WAC5GE,EAAQ,IAAIL,MAAqB,CAAC,cAAe,cAAe,QAAS,SACzEM,MAAMH,EAAWH,EAAgBI,EAAcC,GAJhCE,KAAAJ,aAA0BI,KAAAP,gBAK7C,CASAQ,iCAEA,CAEAC,gBACIF,KAAKG,8BACLH,KAAKI,8BACT,SAKE,SAAUC,eAAeT,EAAmBC,GAC9C,IAAIS,EAAa,IAAIZ,0BAA0BE,EAAWH,EAAgBI,GAG1E,GAFAS,EAAWJ,gBAEPL,EAAc,CACd,MAAMU,EAAiBD,EAAWE,UAAUZ,GAExCa,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeX,GAAcW,E,CAGzD"}
âœ„
import{OpenSSL_BoringSSL as e}from"../ssl_lib/openssl_boringssl.js";import{socket_library as s}from"./windows_agent.js";export class OpenSSL_BoringSSL_Windows extends e{constructor(e,s,t){let o={};o[`${e}`]=["SSL_read","SSL_write","SSL_get_fd","SSL_get_session","SSL_SESSION_get_id","SSL_new"],o[`*${s}*`]=["getpeername","getsockname","ntohs","ntohl"],super(e,s,t,o),this.moduleName=e,this.socket_library=s}install_tls_keys_callback_hook(){}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function boring_execute(e,t){var o=new OpenSSL_BoringSSL_Windows(e,s,t);if(o.execute_hooks(),t){const s=o.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"sspi.js","names":["readAddresses","getBaseAddress","socket_library","devlog","log","experimental","offsets","keylog","key","tlsVersion","message","send","SSPI_Windows","constructor","moduleName","is_base_hook","this","library_method_mapping","addresses","module_name","sspi","sockets","socketBaseAddress","method","Object","keys","absolute","ptr","address","add","libraryBaseAddress","install_plaintext_read_hook","Interceptor","attach","onEnter","args","pMessage","onLeave","cBuffers","readULong","pBuffers","readPointer","secBuffers","i","secBuffer","push","length","size","type","bufferPointer","bytes","readByteArray","install_plaintext_write_hook","install_tls_keys_hook","client_randoms","buf2hex","buffer","Array","prototype","map","call","Uint8Array","x","toString","slice","join","parse_h_master_key","pMasterKey","master_key","parse_parameter_list","pParameterList","calling_func","buffer_count","readU32","buffers","buf","buf_size","buf_type","buf_buf","len","toInt32","msg_type","readU8","version","readU16","crandom","threadId","retval","phMasterKey","hSslProvider","client_random","hMasterKey","stages","get_secret_from_BDDD","struct_BDDD","struct_YKSM","secret_ptr","retkey1","retkey2","suffix","key1","key2","retkey","execute_hooks","sspi_execute","sspi_ssl","init_addresses","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["sspi.ts"],"mappings":"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"}
âœ„
import{readAddresses as e,getBaseAddress as s}from"../shared/shared_functions.js";import{socket_library as t}from"./windows_agent.js";import{devlog as r,log as a}from"../util/log.js";import{experimental as i,offsets as n}from"../ssl_log.js";var d=(e,s)=>{r(`Exporting TLS 1.${s} handshake keying material`);var t={contentType:"keylog"};t.keylog=e,send(t)};export class SSPI_Windows{constructor(t,r,d){if(this.moduleName=t,this.socket_library=r,this.library_method_mapping={},this.library_method_mapping[`*${t}*`]=["DecryptMessage","EncryptMessage"],i&&(a("ncrypt.dll was loaded & will be hooked on Windows!"),this.library_method_mapping["*ncrypt*.dll"]=["SslHashHandshake","SslGenerateMasterKey","SslImportMasterKey","SslGenerateSessionKeys","SslExpandExporterMasterKey","SslExpandTrafficKeys"]),this.library_method_mapping[`*${r}*`]=["getpeername","getsockname","ntohs","ntohl"],this.addresses=e(t,this.library_method_mapping),this.module_name=t,"{OFFSETS}"!=n&&null!=n.sspi){if(null!=n.sockets){const e=s(r);for(const s of Object.keys(n.sockets))this.addresses[this.module_name][`${s}`]=n.sockets[`${s}`].absolute||null==e?ptr(n.sockets[`${s}`].address):e.add(ptr(n.sockets[`${s}`].address))}const e=s(t);null==e&&a("Unable to find library base address! Given address values will be interpreted as absolute ones!");for(const s of Object.keys(n.sspi))this.addresses[this.module_name][`${s}`]=n.sspi[`${s}`].absolute||null==e?ptr(n.sspi[`${s}`].address):e.add(ptr(n.sspi[`${s}`].address))}}install_plaintext_read_hook(){Interceptor.attach(this.addresses[this.module_name].DecryptMessage,{onEnter:function(e){this.pMessage=e[1]},onLeave:function(){this.cBuffers=this.pMessage.add(4).readULong(),this.pBuffers=this.pMessage.add(8).readPointer(),this.secBuffers=[];for(let s=0;s<this.cBuffers;s++){var e=this.pBuffers.add(16*s);this.secBuffers.push(e)}for(let e=0;e<this.secBuffers.length;e++){var s=this.secBuffers[e].add(0).readULong(),t=this.secBuffers[e].add(4).readULong(),r=this.secBuffers[e].add(8).readPointer();if(1==t){var a=r.readByteArray(s),i={ss_family:"AF_INET",src_port:444,src_addr:222,dst_port:443,dst_addr:222,function:"DecryptMessage",contentType:"datalog",ssl_session_id:10};send(i,a)}}}})}install_plaintext_write_hook(){Interceptor.attach(this.addresses[this.module_name].EncryptMessage,{onEnter:function(e){this.pMessage=e[2],this.cBuffers=this.pMessage.add(4).readULong(),this.pBuffers=this.pMessage.add(8).readPointer(),this.secBuffers=[];for(let e=0;e<this.cBuffers;e++){var s=this.pBuffers.add(16*e);this.secBuffers.push(s)}for(let e=0;e<this.secBuffers.length;e++){var t=this.secBuffers[e].add(0).readULong(),r=this.secBuffers[e].add(4).readULong(),a=this.secBuffers[e].add(8).readPointer();if(1==r){var i=a.readByteArray(t),n={ss_family:"AF_INET",src_port:443,src_addr:222,dst_port:444,dst_addr:222,function:"EncryptMessage",contentType:"datalog",ssl_session_id:10};send(n,i)}}}})}install_tls_keys_hook(){var e={},s=function(e){return Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)})).join("")},t=function(e){var t=e.add(16).readPointer().add(28).readByteArray(48);return s(t)},a=function(e,t){for(var a=e.add(4).readU32(),i=e.add(8).readPointer(),n=0;n<a;n++){var d=i.add(16*n),o=d.readU32(),h=d.add(4).readU32(),l=d.add(8).readPointer().readByteArray(o);if(20==h)return r("Got client random from "+t+"'s pParameterList: "+s(l)),s(l)}return null};null!=this.addresses[this.module_name].SslHashHandshake&&Interceptor.attach(this.addresses[this.module_name].SslHashHandshake,{onEnter:function(t){var a=ptr(t[2]),i=t[3].toInt32(),n=(a.readByteArray(i),a.readU8()),d=a.add(4).readU16();if(1==n&&771==d){var o=s(a.add(6).readByteArray(32));r("Got client random from SslHashHandshake: "+o),e[this.threadId]=o}},onLeave:function(e){}}),null!=this.addresses[this.module_name].SslGenerateMasterKey&&Interceptor.attach(this.addresses[this.module_name].SslGenerateMasterKey,{onEnter:function(s){this.phMasterKey=ptr(s[3]),this.hSslProvider=ptr(s[0]),this.pParameterList=ptr(s[6]),this.client_random=a(this.pParameterList,"SslGenerateMasterKey")||e[this.threadId]||"???"},onLeave:function(e){var s=t(this.phMasterKey.readPointer());r("Got masterkey from SslGenerateMasterKey"),d("CLIENT_RANDOM "+this.client_random+" "+s,2)}}),null!=this.addresses[this.module_name].SslImportMasterKey&&Interceptor.attach(this.addresses[this.module_name].SslImportMasterKey,{onEnter:function(s){this.phMasterKey=ptr(s[2]),this.pParameterList=ptr(s[5]),this.client_random=a(this.pParameterList,"SslImportMasterKey")||e[this.threadId]||"???"},onLeave:function(e){var s=t(this.phMasterKey.readPointer());r("[*] Got masterkey from SslImportMasterKey"),d("CLIENT_RANDOM "+this.client_random+" "+s,2)}}),null!=this.addresses[this.module_name].SslGenerateSessionKeys&&Interceptor.attach(this.addresses[this.module_name].SslGenerateSessionKeys,{onEnter:function(s){this.hMasterKey=ptr(s[1]),this.hSslProvider=ptr(s[0]),this.pParameterList=ptr(s[4]),this.client_random=a(this.pParameterList,"SslGenerateSessionKeys")||e[this.threadId]||"???";var i=t(this.hMasterKey);r("Got masterkey from SslGenerateSessionKeys"),d("CLIENT_RANDOM "+this.client_random+" "+i,2)},onLeave:function(e){}});var i={},n=function(e){var s=e.add(16).readPointer().add(32).readPointer().add(16).readPointer(),t=s.add(24).readPointer(),r=s.add(16).readU32();return t.readByteArray(r)};null!=this.addresses[this.module_name].SslExpandTrafficKeys&&Interceptor.attach(this.addresses[this.module_name].SslExpandTrafficKeys,{onEnter:function(s){this.retkey1=ptr(s[3]),this.retkey2=ptr(s[4]),this.client_random=e[this.threadId]||"???",i[this.threadId]?(i[this.threadId]=null,this.suffix="TRAFFIC_SECRET_0"):(i[this.threadId]="handshake",this.suffix="HANDSHAKE_TRAFFIC_SECRET")},onLeave:function(e){var t=n(this.retkey1.readPointer()),r=n(this.retkey2.readPointer());d("CLIENT_"+this.suffix+" "+this.client_random+" "+s(t),3),d("SERVER_"+this.suffix+" "+this.client_random+" "+s(r),3)}}),null!=this.addresses[this.module_name].SslExpandExporterMasterKey&&Interceptor.attach(this.addresses[this.module_name].SslExpandExporterMasterKey,{onEnter:function(s){this.retkey=ptr(s[3]),this.client_random=e[this.threadId]||"???"},onLeave:function(e){var t=this.retkey.readPointer().add(16).readPointer().add(32).readPointer().add(16).readPointer().add(24).readPointer().readByteArray(48);d("EXPORTER_SECRET "+this.client_random+" "+s(t),3)}})}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook(),i&&this.install_tls_keys_hook()}}export function sspi_execute(e,s){var r=new SSPI_Windows(e,t,s);if(r.execute_hooks(),s){const s=r.addresses[e];Object.keys(s).length>0&&(global.init_addresses[e]=s)}}
âœ„
{"version":3,"file":"windows_agent.js","names":["module_library_mapping","log","devlog","getModuleNames","ssl_library_loader","invokeHookingFunction","sspi_execute","boring_execute","gnutls_execute","mbedTLS_execute","nss_execute","wolfssl_execute","matrixSSL_execute","moduleNames","socket_library","load_windows_hooking_agent","is_base_hook","hook_Windows_SSL_Libs","loadLibraryExW","ApiResolver","enumerateMatches","length","console","Interceptor","attach","address","onLeave","retval","moduleName","ModuleMap","findName","map","regex","RegExp","func","test","error","hook_Windows_Dynamic_Loader"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["windows_agent.ts"],"mappings":"iCAASA,MAAiD,+CACjDC,YAAKC,MAAc,0CACnBC,wBAAgBC,2BAAoBC,MAA6B,uDACjEC,MAAoB,qCACpBC,MAAsB,0DACtBC,MAAsB,gDACtBC,MAAuB,6CACvBC,MAAmB,6CACnBC,MAAuB,mDACvBC,MAAyB,yBAGlC,IACIC,EAA6BV,WAE1B,MAAMW,eAAiB,oBAyCxB,SAAUC,6BACZf,EAAqC,QAAI,CACrC,CAAC,0CAA2CK,EAAsBE,IAClE,CAAC,+BAAgCF,EAAsBM,IACvD,CAAC,wCAAyCN,EAAsBG,IAChE,CAAC,0BAA2BH,EAAsBK,IAClD,CAAC,kCAAmCL,EAAsBC,IAC1D,CAAC,eAAgBD,EAAsBI,IACvC,CAAC,iBAAmBJ,EAAsBO,KAZlD,SAA+BZ,EAA4EgB,GACvGZ,EAzCiB,UAyCkBJ,EAAuBa,EAAY,UAAWG,EACrF,CAYIC,CAAsBjB,GAAwB,GAjDlD,SAAqCA,EAA4EgB,GAC7G,IAGI,IAAIE,EAD0B,IAAIC,YAAY,UAChBC,iBAAiB,0CAE/C,GAA6B,GAAzBF,EAAeG,OAAa,OAAOC,QAAQrB,IAAI,uCAGnDsB,YAAYC,OAAON,EAAe,GAAGO,QAAS,CAC1CC,QAAQC,GAEJ,IACIC,GADM,IAAIC,WACOC,SAASH,GAC9B,GAAmB,OAAfC,EAEJ,IAAK,IAAIG,KAAO/B,EAAqC,QAAG,CACpD,IAAIgC,EAAQ,IAAIC,OAAOF,EAAI,IACvBG,EAAOH,EAAI,GAEXC,EAAMG,KAAKP,KACX3B,EAAI,GAAG2B,6CACPM,EAAKN,EAAYZ,G,CAI7B,IAEJM,QAAQrB,IAAI,qC,CACd,MAAOmC,GACLlC,EAAO,iBAAmBkC,GAC1BnC,EAAI,yC,CAEZ,CAiBIoC,CAA4BrC,GAAwB,EACxD"}
âœ„
import{module_library_mapping as o}from"../shared/shared_structures.js";import{log as s,devlog as r}from"../util/log.js";import{getModuleNames as l,ssl_library_loader as i,invokeHookingFunction as e}from"../shared/shared_functions.js";import{sspi_execute as n}from"./sspi.js";import{boring_execute as d}from"./openssl_boringssl_windows.js";import{gnutls_execute as t}from"./gnutls_windows.js";import{mbedTLS_execute as w}from"./mbedTLS_windows.js";import{nss_execute as a}from"./nss_windows.js";import{wolfssl_execute as m}from"./wolfssl_windows.js";import{matrixSSL_execute as p}from"./matrixssl_windows.js";var f=l();export const socket_library="WS2_32.dll";export function load_windows_hooking_agent(){o.windows=[[/^(libssl|LIBSSL)-[0-9]+(_[0-9]+)?\.dll$/,e(d)],[/^.*(wolfssl|WOLFSSL).*\.dll$/,e(m)],[/^.*(libgnutls|LIBGNUTLS)-[0-9]+\.dll$/,e(t)],[/^(nspr|NSPR)[0-9]*\.dll/,e(a)],[/(sspicli|SSPICLI|SspiCli)\.dll$/,e(n)],[/mbedTLS\.dll/,e(w)],["/matrixSSL.dll",e(p)]],function(o,s){i("windows",o,f,"Windows",s)}(o,!0),function(o,l){try{var i=new ApiResolver("module").enumerateMatches("exports:KERNELBASE.dll!*LoadLibraryExW");if(0==i.length)return console.log("[-] Missing windows dynamic loader!");Interceptor.attach(i[0].address,{onLeave(r){let i=(new ModuleMap).findName(r);if(null!==i)for(let r of o.windows){let o=new RegExp(r[0]),e=r[1];o.test(i)&&(s(`${i} was loaded & will be hooked on Windows!`),e(i,l))}}}),console.log("[*] Windows dynamic loader hooked.")}catch(o){r("Loader error: "+o),s("No dynamic loader present for hooking.")}}(o,!1)}
âœ„
{"version":3,"file":"wolfssl_windows.js","names":["WolfSSL","socket_library","log","WolfSSL_Windows","constructor","moduleName","is_base_hook","mapping","super","this","install_tls_keys_callback_hook","execute_hooks","install_plaintext_read_hook","install_plaintext_write_hook","wolfssl_execute","wolf_ssl","init_addresses","addresses","Object","keys","length","global"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/friTap/agent/windows/","sources":["wolfssl_windows.ts"],"mappings":"kBACQA,MAAe,iDACdC,MAAsB,mCACtBC,MAAW,wBAEd,MAAOC,wBAAwBH,EAEjCI,YAAmBC,EAA0BJ,EAAuBK,GAChE,IAAIC,EAA2C,GAC/CA,EAAQ,GAAGF,KAAgB,CAAC,eAAgB,gBAAiB,iBAAkB,sBAAuB,kBAAmB,sBACzHE,EAAQ,IAAIN,MAAqB,CAAC,cAAe,cAAe,QAAS,SACzEO,MAAMH,EAAWJ,EAAgBM,GAJlBE,KAAAJ,aAA0BI,KAAAR,gBAK7C,CAGAS,iCACIR,EAAI,wDACR,CAKAS,gBACIF,KAAKG,8BACLH,KAAKI,8BAET,SAKE,SAAUC,gBAAgBT,EAAmBC,GAC/C,IAAIS,EAAW,IAAIZ,gBAAgBE,EAAWJ,EAAgBK,GAG9D,GAFAS,EAASJ,gBAELL,EAAc,CACd,MAAMU,EAAiBD,EAASE,UAAUZ,GAEtCa,OAAOC,KAAKH,GAAgBI,OAAS,IACpCC,OAAeL,eAAeX,GAAcW,E,CAGzD"}
âœ„
import{WolfSSL as e}from"../ssl_lib/wolfssl.js";import{socket_library as o}from"./windows_agent.js";import{log as t}from"../util/log.js";export class WolfSSL_Windows extends e{constructor(e,o,t){let s={};s[`${e}`]=["wolfSSL_read","wolfSSL_write","wolfSSL_get_fd","wolfSSL_get_session","wolfSSL_connect","wolfSSL_KeepArrays"],s[`*${o}*`]=["getpeername","getsockname","ntohs","ntohl"],super(e,o,s),this.moduleName=e,this.socket_library=o}install_tls_keys_callback_hook(){t("Key extraction currently not implemented for windows!")}execute_hooks(){this.install_plaintext_read_hook(),this.install_plaintext_write_hook()}}export function wolfssl_execute(e,t){var s=new WolfSSL_Windows(e,o,t);if(s.execute_hooks(),t){const o=s.addresses[e];Object.keys(o).length>0&&(global.init_addresses[e]=o)}}
âœ„
{"version":3,"file":"dynamic_hook_injector.js","names":["_inject_hooks","pid","process","hook_list","forEach","item","methods","method","name_split","split","class_name","slice","join","method_name","length","startsWith","taxonomy_id","description","_send_msg","msg","_msg","message_type","type","dump","data_type","timestamp","Date","now","data","send","target_class","Java","use","overloads","Exception","overload","implementation","args","call","arguments","returned_value","this","apply","stacktrace","$new","getStackTrace","toString","class","$className","error","console","log","_inject_hook","inject_hooks","perform"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/pirogue/","sources":["dynamic_hook_injector.js"],"mappings":"AAGA,SAASA,EAAcC,EAAKC,EAASC,GACjCA,EAAUC,SAAQC,IACdA,EAAKC,QAAQF,SAAQG,IACjB,IACI,MAAMC,EAAaD,EAAOE,MAAM,KAC1BC,EAAaF,EAAWG,MAAM,GAAI,GAAGC,KAAK,KAAKD,MAAM,GACrDE,EAAcL,EAAWA,EAAWM,OAAS,GACnD,GAAIP,EAAOQ,WAAW,KAClB,KAapB,SAAsBd,EAAKC,EAASc,EAAaC,EAAaP,EAAYG,GACtE,SAASK,EAAUC,GACf,MAAMC,EAAO,CACTC,aAAc,iBACdC,KAAM,mBACNC,KAAM,oBACNC,UAAW,OACXvB,IAAKA,EACLC,QAASA,EACTuB,UAAWC,KAAKC,MAChBC,KAAMT,GAEVU,KAAKT,EACT,CAEA,MAAMU,EAAeC,KAAKC,IAAItB,GACxBuB,EAAYH,EAAajB,GAAaoB,UACtCC,EAAYH,KAAKC,IAAI,uBAE3BC,EAAU7B,SAAQ+B,IACdA,EAASC,eAAiB,WACtB,MAAMX,EAAYC,KAAKC,MACvB,IACI,MAAMU,EAAO,GAAG1B,MAAM2B,KAAKC,WACrBC,EAAiBC,KAAK5B,GAAa6B,MAAMD,KAAMF,WAC/CI,EAAaT,EAAUU,OAAOC,gBAAgBC,WAAWrC,MAAM,KAWrE,OAVAS,EAAU,CACNF,YAAaA,EACbC,YAAaA,EACbQ,UAAWA,EACXsB,MAAOjB,EAAakB,WACpBzC,OAAQM,EACR0B,UAAWF,EACXG,eAAgBA,GAAkC,KAClDG,WAAYA,IAETH,C,CACT,MAAOS,GACLC,QAAQC,IAAI,aAAczC,EAAYG,EAAaoC,E,CAE3D,CAAC,GAET,CAtDwBG,CAAanD,EAAKC,EAASG,EAAKW,YAAaX,EAAKY,YAAaP,EAAYG,E,CAC7E,MAAOoC,GACLC,QAAQC,IAAI,uBAAwBzC,EAAYH,EAAQ0C,E,EAGlE,MAAOA,GACLC,QAAQC,IAAI,uBAAwB5C,EAAQ0C,E,IAElD,GAEV,QA8CM,SAAUI,aAAapD,EAAKC,EAASC,GACvC4B,KAAKuB,SAAQ,KACTtD,EAAcC,EAAKC,EAASC,EAAU,GAE9C"}
âœ„
function o(o,t,a){a.forEach((a=>{a.methods.forEach((e=>{try{const n=e.split("/"),c=n.slice(0,-1).join("/").slice(1),s=n[n.length-1];if(e.startsWith("L"))try{!function(o,t,a,e,n,c){function s(a){const e={message_type:"java_hook_data",type:"dynamic_hook_log",dump:"dynamic_hook.json",data_type:"json",pid:o,process:t,timestamp:Date.now(),data:a};send(e)}const i=Java.use(n),r=i[c].overloads,l=Java.use("java.lang.Exception");r.forEach((o=>{o.implementation=function(){const o=Date.now();try{const t=[].slice.call(arguments),n=this[c].apply(this,arguments),r=l.$new().getStackTrace().toString().split(",");return s({taxonomy_id:a,description:e,timestamp:o,class:i.$className,method:c,arguments:t,returned_value:n||null,stacktrace:r}),n}catch(o){console.log("Hook error",n,c,o)}}}))}(o,t,a.taxonomy_id,a.description,c,s)}catch(o){console.log("Hook injection error",c,e,o)}}catch(o){console.log("Hook injection error",e,o)}}))}))}export function inject_hooks(t,a,e){Java.perform((()=>{o(t,a,e)}))}
âœ„
{"version":3,"file":"log_ad_ids.js","names":["log_ad_ids","Java","perform","use","getAdvertisingIdInfo","overload","implementation","x","i","this","id","getId","msg","type","dump","data_type","data","console","log","send","e","_log_ad_ids"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/pirogue/","sources":["log_ad_ids.js"],"mappings":"OAoBM,SAAUA,aACZC,KAAKC,SAAQ,MArBjB,WACI,IACmBD,KAAKE,IAAI,6DACjBC,qBAAqBC,SAAS,2BAA2BC,eAAiB,SAAUC,GACvF,MAAMC,EAAIC,KAAKL,qBAAqBG,GAC9BG,EAAKF,EAAEG,QACPC,EAAM,CACRC,KAAQ,cACRC,KAAQ,aACRC,UAAa,QACbC,KAAQN,GAIZ,OAFAO,QAAQC,IAAI,mBAAmBR,KAC/BS,KAAKP,GACEJ,CACX,C,CACF,MAAOY,G,CAEb,CAIQC,EAAa,GAErB"}
âœ„
export function log_ad_ids(){Java.perform((()=>{!function(){try{Java.use("com.google.android.gms.ads.identifier.AdvertisingIdClient").getAdvertisingIdInfo.overload("android.content.Context").implementation=function(t){const n=this.getAdvertisingIdInfo(t),e=n.getId(),d={type:"ssl_key_log",dump:"ad_ids.txt",data_type:"plain",data:e};return console.log(`Advertising ID: ${e}`),send(d),n}}catch(t){}}()}))}
âœ„
{"version":3,"file":"log_aes_info.js","names":["log_aes_info","pid","process","complete_bytes","Array","index","secretKeySpecDef","Java","use","ivParameterSpecDef","cipherDef","cipherDoFinal_1","doFinal","overload","cipherDoFinal_2","cipherDoFinal_3","cipherDoFinal_4","cipherDoFinal_5","cipherDoFinal_6","cipherUpdate_1","update","cipherUpdate_2","cipherUpdate_3","cipherUpdate_4","secretKeySpecDef_init_1","$init","secretKeySpecDef_init_2","info","iv","alg","plain","encoded","msg","type","dump","data_type","timestamp","Date","now","data","toHexString","in","out","key","send","byteArray","from","byte","toString","slice","join","b2s","array","n","result","i","length","String","fromCharCode","addtoarray","arr","implementation","call","this","off","len","ret","getIV","getAlgorithm","a","b","c","d"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/pirogue/","sources":["log_aes_info.js"],"mappings":"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"}
âœ„
export function log_aes_info(t,n){var i=new Array,e=0,o=Java.use("javax.crypto.spec.SecretKeySpec"),a=Java.use("javax.crypto.spec.IvParameterSpec"),r=Java.use("javax.crypto.Cipher"),l=r.doFinal.overload(),s=r.doFinal.overload("[B"),u=r.doFinal.overload("[B","int"),c=r.doFinal.overload("[B","int","int"),p=r.doFinal.overload("[B","int","int","[B"),m=r.doFinal.overload("[B","int","int","[B","int"),d=r.update.overload("[B"),v=r.update.overload("[B","int","int"),h=r.update.overload("[B","int","int","[B"),g=r.update.overload("[B","int","int","[B","int"),f=o.$init.overload("[B","java.lang.String"),B=o.$init.overload("[B","int","int","java.lang.String");a.$init.overload("[B"),a.$init.overload("[B","int","int");function y(o,a,r,l){const s={type:"aes_info_log",dump:"aes_info.json",data_type:"json",pid:t,process:n,timestamp:Date.now(),data:{iv:_(o),alg:a,in:_(r),out:_(l),key:""}};send(s),i=[],e=0}function _(t){return null===t?"":Array.from(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join("")}function j(t){var n,i="";if(null===t)return i;for(var e=0;e<t.length;e++)i+=String.fromCharCode((t[e]%(n=256)+n)%n);return i}function A(t){for(var n=0;n<t.length;n++)i[e]=t[n],e+=1}f.implementation=function(i,e){j(i);const o={type:"aes_info_log",dump:"aes_info.json",data_type:"json",pid:t,process:n,timestamp:Date.now(),data:{iv:"",alg:e,in:"",out:"",key:_(i)}};return send(o),f.call(this,i,e)},B.implementation=function(i,e,o,a){j(i);const r={type:"aes_info_log",dump:"aes_info.json",data_type:"json",pid:t,process:n,timestamp:Date.now(),data:{iv:"",alg:a,in:"",out:"",key:_(i)}};return send(r),B.call(this,i,e,o,a)},l.implementation=function(){var t=l.call(this);return y(this.getIV(),this.getAlgorithm(),i,t),t},s.implementation=function(t){A(t);var n=s.call(this,t);return y(this.getIV(),this.getAlgorithm(),i,n),n},u.implementation=function(t,n){A(t);var e=u.call(this,t,n);return y(this.getIV(),this.getAlgorithm(),i,e),e},c.implementation=function(t,n,e){A(t);var o=c.call(this,t,n,e);return y(this.getIV(),this.getAlgorithm(),i,o),o},p.implementation=function(t,n,e,o){A(t);var a=p.call(this,t,n,e,o);return y(this.getIV(),this.getAlgorithm(),i,a),a},m.implementation=function(t,n,e,o,a){A(t);var r=m.call(this,t,n,e,o,a);return y(this.getIV(),this.getAlgorithm(),i,o),r},d.implementation=function(t){return A(t),d.call(this,t)},v.implementation=function(t,n,i){return A(t),v.call(this,t,n,i)},h.implementation=function(t,n,i,e){return A(t),h.call(this,t,n,i,e)},g.implementation=function(t,n,i,e,o){return A(t),g.call(this,t,n,i,e,o)}}
âœ„
{"version":3,"file":"log_socket_operations.js","names":["_socket_trace","pid","process","Process","getModuleByName","linux","darwin","windows","platform","enumerateExports","filter","ex","type","some","prefix","name","indexOf","forEach","Interceptor","attach","address","onEnter","args","fd","toInt32","socket_type","Socket","dest_addr","peerAddress","local_addr","localAddress","socket_info","socket_fd","id","thread_id","this","threadId","socket_event_type","dest_ip","ip","dest_port","port","local_ip","local_port","Java","vm","tryGetEnv","trace","use","$new","getStackTrace","stack","map","trace_elt","class","getClassName","file","getFileName","line","getLineNumber","method","getMethodName","is_native","isNativeMethod","str","toString","msg","_msg","dump","data_type","timestamp","Date","now","data","send","_send_msg","socket_trace"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/pirogue/","sources":["log_socket_operations.js"],"mappings":"AAAA,SAASA,EAAcC,EAAKC,GAexBC,QACCC,gBAAgB,CAAEC,MAAO,UAAWC,OAAQ,oBAAqBC,QAAS,cAAeJ,QAAQK,WACjGC,mBAAmBC,QAAOC,GAAkB,aAAZA,EAAGC,MAAuB,CAAC,UAAW,OAAQ,OAAQ,OAAQ,SAASC,MAAKC,GAAsC,IAA5BH,EAAGI,KAAKC,QAAQF,OACtIG,SAAQN,IACLO,YAAYC,OAAOR,EAAGS,QAAS,CAC3BC,QAAS,SAAUC,GACf,MAAMC,EAAKD,EAAK,GAAGE,UACbC,EAAcC,OAAOd,KAAKW,GAChC,GAAoB,QAAhBE,GAAyC,SAAhBA,GAA0C,QAAhBA,GAAyC,SAAhBA,EAC5E,OACJ,MAAME,EAAYD,OAAOE,YAAYL,GACrC,GAAkB,OAAdI,EACA,OACJ,MAAME,EAAaH,OAAOI,aAAaP,GACvC,GAAmB,OAAfM,EACA,OACJ,MAAME,EAAc,CAChBC,UAAWT,EACXE,YAAaA,EACbxB,IAAKE,QAAQ8B,GACbC,UAAWC,KAAKC,SAChBC,kBAAmB1B,EAAGI,KACtBuB,QAASX,EAAUY,GACnBC,UAAWb,EAAUc,KACrBC,SAAUb,EAAWU,GACrBI,WAAYd,EAAWY,MAE3B,GAAgB,OAAZG,KAAKC,IAAuC,OAAxBD,KAAKC,GAAGC,YAAsB,CAGlD,MAAMC,EAFoBH,KAAKI,IAAI,uBACCC,OACZC,gBACxBnB,EAAYoB,MAAQJ,EAAMK,KAAIC,IACrB,CACLC,MAAOD,EAAUE,eACjBC,KAAMH,EAAUI,cAChBC,KAAML,EAAUM,gBAChBC,OAAQP,EAAUQ,gBAClBC,UAAWT,EAAUU,iBACrBC,IAAKX,EAAUY,c,EAnDnC,SAAmBC,GACf,MAAMC,EAAO,CACTvD,KAAQ,mBACRwD,KAAQ,oBACRnE,IAAOA,EACPC,QAAWA,EACXmE,UAAa,OACbC,UAAaC,KAAKC,MAClBC,KAAQP,GAEZQ,KAAKP,EACT,CA4CYQ,CAAU5C,EACd,GACF,GAEV,QAEM,SAAU6C,aAAa3E,EAAKC,GAC9BF,EAAcC,EAAKC,EACvB"}
âœ„
function e(e,t){Process.getModuleByName({linux:"libc.so",darwin:"libSystem.B.dylib",windows:"ws2_32.dll"}[Process.platform]).enumerateExports().filter((e=>"function"===e.type&&["connect","recv","send","read","write"].some((t=>0===e.name.indexOf(t))))).forEach((o=>{Interceptor.attach(o.address,{onEnter:function(n){const s=n[0].toInt32(),a=Socket.type(s);if("tcp"!==a&&"tcp6"!==a&&"udp"!==a&&"udp6"!==a)return;const c=Socket.peerAddress(s);if(null===c)return;const r=Socket.localAddress(s);if(null===r)return;const i={socket_fd:s,socket_type:a,pid:Process.id,thread_id:this.threadId,socket_event_type:o.name,dest_ip:c.ip,dest_port:c.port,local_ip:r.ip,local_port:r.port};if(null!==Java.vm&&null!==Java.vm.tryGetEnv()){const e=Java.use("java.lang.Exception").$new().getStackTrace();i.stack=e.map((e=>({class:e.getClassName(),file:e.getFileName(),line:e.getLineNumber(),method:e.getMethodName(),is_native:e.isNativeMethod(),str:e.toString()})))}!function(o){const n={type:"socket_trace_log",dump:"socket_trace.json",pid:e,process:t,data_type:"json",timestamp:Date.now(),data:o};send(n)}(i)}})}))}export function socket_trace(t,o){e(t,o)}
âœ„
{"version":3,"file":"no_root.js","names":["no_root","Java","perform","RootPackages","RootBinaries","RootProperties","RootPropertiesKeys","k","push","PackageManager","use","Runtime","NativeFile","String","SystemProperties","BufferedReader","ProcessBuilder","loaded_classes","enumerateLoadedClassesSync","console","log","length","indexOf","getPackageInfo","overload","implementation","pname","flags","this","call","exists","name","getName","exec","exec1","exec2","exec3","exec4","exec5","cmd","env","dir","fakeCmd","cmdarr","file","i","tmp_cmd","envp","contains","get","Interceptor","attach","Module","findExportByName","onEnter","args","path","Memory","readCString","executable","split","writeUtf8String","onLeave","retval","readLine","text","replace","command","start","shouldModifyCommand","size","toString"],"sourceRoot":"/Users/esther/Code/pts/pirogue-evidence-collector/pirogue_evidence_collector/frida-scripts-src/pirogue/","sources":["no_root.js"],"mappings":"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"}
âœ„
export function no_root(){Java.perform((function(){var e=["com.noshufou.android.su","com.noshufou.android.su.elite","eu.chainfire.supersu","com.koushikdutta.superuser","com.thirdparty.superuser","com.yellowes.su","com.koushikdutta.rommanager","com.koushikdutta.rommanager.license","com.dimonvideo.luckypatcher","com.chelpus.lackypatch","com.ramdroid.appquarantine","com.ramdroid.appquarantinepro","com.devadvance.rootcloak","com.devadvance.rootcloakplus","de.robv.android.xposed.installer","com.saurik.substrate","com.zachspong.temprootremovejb","com.amphoras.hidemyroot","com.amphoras.hidemyrootadfree","com.formyhm.hiderootPremium","com.formyhm.hideroot","me.phh.superuser","eu.chainfire.supersu.pro","com.kingouser.com","com.topjohnwu.magisk"],a=["su","busybox","supersu","Superuser.apk","KingoUser.apk","SuperSu.apk","magisk"],o={"ro.build.selinux":"1","ro.debuggable":"0","service.adb.root":"0","ro.secure":"1"},n=[];for(var t in o)n.push(t);var s=Java.use("android.app.ApplicationPackageManager"),i=Java.use("java.lang.Runtime"),r=Java.use("java.io.File"),l=Java.use("java.lang.String"),c=Java.use("android.os.SystemProperties"),u=Java.use("java.io.BufferedReader"),d=Java.use("java.lang.ProcessBuilder"),m=(Java.use("java.lang.StringBuffer"),Java.enumerateLoadedClassesSync());console.log("Loaded "+m.length+" classes!");console.log("loaded: "+m.indexOf("java.lang.ProcessManager")),-1!=m.indexOf("java.lang.ProcessManager")||console.log("ProcessManager hook not loaded");-1!=m.indexOf("android.security.keystore.KeyInfo")||console.log("KeyInfo hook not loaded"),s.getPackageInfo.overload("java.lang.String","int").implementation=function(a,o){return e.indexOf(a)>-1&&(console.log("Bypass root check for package: "+a),a="set.package.name.to.a.fake.one.so.we.can.bypass.it"),this.getPackageInfo.overload("java.lang.String","int").call(this,a,o)},r.exists.implementation=function(){var e=r.getName.call(this);return a.indexOf(e)>-1?(console.log("Bypass return value for binary: "+e),!1):this.exists.call(this)};var p=i.exec.overload("[Ljava.lang.String;"),g=i.exec.overload("java.lang.String"),h=i.exec.overload("java.lang.String","[Ljava.lang.String;"),f=i.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;"),v=i.exec.overload("[Ljava.lang.String;","[Ljava.lang.String;","java.io.File"),x=i.exec.overload("java.lang.String","[Ljava.lang.String;","java.io.File");x.implementation=function(e,a,o){if(-1!=e.indexOf("getprop")||"mount"==e||-1!=e.indexOf("build.prop")||"id"==e||"sh"==e){var n="grep";return console.log("Bypass "+e+" command"),g.call(this,n)}if("su"==e){n="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,n)}return x.call(this,e,a,o)},v.implementation=function(e,a,o){for(var n=0;n<e.length;n+=1){var t=e[n];if(-1!=t.indexOf("getprop")||"mount"==t||-1!=t.indexOf("build.prop")||"id"==t||"sh"==t){var s="grep";return console.log("Bypass "+e+" command"),g.call(this,s)}if("su"==t){s="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,s)}}return v.call(this,e,a,o)},f.implementation=function(e,a){for(var o=0;o<e.length;o+=1){var n=e[o];if(-1!=n.indexOf("getprop")||"mount"==n||-1!=n.indexOf("build.prop")||"id"==n||"sh"==n){var t="grep";return console.log("Bypass "+e+" command"),g.call(this,t)}if("su"==n){t="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,t)}}return f.call(this,e,a)},h.implementation=function(e,a){if(-1!=e.indexOf("getprop")||"mount"==e||-1!=e.indexOf("build.prop")||"id"==e||"sh"==e){var o="grep";return console.log("Bypass "+e+" command"),g.call(this,o)}if("su"==e){o="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,o)}return h.call(this,e,a)},p.implementation=function(e){for(var a=0;a<e.length;a+=1){var o=e[a];if(-1!=o.indexOf("getprop")||"mount"==o||-1!=o.indexOf("build.prop")||"id"==o||"sh"==o){var n="grep";return console.log("Bypass "+e+" command"),g.call(this,n)}if("su"==o){n="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,n)}}return p.call(this,e)},g.implementation=function(e){if(-1!=e.indexOf("getprop")||"mount"==e||-1!=e.indexOf("build.prop")||"id"==e||"sh"==e){var a="grep";return console.log("Bypass "+e+" command"),g.call(this,a)}if("su"==e){a="justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled";return console.log("Bypass "+e+" command"),g.call(this,a)}return g.call(this,e)},l.contains.implementation=function(e){return"test-keys"==e?(console.log("Bypass test-keys check"),!1):this.contains.call(this,e)},c.get.overload("java.lang.String").implementation=function(e){return-1!=n.indexOf(e)?(console.log("Bypass "+e),o[e]):this.get.call(this,e)},Interceptor.attach(Module.findExportByName("libc.so","fopen"),{onEnter:function(e){var o=Memory.readCString(e[0]),n=(o=o.split("/"))[o.length-1];a.indexOf(n)>-1&&(Memory.writeUtf8String(e[0],"/notexists"),console.log("Bypass native fopen"))},onLeave:function(e){}}),Interceptor.attach(Module.findExportByName("libc.so","system"),{onEnter:function(e){var a=Memory.readCString(e[0]);console.log("SYSTEM CMD: "+a),-1==a.indexOf("getprop")&&"mount"!=a&&-1==a.indexOf("build.prop")&&"id"!=a||(console.log("Bypass native system: "+a),Memory.writeUtf8String(e[0],"grep")),"su"==a&&(console.log("Bypass native system: "+a),Memory.writeUtf8String(e[0],"justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled"))},onLeave:function(e){}}),u.readLine.overload("boolean").implementation=function(){var e=this.readLine.overload("boolean").call(this);null===e||e.indexOf("ro.build.tags=test-keys")>-1&&(console.log("Bypass build.prop file read"),e=e.replace("ro.build.tags=test-keys","ro.build.tags=release-keys"));return e};d.command.overload("java.util.List");d.start.implementation=function(){for(var e=this.command.call(this),a=!1,o=0;o<e.size();o+=1){var n=e.get(o).toString();-1==n.indexOf("getprop")&&-1==n.indexOf("mount")&&-1==n.indexOf("build.prop")&&-1==n.indexOf("id")||(a=!0)}return a?(console.log("Bypass ProcessBuilder "+e),this.command.call(this,["grep"]),this.start.call(this)):-1!=e.indexOf("su")?(console.log("Bypass ProcessBuilder "+e),this.command.call(this,["justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled"]),this.start.call(this)):this.start.call(this)}}))}